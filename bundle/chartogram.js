!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).chartogram=e()}(this,function(){"use strict";function t(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},a=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),a.forEach(function(n){e(t,n,r[n])})}return t}function e(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function n(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}return function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Title",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.innerHTML='\n\t\t<header class="chartogram__header">\n\t\t\t<h1 class="chartogram__title">'.concat(a,'</h1>\n\t\t</header>\n\t\t<div class="chartogram__plan-with-axes">\n\t\t\t<div class="chartogram__plan">\n\t\t\t\t<div class="chartogram__top-border"></div>\n\t\t\t\t<div class="chartogram__canvas-wrapper">\n\t\t\t\t\t<svg class="chartogram__canvas" preserveAspectRatio="none"></svg>\n\t\t\t\t\t<div class="chartogram__x"></div>\n\t\t\t\t\t<div class="chartogram__y-wrapper">\n\t\t\t\t\t\t<div class="chartogram__y"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="chartogram__timeline">\n\t\t\t<div class="chartogram__timeline-canvas-padding">\n\t\t\t\t<svg class="chartogram__timeline-canvas" preserveAspectRatio="none"></svg>\n\t\t\t</div>\n\t\t\t<div class="chartogram__timeline-overlay-left"></div>\n\t\t\t<div class="chartogram__timeline-overlay-right"></div>\n\t\t\t<div class="chartogram__timeline-window">\n\t\t\t\t<button type="button" class="chartogram__reset-button chartogram__timeline-window__drag"></button>\n\t\t\t\t<button type="button" class="chartogram__reset-button chartogram__timeline-window__left-handle"></button>\n\t\t\t\t<button type="button" class="chartogram__reset-button chartogram__timeline-window__right-handle"></button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="chartogram__chart-togglers"></div>\n\t'),e.classList.add("chartogram");var i,c,l,d,s,u,h,v,m,g,f,p,_,y,b,w,x=o.gaugeMarkTicksCount||6,A=o.timelineWindowSize||40,L=o.months||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=o.weekdays||["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],S=document.querySelector(".chartogram__plan"),C=document.querySelector(".chartogram__canvas"),k=document.querySelector(".chartogram__canvas-wrapper"),M=document.querySelector(".chartogram__x"),N=document.querySelector(".chartogram__y"),T=document.querySelector(".chartogram__timeline"),q=document.querySelector(".chartogram__timeline-overlay-left"),O=document.querySelector(".chartogram__timeline-window__left-handle"),j=document.querySelector(".chartogram__timeline-window"),B=document.querySelector(".chartogram__timeline-window__drag"),D=document.querySelector(".chartogram__timeline-window__right-handle"),R=document.querySelector(".chartogram__timeline-overlay-right"),X=document.querySelector(".chartogram__timeline-canvas"),Y=1;function I(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function P(t,e){return t.map(function(t,n){return"".concat(t,",").concat(e[n])})}function F(t,e,n,r){for(var a=0;a<x;){var o=document.createElement("div"),i=e+a*(n-e)/(x-1);r&&(i=r(i)),o.appendChild(document.createTextNode(i)),t.appendChild(o),a++}}function H(e){var a=r.x.points;m=a[0];var o=a.map(function(t){return(t-m)/1e3});I(C);var f=o[0],p=o[o.length-1],_=p-f,y=f+i*_,b=p-(1-c)*_,w=o.findIndex(function(t){return t>y})-1;w<0&&(w=0);var A=o.findIndex(function(t){return t>b});A<0&&(A=o.length-1);var E=o.slice(w,A+1),S=0,k=0;d=[];var T=[],q=r.lines,O=Array.isArray(q),j=0;for(q=O?q:q[Symbol.iterator]();;){var B;if(O){if(j>=q.length)break;B=q[j++]}else{if((j=q.next()).done)break;B=j.value}var D=B;if(l[D.id]){T.push(D),k=Math.max.apply(Math,[k].concat(n(D.points)));var R=D.points.slice(w,A+1);d.push(t({},D,{points:R})),S=Math.max.apply(Math,[S].concat(n(R)))}}C.setAttribute("viewBox","".concat(y," ").concat(0," ").concat(b-y," ").concat(S-0));var H=function(t,e){for(;;){if(t<e)return e;if(t%e==0)return t;t--}}(S,10),W=(S-0)/(H-0),z=function(t,e){for(var n=new Array(x),r=0;r<x;)n[r]=t+r*(e-t)/(x-1),r++;return n}(0,H),G=Array.isArray(z),K=0;for(z=G?z:z[Symbol.iterator]();;){var Q;if(G){if(K>=z.length)break;Q=z[K++]}else{if((K=z.next()).done)break;Q=K.value}var U=Q;C.appendChild(J(U,y,b,0,S))}var V=E.slice(),Z=V[0],$=V[V.length-1],tt=(y-Z)/(V[1]-Z),et=($-b)/($-V[V.length-2]);V[0]=y,V[V.length-1]=b;var nt=d,rt=Array.isArray(nt),at=0;for(nt=rt?nt:nt[Symbol.iterator]();;){var ot;if(rt){if(at>=nt.length)break;ot=nt[at++]}else{if((at=nt.next()).done)break;ot=at.value}var it=ot,ct=(it.id,it.color),lt=it.points,dt=document.createElement("polyline");dt.setAttribute("stroke",ct);var st=lt.slice(),ut=st[0],ht=st[st.length-1];st[0]=ut+(st[1]-ut)*tt,st[st.length-1]=ht-(ht-st[st.length-2])*et,dt.setAttribute("points",P(V,st.map(function(t){return S-Y*t})).join(" ")),dt.classList.add("chartogram__graph"),C.appendChild(dt)}C.innerHTML+="",function(t,e,n,r,a){I(M),I(N),F(M,t,e,function(t){var e=new Date(t);return"".concat(L[e.getMonth()]," ").concat(e.getDate())}),F(N,n,r),N.style.height="".concat(100/a,"%")}(a[0],a[a.length-1],0,H,W),h=0,v=S,s=y,u=b,g=E,e&&function(t,e,n,r,a,o){I(X),X.setAttribute("viewBox","".concat(n," ").concat(a," ").concat(r-n," ").concat(o-a));for(var i=t,c=Array.isArray(i),l=0,i=c?i:i[Symbol.iterator]();;){var d;if(c){if(l>=i.length)break;d=i[l++]}else{if((l=i.next()).done)break;d=l.value}var s=d,u=(s.id,s.color),h=s.points,v=document.createElement("polyline");v.setAttribute("stroke",u),v.setAttribute("points",P(e,h.map(function(t){return o-a-t})).join(" ")),v.classList.add("chartogram__graph"),X.appendChild(v)}X.innerHTML+=""}(T,o,f,p,0,k)}function J(t,e,n,r,a){var o=document.createElement("line");return o.classList.add("chartogram__grid-line"),o.setAttribute("x1",e),o.setAttribute("x2",n),o.setAttribute("y1",a-r-t),o.setAttribute("y2",a-r-t),o}function W(t){var e=t.id,n=t.name,r=t.color,a=document.createElement("button");a.setAttribute("type","button"),a.classList.add("chartogram__chart-toggler"),a.classList.add("chartogram__chart-toggler--on"),a.classList.add("chartogram__reset-button");var o="http://www.w3.org/2000/svg",i=document.createElementNS(o,"svg");i.setAttributeNS(null,"viewBox","0 0 19 19"),i.classList.add("chartogram__chart-toggler-check");var c=document.createElementNS(o,"circle");c.setAttribute("cx","9.5"),c.setAttribute("cy","9.5"),c.setAttribute("r","9.5"),c.setAttribute("fill",r),i.appendChild(c);var d=document.createElementNS(o,"circle");d.setAttribute("cx","9.5"),d.setAttribute("cy","9.5"),d.setAttribute("r","8"),d.classList.add("chartogram__chart-toggler-check-circle"),i.appendChild(d);var s=document.createElementNS(o,"path");return s.setAttribute("d","M13.64 4.94l-6.2 6.34-1.69-1.9c-.73-.63-1.89.1-1.36 1.06l2 3.38c.3.43 1.04.85 1.78 0 .32-.42 6.31-7.93 6.31-7.93.74-.84-.2-1.58-.84-.95z"),s.setAttribute("fill","white"),s.classList.add("chartogram__chart-toggler-check-mark"),i.appendChild(s),a.appendChild(i),a.appendChild(document.createTextNode(n)),a.addEventListener("click",function(){var t=!l[e];(t||1!==Object.keys(l).filter(function(t){return!1!==l[t]}).length)&&(l[e]=t,H(!0),a.classList.toggle("chartogram__chart-toggler--on"))}),a}function z(t){var e,n,r,a,o="left"===t?O:D,l=parseFloat(getComputedStyle(j).borderLeftWidth);return G(o,function(o){e=T.getBoundingClientRect();var i=j.getBoundingClientRect();"left"===t?(n=e.x,r=i.x+i.width-2*l,a=o-i.x):(n=i.x+2*l,r=e.x+e.width,a=o-(i.x+i.width))},function(o){o-=a,o=((o=Math.max(Math.min(o,r),n))-e.x)/e.width,"left"===t?i=o:c=o,K()})}function G(t,e,n){function r(t){n(t.changedTouches[0].clientX,t.changedTouches[0].clientY)}function a(t){n(t.clientX,t.clientY)}function o(){window.removeEventListener("pointermove",a),window.removeEventListener("touchmove",r),window.removeEventListener("pointerup",o),window.removeEventListener("pointercancel",o),window.removeEventListener("touchend",o),window.removeEventListener("touchcancel",o)}function i(t){if(t.touches.length>1)return o();e(t.changedTouches[0].clientX,t.changedTouches[0].clientY),window.addEventListener("touchmove",r),window.addEventListener("touchend",o),window.addEventListener("touchcancel",o)}function c(t){e(t.clientX,t.clientY),window.addEventListener("pointermove",a),window.addEventListener("pointerup",o),window.addEventListener("pointercancel",o)}return t.addEventListener("touchstart",i),t.addEventListener("pointerdown",c),function(){o(),t.removeEventListener(c),t.removeEventListener(i)}}function K(){var t;t=i,q.style.right="".concat(100*(1-t),"%"),j.style.left="".concat(100*t,"%"),function(t){R.style.left="".concat(100*t,"%"),j.style.right="".concat(100*(1-t),"%")}(c),H(!1)}function Q(){f&&(y=void 0,S.removeChild(f),f=void 0,function(){for(var t=b,e=Array.isArray(t),n=0,t=e?t:t[Symbol.iterator]();;){var r;if(e){if(n>=t.length)break;r=t[n++]}else{if((n=t.next()).done)break;r=n.value}var a=r;k.removeChild(a)}b=void 0}(),C.removeChild(w),w=void 0)}z("left"),z("right"),G(B,function(t){U=T.getBoundingClientRect(),V=j.getBoundingClientRect(),tt=t-V.x,Z=U.x,$=U.x+(U.width-V.width)},function(t){t-=tt,t=((t=Math.max(Math.min(t,$),Z))-U.x)/U.width,i=t,c=t+V.width/U.width,K()}),function(){l={};for(var t=r.lines,e=Array.isArray(t),n=0,t=e?t:t[Symbol.iterator]();;){var a;if(e){if(n>=t.length)break;a=t[n++]}else{if((n=t.next()).done)break;a=n.value}var o=a;l[o.id]=!0}if(r.x.points.length>A){var d=r.x.points[0],s=r.x.points[r.x.points.length-1],u=r.x.points[r.x.points.length-A];i=(u-d)/(s-d)}else i=0;c=1,K(),H(!0),w=void 0;var h=document.querySelector(".chartogram__chart-togglers");I(h);for(var v=r.lines,m=Array.isArray(v),g=0,v=m?v:v[Symbol.iterator]();;){var f;if(m){if(g>=v.length)break;f=v[g++]}else{if((g=v.next()).done)break;f=g.value}var p=f;h.appendChild(W(p))}}(),function(){var t,e;function n(n){var a=(n-t.x)/t.width,o=s+a*(u-s),i=g.findIndex(function(t){return t>=o}),c=i-1;if(e(i)||(i=-1),e(c)||(c=-1),i<0){if(c<0)return Q();o=g[c]}else if(c<0)o=g[i];else{var x=g[c],A=g[i],M=o-x,N=A-o;o=M>N?A:x}if(o!==y){y=o,f||function(){(f=document.createElement("div")).classList.add("chartogram__tooltip"),S.appendChild(f),(p=document.createElement("h1")).classList.add("chartogram__tooltip-header"),f.appendChild(p),(_=document.createElement("dl")).classList.add("chartogram__tooltip-values"),f.appendChild(_);for(var t=r.lines,e=Array.isArray(t),n=0,t=e?t:t[Symbol.iterator]();;){var a;if(e){if(n>=t.length)break;a=t[n++]}else{if((n=t.next()).done)break;a=n.value}var o=a;if(l[o.id]){var i=document.createElement("dt");i.style.color=o.color,_.appendChild(i);var c=document.createElement("dd");c.style.color=o.color,_.appendChild(c)}}}();var T=new Date(1e3*o+m);p.textContent="".concat(E[T.getDay()],", ").concat(L[T.getMonth()]," ").concat(T.getDate());for(var q=g.indexOf(o),O=0;2*O<_.childNodes.length;)_.childNodes[2*O].textContent=d[O].points[q],_.childNodes[2*O+1].textContent=r.lines[O].name,O++;var j=(o-s)/(u-s);f.style.left="".concat(100*j,"%"),function(t,e){b||function(){b=[];for(var t=0;t<d.length;){var e=document.createElement("div");e.classList.add("chartogram__tooltip-point"),e.style.color=d[t].color,b.push(e),k.appendChild(e),t++}}();for(var n=0;n<b.length;){var r=b[n];r.style.left="".concat(100*e,"%");var a=d[n].points[t],o=a/v;r.style.bottom="".concat(100*o,"%"),n++}}(q,j),function(t){w||((w=document.createElementNS("http://www.w3.org/2000/svg","line")).setAttributeNS(null,"class","chartogram__tooltip-line"),C.appendChild(w)),w.setAttributeNS(null,"x1",t),w.setAttributeNS(null,"x2",t),w.setAttributeNS(null,"y1",h),w.setAttributeNS(null,"y2",v)}(o)}}function a(){t=C.getBoundingClientRect(),e=function(t){return!(t<0)&&g[t]>=s&&g[t]<=u}}function o(t){if(t.touches.length>1)return x();a(),C.addEventListener("touchend",x),C.addEventListener("touchmove",i),C.addEventListener("touchend",x),C.addEventListener("touchcancel",x),i(t)}function i(e){var r=e.changedTouches[0].clientX,a=e.changedTouches[0].clientY;r<t.x||r>t.x+t.width||a<t.y||a>t.y+t.height?x():n(r)}function c(t){n(t.clientX,t.clientY)}function x(){C.removeEventListener("pointermove",c),C.removeEventListener("pointerleave",x),C.removeEventListener("pointercancel",x),C.removeEventListener("touchmove",i),C.removeEventListener("touchend",x),C.removeEventListener("touchcancel",x),Q()}function A(){a(),C.addEventListener("pointermove",c),C.addEventListener("pointerleave",x),C.addEventListener("pointercancel",x)}C.addEventListener("touchstart",o),C.addEventListener("pointerenter",A)}();var U,V,Z,$,tt}});
//# sourceMappingURL=chartogram.js.map
