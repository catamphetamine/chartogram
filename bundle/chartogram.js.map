{"version":3,"file":"chartogram.js","sources":["../modules/index.js"],"sourcesContent":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nexport default function chartogram(rootNode, data) {\n  var title = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'Title';\n  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  // clearElement(rootNode)\n  rootNode.innerHTML = \"\\n\\t\\t<header class=\\\"chartogram__header\\\">\\n\\t\\t\\t<h1 class=\\\"chartogram__title\\\">\".concat(title, \"</h1>\\n\\t\\t</header>\\n\\t\\t<div class=\\\"chartogram__plan-with-axes\\\">\\n\\t\\t\\t<div class=\\\"chartogram__plan\\\">\\n\\t\\t\\t\\t<div class=\\\"chartogram__top-border\\\"></div>\\n\\t\\t\\t\\t<div class=\\\"chartogram__canvas-wrapper\\\">\\n\\t\\t\\t\\t\\t<svg class=\\\"chartogram__canvas\\\" preserveAspectRatio=\\\"none\\\"></svg>\\n\\t\\t\\t\\t\\t<div class=\\\"chartogram__x\\\"></div>\\n\\t\\t\\t\\t\\t<div class=\\\"chartogram__y-wrapper\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"chartogram__y\\\"></div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"chartogram__timeline\\\">\\n\\t\\t\\t<div class=\\\"chartogram__timeline-canvas-padding\\\">\\n\\t\\t\\t\\t<svg class=\\\"chartogram__timeline-canvas\\\" preserveAspectRatio=\\\"none\\\"></svg>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"chartogram__timeline-overlay-left\\\"></div>\\n\\t\\t\\t<div class=\\\"chartogram__timeline-overlay-right\\\"></div>\\n\\t\\t\\t<div class=\\\"chartogram__timeline-window\\\">\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__drag\\\"></button>\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__left-handle\\\"></button>\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__right-handle\\\"></button>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"chartogram__chart-togglers\\\"></div>\\n\\t\");\n  rootNode.classList.add('chartogram');\n  var GAUGE_TICK_MARKS_COUNT = options.gaugeMarkTicksCount || 6;\n  var TIMELINE_WINDOW_SIZE = options.timelineWindowSize || 40;\n  var TIMELINE_CHART_MAX_POINTS = options.timelineChartMaxPoints || 80;\n  var MONTHS = options.months || ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n  var WEEKDAYS = options.weekdays || ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  var tooltipContainer = document.querySelector('.chartogram__plan');\n  var canvas = document.querySelector('.chartogram__canvas');\n  var canvasWrapper = document.querySelector('.chartogram__canvas-wrapper');\n  var xAxis = document.querySelector('.chartogram__x');\n  var yAxis = document.querySelector('.chartogram__y');\n  var timeline = document.querySelector('.chartogram__timeline');\n  var timelineOverlayLeft = document.querySelector('.chartogram__timeline-overlay-left');\n  var timelineWindowLeftHandle = document.querySelector('.chartogram__timeline-window__left-handle');\n  var timelineWindow = document.querySelector('.chartogram__timeline-window');\n  var timelineWindowDrag = document.querySelector('.chartogram__timeline-window__drag');\n  var timelineWindowRightHandle = document.querySelector('.chartogram__timeline-window__right-handle');\n  var timelineOverlayRight = document.querySelector('.chartogram__timeline-overlay-right');\n  var timelineCanvas = document.querySelector('.chartogram__timeline-canvas');\n  var timelineWindowFrom;\n  var timelineWindowTo;\n  var showGraphs;\n  var showGraphsNext;\n  var timelineWindowGraphs;\n  var timelineWindowMinX;\n  var timelineWindowMaxX;\n  var timelineWindowMinY;\n  var timelineWindowMaxY;\n  var timelineWindowX;\n  var tooltip;\n  var tooltipDate;\n  var tooltipValues;\n  var tooltipForX;\n  var tooltipPoints;\n  var tooltipLine; // A stub for possible animations.\n\n  var yScale = 1;\n  setUpTimelineWindowHandle('left');\n  setUpTimelineWindowHandle('right');\n  setUpTimelineWindow();\n  normalizeDataPoints();\n  displayGraphs();\n  setUpCanvas();\n\n  function clearElement(element) {\n    while (element.firstChild) {\n      element.removeChild(element.firstChild);\n    }\n  }\n\n  function commaJoin(a, b) {\n    return a.map(function (ai, i) {\n      return \"\".concat(ai, \",\").concat(b[i]);\n    });\n  }\n\n  function createPolylinePoints(x, y) {\n    // return commaJoin(x, y)\n    return commaJoin(x.map(fixSvgCoordinate), y.map(fixSvgCoordinate));\n  } // Firefox is buggy with too high and too fractional SVG coordinates.\n\n\n  function fixSvgCoordinate(x) {\n    return Math.round(x * Number.MAX_SAFE_INTEGER) / Number.MAX_SAFE_INTEGER;\n  }\n\n  function getLowerSiblingDivisibleBy(n, divider) {\n    while (true) {\n      if (n < divider) {\n        return divider;\n      }\n\n      if (n % divider === 0) {\n        return n;\n      }\n\n      n--;\n    }\n  }\n\n  function divideInterval(min, max) {\n    var points = new Array(GAUGE_TICK_MARKS_COUNT);\n    var i = 0;\n\n    while (i < GAUGE_TICK_MARKS_COUNT) {\n      points[i] = min + i * (max - min) / (GAUGE_TICK_MARKS_COUNT - 1);\n      i++;\n    }\n\n    return points;\n  }\n\n  function drawGauge(element, min, max, transform) {\n    var i = 0;\n\n    while (i < GAUGE_TICK_MARKS_COUNT) {\n      var tickMark = document.createElement('div');\n      var value = min + i * (max - min) / (GAUGE_TICK_MARKS_COUNT - 1);\n\n      if (transform) {\n        value = transform(value);\n      }\n\n      tickMark.appendChild(document.createTextNode(value));\n      element.appendChild(tickMark);\n      i++;\n    }\n  } // Chrome and Firefox can't handle timestamps in milliseconds for point coordinates (draws nothing).\n  // Reducing timestamps to lower numbers to work around that bug.\n\n\n  function normalizeDataPoints() {\n    normalizePoints([data.x]);\n    normalizePoints(data.lines);\n  }\n\n  function normalizePoints(all) {\n    var isX = all[0] === data.x;\n    var min = Infinity;\n    var max = -Infinity;\n\n    for (var _iterator = all, _isArray = Array.isArray(_iterator), _i2 = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i2 >= _iterator.length) break;\n        _ref = _iterator[_i2++];\n      } else {\n        _i2 = _iterator.next();\n        if (_i2.done) break;\n        _ref = _i2.value;\n      }\n\n      var one = _ref;\n\n      if (isX) {\n        one.min = one.points[0];\n        one.max = one.points[one.points.length - 1];\n      } else {\n        // For Y min is always 0 by design.\n        one.min = 0; // one.min = Math.min(...one.points)\n\n        one.max = Math.max.apply(Math, _toConsumableArray(one.points));\n      }\n\n      min = Math.min(min, one.min);\n      max = Math.max(max, one.max);\n    } // For Y min is always 0 by design.\n\n\n    if (!isX) {\n      min = 0;\n    }\n\n    var shift = min;\n    var scale = max - min;\n\n    for (var _iterator2 = all, _isArray2 = Array.isArray(_iterator2), _i3 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i3 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i3++];\n      } else {\n        _i3 = _iterator2.next();\n        if (_i3.done) break;\n        _ref2 = _i3.value;\n      }\n\n      var _one = _ref2;\n      _one.normalized = {\n        points: _one.points.map(function (_) {\n          return (_ - shift) / scale;\n        }),\n        shift: shift,\n        scale: scale\n      };\n    }\n  }\n\n  function displayGraphs() {\n    showGraphs = {};\n\n    for (var _iterator3 = data.lines, _isArray3 = Array.isArray(_iterator3), _i4 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n      var _ref3;\n\n      if (_isArray3) {\n        if (_i4 >= _iterator3.length) break;\n        _ref3 = _iterator3[_i4++];\n      } else {\n        _i4 = _iterator3.next();\n        if (_i4.done) break;\n        _ref3 = _i4.value;\n      }\n\n      var line = _ref3;\n      showGraphs[line.id] = true;\n    }\n\n    showGraphsNext = undefined;\n\n    if (data.x.points.length > TIMELINE_WINDOW_SIZE) {\n      var xMin = data.x.points[0];\n      var xMax = data.x.points[data.x.points.length - 1];\n      var xFrom = data.x.points[data.x.points.length - TIMELINE_WINDOW_SIZE];\n      timelineWindowFrom = (xFrom - xMin) / (xMax - xMin);\n    } else {\n      timelineWindowFrom = 0;\n    }\n\n    timelineWindowTo = 1;\n    updateTimelineWindow();\n    drawGraphs(true);\n    tooltipLine = undefined; // Add graph togglers.\n\n    var graphTogglers = document.querySelector('.chartogram__chart-togglers');\n    clearElement(graphTogglers);\n\n    for (var _iterator4 = data.lines, _isArray4 = Array.isArray(_iterator4), _i5 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n      var _ref4;\n\n      if (_isArray4) {\n        if (_i5 >= _iterator4.length) break;\n        _ref4 = _iterator4[_i5++];\n      } else {\n        _i5 = _iterator4.next();\n        if (_i5.done) break;\n        _ref4 = _i5.value;\n      }\n\n      var _line = _ref4;\n      graphTogglers.appendChild(createGraphToggler(_line));\n    }\n  }\n\n  function drawGraphs(redrawTimeline) {\n    // Clear canvas.\n    clearElement(canvas); // Calculate bounds.\n\n    var xPoints = data.x.points;\n    var minXOverall = xPoints[0];\n    var maxXOverall = xPoints[xPoints.length - 1];\n    var deltaX = maxXOverall - minXOverall;\n    var minX = minXOverall + timelineWindowFrom * deltaX;\n    var maxX = maxXOverall - (1 - timelineWindowTo) * deltaX;\n    var minXIndex = xPoints.findIndex(function (x) {\n      return x > minX;\n    }) - 1;\n\n    if (minXIndex < 0) {\n      minXIndex = 0;\n    }\n\n    var maxXIndex = xPoints.findIndex(function (x) {\n      return x > maxX;\n    });\n\n    if (maxXIndex < 0) {\n      maxXIndex = xPoints.length - 1;\n    }\n\n    timelineWindowX = data.x.normalized.points.slice(minXIndex, maxXIndex + 1); // let minY = Infinity\n    // Min Y is always 0 by design.\n\n    var minY = 0;\n    var maxY = -Infinity;\n    timelineWindowGraphs = [];\n\n    for (var _iterator5 = data.lines, _isArray5 = Array.isArray(_iterator5), _i6 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {\n      var _ref5;\n\n      if (_isArray5) {\n        if (_i6 >= _iterator5.length) break;\n        _ref5 = _iterator5[_i6++];\n      } else {\n        _i6 = _iterator5.next();\n        if (_i6.done) break;\n        _ref5 = _i6.value;\n      }\n\n      var line = _ref5;\n\n      if (!showGraphs[line.id]) {\n        continue;\n      }\n\n      var points = line.points.slice(minXIndex, maxXIndex + 1); // Min Y is always 0 by design.\n\n      var min = 0; // const min = Math.min(...points)\n\n      var max = Math.max.apply(Math, _toConsumableArray(points));\n      timelineWindowGraphs.push(_objectSpread({}, line, {\n        points: points,\n        min: min,\n        max: max,\n        normalized: _objectSpread({}, line.normalized, {\n          points: line.normalized.points.slice(minXIndex, maxXIndex + 1)\n        })\n      })); // minY = Math.min(minY, ...points)\n\n      maxY = Math.max.apply(Math, [maxY].concat(_toConsumableArray(points)));\n    } // Set canvas `viewBox`.\n\n\n    var minXNormalized = (minX - data.x.normalized.shift) / data.x.normalized.scale;\n    var maxXNormalized = (maxX - data.x.normalized.shift) / data.x.normalized.scale;\n    var minYNormalized = (minY - data.lines[0].normalized.shift) / data.lines[0].normalized.scale;\n    var maxYNormalized = (maxY - data.lines[0].normalized.shift) / data.lines[0].normalized.scale;\n    canvas.setAttribute('viewBox', \"\".concat(minXNormalized, \" \").concat(minYNormalized, \" \").concat(maxXNormalized - minXNormalized, \" \").concat(maxYNormalized - minYNormalized)); // Calculate grid lines' coordinates.\n\n    var minY_ = 0;\n    var maxY_ = getLowerSiblingDivisibleBy(maxY, 10);\n    var yAxisScale = (maxY - minY) / (maxY_ - minY);\n    var yAxisTickMarks = divideInterval(minY_, maxY_); // Draw grid lines.\n\n    for (var _iterator6 = yAxisTickMarks, _isArray6 = Array.isArray(_iterator6), _i7 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {\n      var _ref6;\n\n      if (_isArray6) {\n        if (_i7 >= _iterator6.length) break;\n        _ref6 = _iterator6[_i7++];\n      } else {\n        _i7 = _iterator6.next();\n        if (_i7.done) break;\n        _ref6 = _i7.value;\n      }\n\n      var y = _ref6;\n      canvas.appendChild(createGridLine((y - data.lines[0].normalized.shift) / data.lines[0].normalized.scale, minXNormalized, maxXNormalized, minYNormalized, maxYNormalized));\n    } // Trim X axis.\n\n\n    var _x = timelineWindowX.slice();\n\n    var _minX = _x[0];\n    var _maxX = _x[_x.length - 1];\n    var trimLeftRatio = (minXNormalized - _minX) / (_x[1] - _minX);\n    var trimRightRatio = (_maxX - maxXNormalized) / (_maxX - _x[_x.length - 2]);\n    _x[0] = minXNormalized;\n    _x[_x.length - 1] = maxXNormalized; // Draw charts.\n\n    for (var _iterator7 = timelineWindowGraphs, _isArray7 = Array.isArray(_iterator7), _i8 = 0, _iterator7 = _isArray7 ? _iterator7 : _iterator7[Symbol.iterator]();;) {\n      var _ref7;\n\n      if (_isArray7) {\n        if (_i8 >= _iterator7.length) break;\n        _ref7 = _iterator7[_i8++];\n      } else {\n        _i8 = _iterator7.next();\n        if (_i8.done) break;\n        _ref7 = _i8.value;\n      }\n\n      var _ref8 = _ref7,\n          id = _ref8.id,\n          color = _ref8.color,\n          _points = _ref8.normalized.points;\n\n      // Trim chart.\n      var _y = _points.slice();\n\n      var _minY = _y[0];\n      var _maxY = _y[_y.length - 1];\n      _y[0] = _minY + (_y[1] - _minY) * trimLeftRatio;\n      _y[_y.length - 1] = _maxY - (_maxY - _y[_y.length - 2]) * trimRightRatio; // Draw chart.\n\n      var graph = document.createElement('polyline');\n      graph.setAttribute('stroke', color);\n      graph.setAttribute('points', createPolylinePoints(_x, _y.map(function (y) {\n        return maxYNormalized - yScale * y;\n      })).join(' '));\n      graph.classList.add('chartogram__graph');\n      canvas.appendChild(graph);\n    } // A workaround to fix WebKit bug when it's not re-rendering the <svg/>.\n    // https://stackoverflow.com/questions/30905493/how-to-force-webkit-to-update-svg-use-elements-after-changes-to-original\n\n\n    canvas.innerHTML += ''; // Draw gauges.\n\n    drawGauges(minX, maxX, minY_, maxY_, yAxisScale); // Draw timeline graph.\n\n    timelineWindowMinY = minYNormalized;\n    timelineWindowMaxY = maxYNormalized;\n    timelineWindowMinX = minXNormalized;\n    timelineWindowMaxX = maxXNormalized;\n\n    if (redrawTimeline) {\n      drawTimeline();\n    }\n  } // function animateScale(scale) {\n  // \tconsole.log(scale)\n  // \tanimateScaleTo = scale\n  // \tanimateScaleStartedAt = Date.now()\n  // \tpreviousYScale = yScale\n  // \trequestAnimationFrame(animateScaleTick)\n  // }\n  // function animateScaleTick() {\n  // \tconst elapsed = Date.now() - animateScaleStartedAt\n  // \tyScale = previousYScale + (animateScaleTo - previousYScale) * elapsed / 300\n  // \tdrawGraphs(true)\n  // \tif (elapsed < 300) {\n  // \t\trequestAnimationFrame(animateScaleTick)\n  // \t}\n  // }\n\n\n  function createGridLine(y, minX, maxX, minY, maxY) {\n    var line = document.createElement('line');\n    line.classList.add('chartogram__grid-line');\n    line.setAttribute('x1', fixSvgCoordinate(minX));\n    line.setAttribute('x2', fixSvgCoordinate(maxX));\n    line.setAttribute('y1', fixSvgCoordinate(maxY - minY - y));\n    line.setAttribute('y2', fixSvgCoordinate(maxY - minY - y));\n    return line;\n  }\n\n  function drawGauges(minX, maxX, minY, maxY, yAxisScale) {\n    clearElement(xAxis);\n    clearElement(yAxis);\n    drawGauge(xAxis, minX, maxX, function (timestamp) {\n      var date = new Date(timestamp);\n      return \"\".concat(MONTHS[date.getMonth()], \" \").concat(date.getDate());\n    });\n    drawGauge(yAxis, minY, maxY);\n    yAxis.style.height = \"\".concat(100 / yAxisScale, \"%\");\n  }\n\n  function simplifyGraph(x, y, maxPoints) {\n    var yMax = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Math.max.apply(Math, _toConsumableArray(y));\n    var threshold = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0.025;\n    var i = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n    var _x = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new Array(x.length);\n\n    var _y = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : new Array(x.length);\n\n    var _i = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : 0;\n\n    if (i + 2 > x.length - 1) {\n      while (i < y.length) {\n        _x[_i] = x[i];\n        _y[_i] = y[i];\n        _i++;\n        i++;\n      }\n\n      _x = _x.slice(0, _i);\n      _y = _y.slice(0, _i);\n\n      if (_x.length <= maxPoints) {\n        return [_x, _y];\n      } else {\n        if (x.length / _x.length < 1.1) {\n          threshold = Math.min(threshold + 0.025, 1);\n        }\n\n        return simplifyGraph(_x, _y, maxPoints, yMax, threshold);\n      }\n    }\n\n    var y0 = (y[i + 2] + y[i]) / 2;\n\n    if (Math.abs(y0 - y[i + 1]) / yMax < threshold) {\n      _x[_i] = x[i];\n      _x[_i + 1] = x[i + 2];\n      _y[_i] = y[i];\n      _y[_i + 1] = y[i + 2];\n      return simplifyGraph(x, y, maxPoints, yMax, threshold, i + 2, _x, _y, _i + 1);\n    } else {\n      _x[_i] = x[i];\n      _x[_i + 1] = x[i + 1];\n      _x[_i + 2] = x[i + 2];\n      _y[_i] = y[i];\n      _y[_i + 1] = y[i + 1];\n      _y[_i + 2] = y[i + 2];\n      return simplifyGraph(x, y, maxPoints, yMax, threshold, i + 2, _x, _y, _i + 2);\n    }\n  }\n\n  function drawTimeline() {\n    var x = data.x.normalized.points;\n    var graphs = data.lines.filter(function (_) {\n      return showGraphs[_.id];\n    });\n    var minX = 0;\n    var maxX = 1;\n    var minY = (Math.min.apply(Math, _toConsumableArray(graphs.map(function (_) {\n      return _.min;\n    }))) - graphs[0].normalized.shift) / graphs[0].normalized.scale;\n    var maxY = (Math.max.apply(Math, _toConsumableArray(graphs.map(function (_) {\n      return _.max;\n    }))) - graphs[0].normalized.shift) / graphs[0].normalized.scale;\n    clearElement(timelineCanvas); // Set canvas `viewBox`.\n\n    timelineCanvas.setAttribute('viewBox', \"\".concat(minX, \" \").concat(minY, \" \").concat(maxX - minX, \" \").concat(maxY - minY));\n\n    for (var _iterator8 = graphs, _isArray8 = Array.isArray(_iterator8), _i9 = 0, _iterator8 = _isArray8 ? _iterator8 : _iterator8[Symbol.iterator]();;) {\n      var _ref9;\n\n      if (_isArray8) {\n        if (_i9 >= _iterator8.length) break;\n        _ref9 = _iterator8[_i9++];\n      } else {\n        _i9 = _iterator8.next();\n        if (_i9.done) break;\n        _ref9 = _i9.value;\n      }\n\n      var _ref10 = _ref9,\n          id = _ref10.id,\n          color = _ref10.color,\n          points = _ref10.normalized.points;\n\n      var _simplifyGraph = simplifyGraph(x, points, 80),\n          _simplifyGraph2 = _slicedToArray(_simplifyGraph, 2),\n          _x = _simplifyGraph2[0],\n          _y = _simplifyGraph2[1];\n\n      var graph = document.createElement('polyline');\n      graph.setAttribute('stroke', color);\n      graph.setAttribute('points', createPolylinePoints(_x, _y.map(function (y) {\n        return maxY - minY - y;\n      })).join(' '));\n      graph.classList.add('chartogram__graph');\n      timelineCanvas.appendChild(graph);\n    } // A workaround to fix WebKit bug when it's not re-rendering the <svg/>.\n    // https://stackoverflow.com/questions/30905493/how-to-force-webkit-to-update-svg-use-elements-after-changes-to-original\n\n\n    timelineCanvas.innerHTML += '';\n  }\n\n  function createGraphToggler(_ref11) {\n    var id = _ref11.id,\n        name = _ref11.name,\n        color = _ref11.color;\n    var toggler = document.createElement('button');\n    toggler.setAttribute('type', 'button');\n    toggler.classList.add('chartogram__chart-toggler');\n    toggler.classList.add('chartogram__chart-toggler--on');\n    toggler.classList.add('chartogram__reset-button'); // Add check.\n\n    var xmlns = 'http://www.w3.org/2000/svg';\n    var check = document.createElementNS(xmlns, 'svg');\n    check.setAttributeNS(null, 'viewBox', '0 0 19 19');\n    check.classList.add('chartogram__chart-toggler-check'); // Add background circle.\n\n    var backgroundCircle = document.createElementNS(xmlns, 'circle');\n    backgroundCircle.setAttribute('cx', '9.5');\n    backgroundCircle.setAttribute('cy', '9.5');\n    backgroundCircle.setAttribute('r', '9.5');\n    backgroundCircle.setAttribute('fill', color);\n    check.appendChild(backgroundCircle); // Add check circle.\n\n    var checkCircle = document.createElementNS(xmlns, 'circle');\n    checkCircle.setAttribute('cx', '9.5');\n    checkCircle.setAttribute('cy', '9.5');\n    checkCircle.setAttribute('r', '8');\n    checkCircle.classList.add('chartogram__chart-toggler-check-circle');\n    check.appendChild(checkCircle); // Add check mark.\n\n    var checkMark = document.createElementNS(xmlns, 'path');\n    checkMark.setAttribute('d', 'M13.64 4.94l-6.2 6.34-1.69-1.9c-.73-.63-1.89.1-1.36 1.06l2 3.38c.3.43 1.04.85 1.78 0 .32-.42 6.31-7.93 6.31-7.93.74-.84-.2-1.58-.84-.95z');\n    checkMark.setAttribute('fill', 'white');\n    checkMark.classList.add('chartogram__chart-toggler-check-mark');\n    check.appendChild(checkMark); // Add checkmark.\n\n    toggler.appendChild(check); // Add graph name.\n\n    toggler.appendChild(document.createTextNode(name)); // On click.\n\n    toggler.addEventListener('click', function () {\n      var show = !showGraphs[id]; // Won't allow hiding all graphs.\n\n      if (!show) {\n        var graphsShown = Object.keys(showGraphs).filter(function (id) {\n          return showGraphs[id] !== false;\n        }).length;\n\n        if (graphsShown === 1) {\n          return;\n        }\n      }\n\n      showGraphs[id] = show;\n      drawGraphs(true);\n      toggler.classList.toggle('chartogram__chart-toggler--on');\n    });\n    return toggler;\n  }\n\n  function getMaxY(graphs) {\n    var maxY = 0;\n\n    for (var _iterator9 = graphs, _isArray9 = Array.isArray(_iterator9), _i10 = 0, _iterator9 = _isArray9 ? _iterator9 : _iterator9[Symbol.iterator]();;) {\n      var _ref12;\n\n      if (_isArray9) {\n        if (_i10 >= _iterator9.length) break;\n        _ref12 = _iterator9[_i10++];\n      } else {\n        _i10 = _iterator9.next();\n        if (_i10.done) break;\n        _ref12 = _i10.value;\n      }\n\n      var graph = _ref12;\n      maxY = Math.max.apply(Math, [maxY].concat(_toConsumableArray(graph.points)));\n    }\n\n    return maxY;\n  }\n\n  function setUpTimelineWindowHandle(side) {\n    var handle = side === 'left' ? timelineWindowLeftHandle : timelineWindowRightHandle;\n    var handleWidth = parseFloat(getComputedStyle(timelineWindow).borderLeftWidth);\n    var timelineCoordinates;\n    var minX;\n    var maxX;\n    var deltaX;\n    var startedX;\n\n    function onDrag(x) {\n      x = x - deltaX;\n      x = Math.max(Math.min(x, maxX), minX);\n      x = (x - timelineCoordinates.x) / timelineCoordinates.width;\n\n      if (side === 'left') {\n        timelineWindowFrom = x;\n      } else {\n        timelineWindowTo = x;\n      }\n\n      updateTimelineWindow();\n    }\n\n    function onDragStart(x) {\n      timelineCoordinates = timeline.getBoundingClientRect();\n      var timelineWindowCoordinates = timelineWindow.getBoundingClientRect();\n\n      if (side === 'left') {\n        minX = timelineCoordinates.x;\n        maxX = timelineWindowCoordinates.x + timelineWindowCoordinates.width - 2 * handleWidth;\n        deltaX = x - timelineWindowCoordinates.x;\n      } else {\n        minX = timelineWindowCoordinates.x + 2 * handleWidth;\n        maxX = timelineCoordinates.x + timelineCoordinates.width;\n        deltaX = x - (timelineWindowCoordinates.x + timelineWindowCoordinates.width);\n      }\n    }\n\n    return setUpDrag(handle, onDragStart, onDrag);\n  }\n\n  function setUpTimelineWindow() {\n    var timelineCoordinates;\n    var timelineWindowCoordinates;\n    var minX;\n    var maxX;\n    var innerX;\n\n    function onDrag(x) {\n      x = x - innerX;\n      x = Math.max(Math.min(x, maxX), minX);\n      x = (x - timelineCoordinates.x) / timelineCoordinates.width;\n      timelineWindowFrom = x;\n      timelineWindowTo = x + timelineWindowCoordinates.width / timelineCoordinates.width;\n      updateTimelineWindow();\n    }\n\n    function onDragStart(x) {\n      timelineCoordinates = timeline.getBoundingClientRect();\n      timelineWindowCoordinates = timelineWindow.getBoundingClientRect();\n      innerX = x - timelineWindowCoordinates.x;\n      minX = timelineCoordinates.x;\n      maxX = timelineCoordinates.x + (timelineCoordinates.width - timelineWindowCoordinates.width);\n    }\n\n    return setUpDrag(timelineWindowDrag, onDragStart, onDrag);\n  }\n\n  function setUpDrag(element, onDragStart, onDrag) {\n    function onTouchMove(event) {\n      onDrag(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\n    }\n\n    function onPointerMove(event) {\n      onDrag(event.clientX, event.clientY);\n    }\n\n    function onDragStop() {\n      window.removeEventListener('pointermove', onPointerMove);\n      window.removeEventListener('touchmove', onTouchMove);\n      window.removeEventListener('pointerup', onDragStop);\n      window.removeEventListener('pointercancel', onDragStop);\n      window.removeEventListener('touchend', onDragStop);\n      window.removeEventListener('touchcancel', onDragStop);\n    }\n\n    function onTouchStart(event) {\n      // Ignore multitouch.\n      if (event.touches.length > 1) {\n        // Reset.\n        return onDragStop();\n      }\n\n      onDragStart(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\n      window.addEventListener('touchmove', onTouchMove);\n      window.addEventListener('touchend', onDragStop);\n      window.addEventListener('touchcancel', onDragStop);\n    } // Safari doesn't support pointer events.\n    // https://caniuse.com/#feat=pointer\n\n\n    element.addEventListener('touchstart', onTouchStart);\n\n    function onPointerDown(event) {\n      onDragStart(event.clientX, event.clientY);\n      window.addEventListener('pointermove', onPointerMove);\n      window.addEventListener('pointerup', onDragStop);\n      window.addEventListener('pointercancel', onDragStop);\n    }\n\n    element.addEventListener('pointerdown', onPointerDown);\n    return function () {\n      onDragStop();\n      element.removeEventListener(onPointerDown);\n      element.removeEventListener(onTouchStart);\n    };\n  }\n\n  function setTimelineWindowLeft(x) {\n    timelineOverlayLeft.style.right = \"\".concat(100 * (1 - x), \"%\");\n    timelineWindow.style.left = \"\".concat(100 * x, \"%\");\n  }\n\n  function setTimelineWindowRight(x) {\n    timelineOverlayRight.style.left = \"\".concat(100 * x, \"%\");\n    timelineWindow.style.right = \"\".concat(100 * (1 - x), \"%\");\n  }\n\n  function updateTimelineWindow() {\n    setTimelineWindowLeft(timelineWindowFrom);\n    setTimelineWindowRight(timelineWindowTo);\n    drawGraphs(false);\n  }\n\n  function setUpCanvas() {\n    var canvasDimensions;\n    var isIndexInBounds;\n\n    function onTrack(screenX) {\n      var xScreenRatio = (screenX - canvasDimensions.x) / canvasDimensions.width;\n      var x = timelineWindowMinX + xScreenRatio * (timelineWindowMaxX - timelineWindowMinX);\n      var xHigherIndex = timelineWindowX.findIndex(function (_) {\n        return _ >= x;\n      });\n      var xLowerIndex = xHigherIndex - 1;\n\n      if (!isIndexInBounds(xHigherIndex)) {\n        xHigherIndex = -1;\n      }\n\n      if (!isIndexInBounds(xLowerIndex)) {\n        xLowerIndex = -1;\n      }\n\n      if (xHigherIndex < 0) {\n        if (xLowerIndex < 0) {\n          return removeTooltip();\n        } else {\n          x = timelineWindowX[xLowerIndex];\n        }\n      } else {\n        if (xLowerIndex < 0) {\n          x = timelineWindowX[xHigherIndex];\n        } else {\n          var xLower = timelineWindowX[xLowerIndex];\n          var xHigher = timelineWindowX[xHigherIndex];\n          var deltaLower = x - xLower;\n          var deltaHigher = xHigher - x;\n          x = deltaLower > deltaHigher ? xHigher : xLower;\n        }\n      }\n\n      if (x !== tooltipForX) {\n        tooltipForX = x;\n\n        if (!tooltip) {\n          addTooltip();\n        }\n\n        var date = new Date(x * data.x.normalized.scale + data.x.normalized.shift);\n        tooltipDate.textContent = \"\".concat(WEEKDAYS[date.getDay()], \", \").concat(MONTHS[date.getMonth()], \" \").concat(date.getDate());\n        var xIndex = timelineWindowX.indexOf(x);\n        var i = 0;\n\n        while (2 * i < tooltipValues.childNodes.length) {\n          tooltipValues.childNodes[2 * i].textContent = timelineWindowGraphs[i].points[xIndex];\n          tooltipValues.childNodes[2 * i + 1].textContent = data.lines[i].name;\n          i++;\n        }\n\n        var xRatio = (x - timelineWindowMinX) / (timelineWindowMaxX - timelineWindowMinX);\n        tooltip.style.left = \"\".concat(xRatio * 100, \"%\");\n        updateTooltipPoints(xIndex, xRatio);\n        updateTooltipLine(x);\n      }\n    }\n\n    function onTrackStart() {\n      canvasDimensions = canvas.getBoundingClientRect();\n\n      isIndexInBounds = function isIndexInBounds(index) {\n        if (index < 0) {\n          return false;\n        }\n\n        return timelineWindowX[index] >= timelineWindowMinX && timelineWindowX[index] <= timelineWindowMaxX;\n      };\n    }\n\n    function onTouchStart(event) {\n      // Ignore multitouch.\n      if (event.touches.length > 1) {\n        // Reset.\n        return onTrackStop();\n      }\n\n      onTrackStart();\n      canvas.addEventListener('touchend', onTrackStop);\n      canvas.addEventListener('touchmove', onTouchMove);\n      canvas.addEventListener('touchend', onTrackStop);\n      canvas.addEventListener('touchcancel', onTrackStop);\n      onTouchMove(event);\n    } // Safari doesn't support pointer events.\n    // https://caniuse.com/#feat=pointer\n\n\n    canvas.addEventListener('touchstart', onTouchStart);\n\n    function onTouchMove(event) {\n      var x = event.changedTouches[0].clientX;\n      var y = event.changedTouches[0].clientY; // Emulate 'pointerleave' behavior.\n\n      if (x < canvasDimensions.x || x > canvasDimensions.x + canvasDimensions.width || y < canvasDimensions.y || y > canvasDimensions.y + canvasDimensions.height) {\n        onTrackStop();\n      } else {\n        onTrack(x, y);\n      }\n    }\n\n    function onPointerMove(event) {\n      onTrack(event.clientX, event.clientY);\n    }\n\n    function onTrackStop() {\n      canvas.removeEventListener('pointermove', onPointerMove);\n      canvas.removeEventListener('pointerleave', onTrackStop);\n      canvas.removeEventListener('pointercancel', onTrackStop);\n      canvas.removeEventListener('touchmove', onTouchMove);\n      canvas.removeEventListener('touchend', onTrackStop);\n      canvas.removeEventListener('touchcancel', onTrackStop);\n      removeTooltip();\n    }\n\n    function onPointerEnter() {\n      onTrackStart();\n      canvas.addEventListener('pointermove', onPointerMove);\n      canvas.addEventListener('pointerleave', onTrackStop);\n      canvas.addEventListener('pointercancel', onTrackStop);\n    }\n\n    canvas.addEventListener('pointerenter', onPointerEnter);\n    return function () {\n      onTrackStop();\n      canvas.removeEventListener(onPointerEnter);\n      canvas.removeEventListener(onTouchStart);\n    };\n  }\n\n  function addTooltip() {\n    // Create tooltip.\n    tooltip = document.createElement('div');\n    tooltip.classList.add('chartogram__tooltip');\n    tooltipContainer.appendChild(tooltip); // Add tooltip title.\n\n    tooltipDate = document.createElement('h1');\n    tooltipDate.classList.add('chartogram__tooltip-header');\n    tooltip.appendChild(tooltipDate); // Add graph values.\n\n    tooltipValues = document.createElement('dl');\n    tooltipValues.classList.add('chartogram__tooltip-values');\n    tooltip.appendChild(tooltipValues); // Add graph values.\n\n    for (var _iterator10 = data.lines, _isArray10 = Array.isArray(_iterator10), _i11 = 0, _iterator10 = _isArray10 ? _iterator10 : _iterator10[Symbol.iterator]();;) {\n      var _ref13;\n\n      if (_isArray10) {\n        if (_i11 >= _iterator10.length) break;\n        _ref13 = _iterator10[_i11++];\n      } else {\n        _i11 = _iterator10.next();\n        if (_i11.done) break;\n        _ref13 = _i11.value;\n      }\n\n      var line = _ref13;\n\n      if (showGraphs[line.id]) {\n        // Add graph value.\n        var tooltipValue = document.createElement('dt');\n        tooltipValue.style.color = line.color;\n        tooltipValues.appendChild(tooltipValue); // Add graph name.\n\n        var tooltipName = document.createElement('dd');\n        tooltipName.style.color = line.color;\n        tooltipValues.appendChild(tooltipName);\n      }\n    }\n  }\n\n  function removeTooltip() {\n    if (tooltip) {\n      tooltipForX = undefined;\n      tooltipContainer.removeChild(tooltip);\n      tooltip = undefined;\n      removeTooltipPoints();\n      removeTooltipLine();\n    }\n  }\n\n  function addTooltipLine() {\n    var xmlns = 'http://www.w3.org/2000/svg';\n    tooltipLine = document.createElementNS(xmlns, 'line');\n    tooltipLine.setAttributeNS(null, 'class', 'chartogram__tooltip-line');\n    canvas.insertBefore(tooltipLine, canvas.querySelector('polyline'));\n  }\n\n  function removeTooltipLine() {\n    canvas.removeChild(tooltipLine);\n    tooltipLine = undefined;\n  }\n\n  function addTooltipPoints() {\n    tooltipPoints = [];\n    var i = 0;\n\n    while (i < timelineWindowGraphs.length) {\n      var point = document.createElement('div');\n      point.classList.add('chartogram__tooltip-point');\n      point.style.color = timelineWindowGraphs[i].color;\n      tooltipPoints.push(point);\n      canvasWrapper.appendChild(point);\n      i++;\n    }\n  }\n\n  function removeTooltipPoints() {\n    for (var _iterator11 = tooltipPoints, _isArray11 = Array.isArray(_iterator11), _i12 = 0, _iterator11 = _isArray11 ? _iterator11 : _iterator11[Symbol.iterator]();;) {\n      var _ref14;\n\n      if (_isArray11) {\n        if (_i12 >= _iterator11.length) break;\n        _ref14 = _iterator11[_i12++];\n      } else {\n        _i12 = _iterator11.next();\n        if (_i12.done) break;\n        _ref14 = _i12.value;\n      }\n\n      var point = _ref14;\n      canvasWrapper.removeChild(point);\n    }\n\n    tooltipPoints = undefined;\n  }\n\n  function updateTooltipLine(x) {\n    if (!tooltipLine) {\n      addTooltipLine();\n    }\n\n    tooltipLine.setAttributeNS(null, 'x1', fixSvgCoordinate(x));\n    tooltipLine.setAttributeNS(null, 'x2', fixSvgCoordinate(x));\n    tooltipLine.setAttributeNS(null, 'y1', fixSvgCoordinate(timelineWindowMinY));\n    tooltipLine.setAttributeNS(null, 'y2', fixSvgCoordinate(timelineWindowMaxY));\n  }\n\n  function updateTooltipPoints(xIndex, xRatio) {\n    if (!tooltipPoints) {\n      addTooltipPoints();\n    }\n\n    var i = 0;\n\n    while (i < tooltipPoints.length) {\n      var point = tooltipPoints[i];\n      point.style.left = \"\".concat(xRatio * 100, \"%\");\n      var y = timelineWindowGraphs[i].normalized.points[xIndex];\n      var yRatio = y / timelineWindowMaxY;\n      point.style.bottom = \"\".concat(yRatio * 100, \"%\");\n      i++;\n    }\n  }\n}\n//# sourceMappingURL=index.js.map"],"names":["_slicedToArray","arr","i","Array","isArray","_arrayWithHoles","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","value","length","err","_iterableToArrayLimit","TypeError","_nonIterableRest","_objectSpread","target","arguments","source","ownKeys","Object","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","defineProperty","configurable","writable","_toConsumableArray","arr2","_arrayWithoutHoles","iter","prototype","toString","call","from","_iterableToArray","_nonIterableSpread","rootNode","data","title","options","innerHTML","classList","add","timelineWindowFrom","timelineWindowTo","showGraphs","timelineWindowGraphs","timelineWindowMinX","timelineWindowMaxX","timelineWindowMinY","timelineWindowMaxY","timelineWindowX","tooltip","tooltipDate","tooltipValues","tooltipForX","tooltipPoints","tooltipLine","GAUGE_TICK_MARKS_COUNT","gaugeMarkTicksCount","TIMELINE_WINDOW_SIZE","timelineWindowSize","MONTHS","timelineChartMaxPoints","months","WEEKDAYS","weekdays","tooltipContainer","document","querySelector","canvas","canvasWrapper","xAxis","yAxis","timeline","timelineOverlayLeft","timelineWindowLeftHandle","timelineWindow","timelineWindowDrag","timelineWindowRightHandle","timelineOverlayRight","timelineCanvas","yScale","clearElement","element","firstChild","removeChild","createPolylinePoints","x","y","a","map","fixSvgCoordinate","b","ai","Math","round","Number","MAX_SAFE_INTEGER","drawGauge","min","max","transform","tickMark","createElement","appendChild","createTextNode","normalizePoints","all","isX","Infinity","_iterator","_isArray","_i2","_ref","one","points","apply","shift","scale","_iterator2","_isArray2","_i3","_ref2","_one","normalized","_","drawGraphs","redrawTimeline","xPoints","minXOverall","maxXOverall","deltaX","minX","maxX","minXIndex","findIndex","maxXIndex","slice","maxY","_iterator5","lines","_isArray5","_i6","_ref5","line","id","minXNormalized","maxXNormalized","minYNormalized","maxYNormalized","setAttribute","maxY_","n","divider","getLowerSiblingDivisibleBy","yAxisScale","_iterator6","divideInterval","_isArray6","_i7","_ref6","createGridLine","_x","_minX","_maxX","trimLeftRatio","trimRightRatio","_iterator7","_isArray7","_i8","_ref7","_ref8","color","_y","_minY","_maxY","graph","join","minY","timestamp","date","Date","getMonth","getDate","style","height","drawGauges","graphs","_iterator8","_isArray8","_i9","_ref9","_ref10","_simplifyGraph","simplifyGraph","_simplifyGraph2","drawTimeline","maxPoints","yMax","threshold","y0","abs","createGraphToggler","_ref11","name","toggler","xmlns","check","createElementNS","setAttributeNS","backgroundCircle","checkCircle","checkMark","addEventListener","show","toggle","setUpTimelineWindowHandle","side","timelineCoordinates","handle","handleWidth","parseFloat","getComputedStyle","borderLeftWidth","setUpDrag","getBoundingClientRect","timelineWindowCoordinates","width","updateTimelineWindow","onDragStart","onDrag","onTouchMove","event","changedTouches","clientX","clientY","onPointerMove","onDragStop","window","removeEventListener","onTouchStart","touches","onPointerDown","right","left","setTimelineWindowRight","removeTooltip","_iterator11","_isArray11","_i12","_ref14","point","removeTooltipPoints","innerX","_iterator3","_isArray3","_i4","_ref3","xMin","xMax","xFrom","graphTogglers","_iterator4","_isArray4","_i5","_ref4","_line","displayGraphs","canvasDimensions","isIndexInBounds","onTrack","screenX","xScreenRatio","xHigherIndex","xLowerIndex","xLower","xHigher","deltaLower","deltaHigher","_iterator10","_isArray10","_i11","_ref13","tooltipValue","tooltipName","addTooltip","textContent","getDay","xIndex","indexOf","childNodes","xRatio","addTooltipPoints","yRatio","bottom","updateTooltipPoints","insertBefore","updateTooltipLine","onTrackStart","index","onTrackStop","onPointerEnter","setUpCanvas"],"mappings":"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"}