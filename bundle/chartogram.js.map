{"version":3,"file":"chartogram.js","sources":["../modules/utility.js","../modules/Timeline.js","../modules/Togglers.js","../modules/Tooltip.js","../modules/Chartogram.js","../modules/index.js"],"sourcesContent":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nexport function clearElement(element) {\n  while (element.firstChild) {\n    element.removeChild(element.firstChild);\n  }\n}\nexport function commaJoin(a, b) {\n  return a.map(function (ai, i) {\n    return \"\".concat(ai, \",\").concat(b[i]);\n  });\n}\nexport function getLowerSiblingDivisibleBy(n, divider) {\n  n = Math.floor(n);\n\n  while (true) {\n    if (n < divider) {\n      return divider;\n    }\n\n    if (n % divider === 0) {\n      return n;\n    }\n\n    n--;\n  }\n}\nexport function divideInterval(min, max, GAUGE_TICK_MARKS_COUNT) {\n  var points = new Array(GAUGE_TICK_MARKS_COUNT);\n  var i = 0;\n\n  while (i < GAUGE_TICK_MARKS_COUNT) {\n    points[i] = min + i * (max - min) / (GAUGE_TICK_MARKS_COUNT - 1);\n    i++;\n  }\n\n  return points;\n}\nexport function renderGaugeLabels(element, min, max, GAUGE_TICK_MARKS_COUNT, transform) {\n  var i = 0;\n\n  while (i < GAUGE_TICK_MARKS_COUNT) {\n    var tickMark = document.createElement('div');\n    var value = min + i * (max - min) / (GAUGE_TICK_MARKS_COUNT - 1);\n\n    if (transform) {\n      value = transform(value);\n    }\n\n    tickMark.appendChild(document.createTextNode(value));\n    element.appendChild(tickMark);\n    i++;\n  }\n}\nexport function throttle(func, interval) {\n  var timeout;\n  var executedAt = 0;\n\n  var scheduled = function scheduled() {\n    timeout = undefined;\n    executedAt = Date.now();\n    func();\n  };\n\n  return function () {\n    var now = Date.now();\n    var remaining = interval - (now - executedAt);\n\n    if (remaining <= 0) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = undefined;\n      }\n\n      executedAt = now;\n      func();\n    } else if (!timeout) {\n      timeout = setTimeout(scheduled, remaining);\n    }\n  };\n}\nexport function simplifyGraph(x, y, maxPoints) {\n  var yMax = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Math.max.apply(Math, _toConsumableArray(y));\n  var threshold = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0.025;\n  var i = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n  var _x = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new Array(x.length);\n\n  var _y = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : new Array(x.length);\n\n  var _i = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : 0;\n\n  if (i + 2 > x.length - 1) {\n    while (i < y.length) {\n      _x[_i] = x[i];\n      _y[_i] = y[i];\n      _i++;\n      i++;\n    }\n\n    _x = _x.slice(0, _i);\n    _y = _y.slice(0, _i);\n\n    if (_x.length <= maxPoints) {\n      return [_x, _y];\n    } else {\n      if (x.length / _x.length < 1.1) {\n        threshold = Math.min(threshold + 0.025, 1);\n      }\n\n      return simplifyGraph(_x, _y, maxPoints, yMax, threshold);\n    }\n  }\n\n  var y0 = (y[i + 2] + y[i]) / 2;\n\n  if (Math.abs(y0 - y[i + 1]) / yMax < threshold) {\n    _x[_i] = x[i];\n    _x[_i + 1] = x[i + 2];\n    _y[_i] = y[i];\n    _y[_i + 1] = y[i + 2];\n    return simplifyGraph(x, y, maxPoints, yMax, threshold, i + 2, _x, _y, _i + 1);\n  } else {\n    _x[_i] = x[i];\n    _x[_i + 1] = x[i + 1];\n    _x[_i + 2] = x[i + 2];\n    _y[_i] = y[i];\n    _y[_i + 1] = y[i + 1];\n    _y[_i + 2] = y[i + 2];\n    return simplifyGraph(x, y, maxPoints, yMax, threshold, i + 2, _x, _y, _i + 2);\n  }\n}\nexport function setUpDrag(element, onDragStart, onDrag) {\n  function onTouchMove(event) {\n    onDrag(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\n  }\n\n  function onPointerMove(event) {\n    onDrag(event.clientX, event.clientY);\n  }\n\n  function onDragStop() {\n    window.removeEventListener('pointermove', onPointerMove);\n    window.removeEventListener('touchmove', onTouchMove);\n    window.removeEventListener('pointerup', onDragStop);\n    window.removeEventListener('pointercancel', onDragStop);\n    window.removeEventListener('touchend', onDragStop);\n    window.removeEventListener('touchcancel', onDragStop);\n  }\n\n  function onTouchStart(event) {\n    // Ignore multitouch.\n    if (event.touches.length > 1) {\n      // Reset.\n      return onDragStop();\n    }\n\n    onDragStart(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\n    window.addEventListener('touchmove', onTouchMove);\n    window.addEventListener('touchend', onDragStop);\n    window.addEventListener('touchcancel', onDragStop);\n  } // Safari doesn't support pointer events.\n  // https://caniuse.com/#feat=pointer\n\n\n  element.addEventListener('touchstart', onTouchStart);\n\n  function onPointerDown(event) {\n    onDragStart(event.clientX, event.clientY);\n    window.addEventListener('pointermove', onPointerMove);\n    window.addEventListener('pointerup', onDragStop);\n    window.addEventListener('pointercancel', onDragStop);\n  }\n\n  element.addEventListener('pointerdown', onPointerDown);\n  return function () {\n    onDragStop();\n    element.removeEventListener(onPointerDown);\n    element.removeEventListener(onTouchStart);\n  };\n}\n//# sourceMappingURL=utility.js.map","function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { clearElement, commaJoin, simplifyGraph, throttle, setUpDrag } from './utility';\n\nvar Timeline =\n/*#__PURE__*/\nfunction () {\n  function Timeline(props) {\n    var _this = this;\n\n    _classCallCheck(this, Timeline);\n\n    _defineProperty(this, \"onResize\", function (event) {\n      _this.setState({\n        aspectRatio: _this.getCanvasAspectRatio()\n      });\n    });\n\n    _defineProperty(this, \"onResizeThrottled\", throttle(this.onResize, 33));\n\n    _defineProperty(this, \"setState\", function (newState) {\n      _this.state = _objectSpread({}, _this.state, newState);\n\n      _this.render();\n    });\n\n    _defineProperty(this, \"mapX\", function (x) {\n      var _this$props = _this.props,\n          canvasWidth = _this$props.canvasWidth,\n          data = _this$props.data;\n      var minX = data.minX,\n          maxX = data.maxX;\n      return (x - minX) / (maxX - minX) * canvasWidth;\n    });\n\n    _defineProperty(this, \"mapY\", function (y) {\n      var _this$props2 = _this.props,\n          canvasWidth = _this$props2.canvasWidth,\n          minYGlobal = _this$props2.minYGlobal,\n          maxYGlobal = _this$props2.maxYGlobal;\n      var aspectRatio = _this.state.aspectRatio;\n      return (y - minYGlobal) / (maxYGlobal - minYGlobal) * canvasWidth / aspectRatio;\n    });\n\n    _defineProperty(this, \"setUpTimelineWindowHandle\", function (side) {\n      var handle = side === 'left' ? _this.timelineWindowLeftHandle : _this.timelineWindowRightHandle;\n      var handleWidth = parseFloat(getComputedStyle(_this.timelineWindow).borderLeftWidth);\n      var timelineCoordinates;\n      var minX;\n      var maxX;\n      var deltaX;\n      var startedX;\n\n      var onDrag = function onDrag(x) {\n        x -= deltaX;\n        x = Math.max(Math.min(x, maxX), minX);\n        var ratio = (x - timelineCoordinates.left) / timelineCoordinates.width;\n\n        if (side === 'left') {\n          _this.updateBounds(ratio, _this.props.toRatio);\n        } else {\n          _this.updateBounds(_this.props.fromRatio, ratio);\n        }\n      };\n\n      var onDragStart = function onDragStart(x) {\n        timelineCoordinates = _this.timeline.getBoundingClientRect();\n\n        var timelineWindowCoordinates = _this.timelineWindow.getBoundingClientRect();\n\n        if (side === 'left') {\n          minX = timelineCoordinates.left;\n          maxX = timelineWindowCoordinates.left + timelineWindowCoordinates.width - 2 * handleWidth;\n          deltaX = x - timelineWindowCoordinates.left;\n        } else {\n          minX = timelineWindowCoordinates.left + 2 * handleWidth;\n          maxX = timelineCoordinates.left + timelineCoordinates.width;\n          deltaX = x - (timelineWindowCoordinates.left + timelineWindowCoordinates.width);\n        }\n      };\n\n      return setUpDrag(handle, onDragStart, onDrag);\n    });\n\n    _defineProperty(this, \"setUpTimelineWindow\", function () {\n      var timelineCoordinates;\n      var timelineWindowCoordinates;\n      var minX;\n      var maxX;\n      var innerX;\n\n      var onDrag = function onDrag(x) {\n        x -= innerX;\n        x = Math.max(Math.min(x, maxX), minX);\n        var ratio = (x - timelineCoordinates.left) / timelineCoordinates.width;\n\n        _this.updateBounds(ratio, ratio + timelineWindowCoordinates.width / timelineCoordinates.width);\n      };\n\n      var onDragStart = function onDragStart(x) {\n        timelineCoordinates = _this.timeline.getBoundingClientRect();\n        timelineWindowCoordinates = _this.timelineWindow.getBoundingClientRect();\n        innerX = x - timelineWindowCoordinates.left;\n        minX = timelineCoordinates.left;\n        maxX = timelineCoordinates.left + (timelineCoordinates.width - timelineWindowCoordinates.width);\n      };\n\n      return setUpDrag(_this.timelineWindowDrag, onDragStart, onDrag);\n    });\n\n    _defineProperty(this, \"setTimelineWindowLeft\", function (ratio) {\n      _this.timelineOverlayLeft.style.right = \"\".concat(100 * (1 - ratio), \"%\");\n      _this.timelineWindow.style.left = \"\".concat(100 * ratio, \"%\");\n    });\n\n    _defineProperty(this, \"setTimelineWindowRight\", function (ratio) {\n      _this.timelineOverlayRight.style.left = \"\".concat(100 * ratio, \"%\");\n      _this.timelineWindow.style.right = \"\".concat(100 * (1 - ratio), \"%\");\n    });\n\n    this.props = props;\n  }\n\n  _createClass(Timeline, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(props) {\n      if (this.props !== props) {\n        this.props = props;\n        this.state = {\n          aspectRatio: this.getCanvasAspectRatio()\n        };\n        this.onChangeBounds(this.props.fromRatio, this.props.toRatio), this.render();\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var rootNode = this.props.rootNode;\n      this.timeline = rootNode.querySelector('.chartogram__timeline');\n      this.timelineOverlayLeft = rootNode.querySelector('.chartogram__timeline-overlay-left');\n      this.timelineWindowLeftHandle = rootNode.querySelector('.chartogram__timeline-window__left-handle');\n      this.timelineWindow = rootNode.querySelector('.chartogram__timeline-window');\n      this.timelineWindowDrag = rootNode.querySelector('.chartogram__timeline-window__drag');\n      this.timelineWindowRightHandle = rootNode.querySelector('.chartogram__timeline-window__right-handle');\n      this.timelineOverlayRight = rootNode.querySelector('.chartogram__timeline-overlay-right');\n      this.timelineCanvas = rootNode.querySelector('.chartogram__timeline-canvas');\n      this.state = {\n        aspectRatio: this.getCanvasAspectRatio()\n      };\n      this.setUpTimelineWindowHandle('left');\n      this.setUpTimelineWindowHandle('right');\n      this.setUpTimelineWindow(); // Add window resize event listener.\n\n      window.addEventListener('resize', this.onResizeThrottled);\n      this.onChangeBounds(this.props.fromRatio, this.props.toRatio);\n      this.render();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      // Remove window resize event listener.\n      window.removeEventListener('resize', this.onResizeThrottled);\n    }\n  }, {\n    key: \"getCanvasAspectRatio\",\n    value: function getCanvasAspectRatio() {\n      var timelineCanvasDimensions = this.timelineCanvas.getBoundingClientRect();\n      return timelineCanvasDimensions.width / timelineCanvasDimensions.height;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props3 = this.props,\n          canvasWidth = _this$props3.canvasWidth,\n          y = _this$props3.y,\n          data = _this$props3.data,\n          maxYGlobal = _this$props3.maxYGlobal,\n          fixSvgCoordinate = _this$props3.fixSvgCoordinate,\n          createPolylinePoints = _this$props3.createPolylinePoints,\n          graphOpacity = _this$props3.graphOpacity;\n      var aspectRatio = this.state.aspectRatio; // Clear canvas.\n\n      clearElement(this.timelineCanvas); // Set canvas `viewBox`.\n\n      this.timelineCanvas.setAttribute('viewBox', \"0 0 \".concat(canvasWidth, \" \").concat(fixSvgCoordinate(canvasWidth / aspectRatio))); // Draw graphs.\n\n      var i = 0;\n\n      var _loop = function _loop() {\n        var _data$y$i = data.y[i],\n            id = _data$y$i.id,\n            color = _data$y$i.color,\n            points = _data$y$i.points;\n        var opacity = graphOpacity[i];\n        var isShown = y.find(function (_) {\n          return _.id === id;\n        }).isShown;\n\n        if (isShown || opacity > 0) {\n          var _simplifyGraph = simplifyGraph(data.x.points, points, 80),\n              _simplifyGraph2 = _slicedToArray(_simplifyGraph, 2),\n              _x = _simplifyGraph2[0],\n              _y = _simplifyGraph2[1];\n\n          var graph = document.createElement('polyline');\n          graph.setAttribute('stroke', color);\n          graph.setAttribute('points', createPolylinePoints(_x.map(_this2.mapX), _y.map(function (y) {\n            return _this2.mapY(maxYGlobal - y);\n          })).join(' '));\n          graph.classList.add('chartogram__graph');\n\n          if (opacity !== 1) {\n            graph.style.opacity = opacity;\n          }\n\n          _this2.timelineCanvas.appendChild(graph);\n        }\n\n        i++;\n      };\n\n      while (i < data.y.length) {\n        _loop();\n      } // A workaround to fix WebKit bug when it's not re-rendering the <svg/>.\n      // https://stackoverflow.com/questions/30905493/how-to-force-webkit-to-update-svg-use-elements-after-changes-to-original\n\n\n      this.timelineCanvas.innerHTML += '';\n    }\n  }, {\n    key: \"onChangeBounds\",\n    value: function onChangeBounds(from, to) {\n      this.setTimelineWindowLeft(from);\n      this.setTimelineWindowRight(to);\n    }\n  }, {\n    key: \"updateBounds\",\n    value: function updateBounds(from, to) {\n      this.props.onChangeBounds(from, to);\n      this.props.fromRatio = from;\n      this.props.toRatio = to;\n      this.onChangeBounds(from, to);\n    }\n  }]);\n\n  return Timeline;\n}();\n\nexport { Timeline as default };\nTimeline.INITIAL_MARKUP = \"\\n\\t<div class=\\\"chartogram__timeline\\\">\\n\\t\\t<div class=\\\"chartogram__timeline-canvas-padding\\\">\\n\\t\\t\\t<svg class=\\\"chartogram__timeline-canvas\\\" preserveAspectRatio=\\\"none\\\"></svg>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"chartogram__timeline-overlay-left\\\"></div>\\n\\t\\t<div class=\\\"chartogram__timeline-overlay-right\\\"></div>\\n\\t\\t<div class=\\\"chartogram__timeline-window\\\">\\n\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__drag\\\"></button>\\n\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__left-handle\\\"></button>\\n\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__right-handle\\\"></button>\\n\\t\\t</div>\\n\\t</div>\\n\";\n//# sourceMappingURL=Timeline.js.map","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { clearElement } from './utility';\n\nvar Togglers =\n/*#__PURE__*/\nfunction () {\n  function Togglers(props) {\n    var _this = this;\n\n    _classCallCheck(this, Togglers);\n\n    _defineProperty(this, \"createGraphToggler\", function (_ref) {\n      var id = _ref.id,\n          name = _ref.name,\n          color = _ref.color;\n      var toggler = document.createElement('button');\n      toggler.setAttribute('type', 'button');\n      toggler.classList.add('chartogram__chart-toggler');\n      toggler.classList.add('chartogram__chart-toggler--on');\n      toggler.classList.add('chartogram__reset-button'); // Add check.\n\n      var xmlns = 'http://www.w3.org/2000/svg';\n      var check = document.createElementNS(xmlns, 'svg');\n      check.setAttribute('viewBox', '0 0 19 19');\n      check.setAttribute('class', 'chartogram__chart-toggler-check'); // Add background circle.\n\n      var backgroundCircle = document.createElementNS(xmlns, 'circle');\n      backgroundCircle.setAttribute('cx', '9.5');\n      backgroundCircle.setAttribute('cy', '9.5');\n      backgroundCircle.setAttribute('r', '9.5');\n      backgroundCircle.setAttribute('fill', color);\n      check.appendChild(backgroundCircle); // Add check circle.\n\n      var checkCircle = document.createElementNS(xmlns, 'circle');\n      checkCircle.setAttribute('cx', '9.5');\n      checkCircle.setAttribute('cy', '9.5');\n      checkCircle.setAttribute('r', '8');\n      checkCircle.setAttribute('class', 'chartogram__chart-toggler-check-circle');\n      check.appendChild(checkCircle); // Add check mark.\n\n      var checkMark = document.createElementNS(xmlns, 'path');\n      checkMark.setAttribute('d', 'M13.64 4.94l-6.2 6.34-1.69-1.9c-.73-.63-1.89.1-1.36 1.06l2 3.38c.3.43 1.04.85 1.78 0 .32-.42 6.31-7.93 6.31-7.93.74-.84-.2-1.58-.84-.95z');\n      checkMark.setAttribute('fill', 'white');\n      checkMark.setAttribute('class', 'chartogram__chart-toggler-check-mark');\n      check.appendChild(checkMark); // Add checkmark.\n\n      toggler.appendChild(check); // Add graph name.\n\n      toggler.appendChild(document.createTextNode(name)); // On click.\n\n      toggler.addEventListener('click', function () {\n        return _this.onToggle(id, toggler);\n      });\n      return toggler;\n    });\n\n    _defineProperty(this, \"onToggle\", function (id, toggler) {\n      var onToggle = _this.props.onToggle;\n\n      if (onToggle(id)) {\n        toggler.classList.toggle('chartogram__chart-toggler--on');\n      }\n    });\n\n    this.props = props;\n  }\n\n  _createClass(Togglers, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props = this.props,\n          rootNode = _this$props.rootNode,\n          data = _this$props.data; // Add graph togglers.\n\n      var graphTogglers = rootNode.querySelector('.chartogram__chart-togglers');\n      clearElement(graphTogglers);\n\n      for (var _iterator = data.y, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n        var _ref2;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref2 = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref2 = _i.value;\n        }\n\n        var y = _ref2;\n        graphTogglers.appendChild(this.createGraphToggler(y));\n      }\n    }\n  }]);\n\n  return Togglers;\n}();\n\nexport { Togglers as default };\nTogglers.INITIAL_MARKUP = \"\\n\\t<div class=\\\"chartogram__chart-togglers\\\"></div>\\n\";\n//# sourceMappingURL=Togglers.js.map","function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar Tooltip =\n/*#__PURE__*/\nfunction () {\n  function Tooltip(props) {\n    var _this = this;\n\n    _classCallCheck(this, Tooltip);\n\n    _defineProperty(this, \"setUpListener\", function () {\n      var _this$props = _this.props,\n          canvas = _this$props.canvas,\n          canvasWidthPx = _this$props.canvasWidthPx,\n          weekdays = _this$props.weekdays,\n          months = _this$props.months;\n      var canvasDimensions;\n      var isIndexInBounds;\n\n      var onTrack = function onTrack(screenX) {\n        var _this$props2 = _this.props,\n            minX = _this$props2.minX,\n            maxX = _this$props2.maxX,\n            xPoints = _this$props2.xPoints,\n            y = _this$props2.y;\n        var xScreenRatio = (screenX - canvasDimensions.left) / canvasDimensions.width;\n        var xPoint = minX + xScreenRatio * (maxX - minX);\n        var xHigherIndex = xPoints.findIndex(function (_) {\n          return _ >= xPoint;\n        });\n        var xLowerIndex = xHigherIndex - 1;\n\n        if (!isIndexInBounds(xHigherIndex)) {\n          xHigherIndex = -1;\n        }\n\n        if (!isIndexInBounds(xLowerIndex)) {\n          xLowerIndex = -1;\n        }\n\n        var xIndex;\n\n        if (xHigherIndex < 0) {\n          if (xLowerIndex < 0) {\n            return _this.unmount();\n          } else {\n            xIndex = xLowerIndex;\n          }\n        } else {\n          if (xLowerIndex < 0) {\n            xIndex = xHigherIndex;\n          } else {\n            var xLower = xPoints[xLowerIndex];\n            var xHigher = xPoints[xHigherIndex];\n            var deltaLower = xPoint - xLower;\n            var deltaHigher = xHigher - xPoint;\n            xIndex = deltaLower > deltaHigher ? xHigherIndex : xLowerIndex;\n          }\n        }\n\n        var x = xPoints[xIndex];\n\n        if (x !== _this.tooltipForX) {\n          _this.tooltipForX = x;\n\n          if (!_this.tooltip) {\n            _this.mount();\n          }\n\n          var date = new Date(x);\n          _this.tooltipDate.textContent = \"\".concat(weekdays[date.getDay()], \", \").concat(months[date.getMonth()], \" \").concat(date.getDate());\n          var i = 0;\n\n          for (var _iterator = y, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n            var _ref;\n\n            if (_isArray) {\n              if (_i >= _iterator.length) break;\n              _ref = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref = _i.value;\n            }\n\n            var _ref2 = _ref,\n                isShown = _ref2.isShown,\n                points = _ref2.points,\n                name = _ref2.name;\n\n            if (isShown) {\n              _this.tooltipValues.childNodes[2 * i].textContent = points[xIndex];\n              _this.tooltipValues.childNodes[2 * i + 1].textContent = name;\n              i++;\n            }\n          }\n\n          var xRatio = (x - minX) / (maxX - minX);\n          var left = xRatio * canvasWidthPx;\n          left -= 40;\n\n          var tooltipWidth = _this.tooltip.getBoundingClientRect().width;\n\n          var overflow = 5;\n\n          if (left < -1 * overflow) {\n            left = -1 * overflow;\n          } else if (left + tooltipWidth > canvasWidthPx + overflow) {\n            left = canvasWidthPx + overflow - tooltipWidth;\n          }\n\n          _this.tooltip.style.left = left + 'px';\n\n          _this.updatePoints(xIndex, xRatio);\n\n          _this.updateLine(x);\n        }\n      };\n\n      var onTrackStart = function onTrackStart() {\n        canvasDimensions = canvas.getBoundingClientRect();\n\n        isIndexInBounds = function isIndexInBounds(index) {\n          var xPoints = _this.props.xPoints;\n          return index >= 0 && index < xPoints.length;\n        };\n      };\n\n      var onTouchStart = function onTouchStart(event) {\n        // Ignore multitouch.\n        if (event.touches.length > 1) {\n          // Reset.\n          return onTrackStop();\n        }\n\n        onTrackStart();\n        canvas.addEventListener('touchend', onTrackStop);\n        canvas.addEventListener('touchmove', onTouchMove);\n        canvas.addEventListener('touchend', onTrackStop);\n        canvas.addEventListener('touchcancel', onTrackStop);\n        onTouchMove(event);\n      }; // Safari doesn't support pointer events.\n      // https://caniuse.com/#feat=pointer\n\n\n      canvas.addEventListener('touchstart', onTouchStart);\n\n      function onTouchMove(event) {\n        var x = event.changedTouches[0].clientX;\n        var y = event.changedTouches[0].clientY; // Emulate 'pointerleave' behavior.\n\n        if (x < canvasDimensions.left || x > canvasDimensions.left + canvasDimensions.width || y < canvasDimensions.top || y > canvasDimensions.top + canvasDimensions.height) {\n          onTrackStop();\n        } else {\n          onTrack(x, y);\n        }\n      }\n\n      function onPointerMove(event) {\n        onTrack(event.clientX, event.clientY);\n      }\n\n      var onTrackStop = function onTrackStop() {\n        canvas.removeEventListener('pointermove', onPointerMove);\n        canvas.removeEventListener('pointerleave', onTrackStop);\n        canvas.removeEventListener('pointercancel', onTrackStop);\n        canvas.removeEventListener('touchmove', onTouchMove);\n        canvas.removeEventListener('touchend', onTrackStop);\n        canvas.removeEventListener('touchcancel', onTrackStop);\n\n        _this.unmount();\n      };\n\n      var onPointerEnter = function onPointerEnter() {\n        onTrackStart();\n        canvas.addEventListener('pointermove', onPointerMove);\n        canvas.addEventListener('pointerleave', onTrackStop);\n        canvas.addEventListener('pointercancel', onTrackStop);\n      };\n\n      canvas.addEventListener('pointerenter', onPointerEnter);\n      return function () {\n        onTrackStop();\n        canvas.removeEventListener(onPointerEnter);\n        canvas.removeEventListener(onTouchStart);\n      };\n    });\n\n    _defineProperty(this, \"unmountLine\", function () {\n      var canvas = _this.props.canvas;\n      canvas.removeChild(_this.line);\n      _this.line = undefined;\n    });\n\n    _defineProperty(this, \"unmountPoints\", function () {\n      var pointsContainer = _this.props.pointsContainer;\n\n      for (var _iterator2 = _this.points, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n        var _ref3;\n\n        if (_isArray2) {\n          if (_i2 >= _iterator2.length) break;\n          _ref3 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) break;\n          _ref3 = _i2.value;\n        }\n\n        var point = _ref3;\n        pointsContainer.removeChild(point);\n      }\n\n      _this.points = undefined;\n    });\n\n    _defineProperty(this, \"updateLine\", function (x) {\n      if (!_this.isLineRendered()) {\n        _this.renderLine();\n      }\n\n      var _this$props3 = _this.props,\n          canvasWidth = _this$props3.canvasWidth,\n          aspectRatio = _this$props3.aspectRatio,\n          fixSvgCoordinate = _this$props3.fixSvgCoordinate,\n          mapX = _this$props3.mapX;\n\n      _this.line.setAttributeNS(null, 'x1', fixSvgCoordinate(mapX(x)));\n\n      _this.line.setAttributeNS(null, 'x2', fixSvgCoordinate(mapX(x)));\n\n      _this.line.setAttributeNS(null, 'y1', 0);\n\n      _this.line.setAttributeNS(null, 'y2', fixSvgCoordinate(canvasWidth / aspectRatio));\n    });\n\n    _defineProperty(this, \"updatePoints\", function (xIndex, xRatio) {\n      var _this$props4 = _this.props,\n          maxY = _this$props4.maxY,\n          y = _this$props4.y;\n      var i = 0;\n      var j = 0;\n\n      while (i < y.length) {\n        if (y[i].isShown) {\n          var point = _this.points[j];\n          var _y = y[i].points[xIndex];\n          var yRatio = _y / maxY;\n          point.style.left = \"\".concat(xRatio * 100, \"%\");\n          point.style.bottom = \"\".concat(yRatio * 100, \"%\");\n          j++;\n        }\n\n        i++;\n      }\n    });\n\n    this.props = props;\n  }\n\n  _createClass(Tooltip, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.unlisten = this.setUpListener();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unlisten();\n      this.unmount();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(props) {\n      if (this.props !== props) {\n        this.props = props;\n      }\n    }\n  }, {\n    key: \"mount\",\n    value: function mount() {\n      this.renderTooltip();\n      this.renderPoints();\n\n      if (!this.isLineRendered()) {\n        this.renderLine();\n      }\n    }\n  }, {\n    key: \"renderTooltip\",\n    value: function renderTooltip() {\n      var _this$props5 = this.props,\n          y = _this$props5.y,\n          container = _this$props5.container; // Create tooltip.\n\n      this.tooltip = document.createElement('div');\n      this.tooltip.classList.add('chartogram__tooltip');\n      container.appendChild(this.tooltip); // Add tooltip title.\n\n      this.tooltipDate = document.createElement('h1');\n      this.tooltipDate.classList.add('chartogram__tooltip-header');\n      this.tooltip.appendChild(this.tooltipDate); // Add graph values.\n\n      this.tooltipValues = document.createElement('dl');\n      this.tooltipValues.classList.add('chartogram__tooltip-values');\n      this.tooltip.appendChild(this.tooltipValues); // Add graph values.\n\n      for (var _iterator3 = y, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n        var _ref4;\n\n        if (_isArray3) {\n          if (_i3 >= _iterator3.length) break;\n          _ref4 = _iterator3[_i3++];\n        } else {\n          _i3 = _iterator3.next();\n          if (_i3.done) break;\n          _ref4 = _i3.value;\n        }\n\n        var _ref5 = _ref4,\n            isShown = _ref5.isShown,\n            color = _ref5.color;\n\n        if (isShown) {\n          // Add graph value.\n          var tooltipValue = document.createElement('dt');\n          tooltipValue.style.color = color;\n          this.tooltipValues.appendChild(tooltipValue); // Add graph name.\n\n          var tooltipName = document.createElement('dd');\n          tooltipName.style.color = color;\n          this.tooltipValues.appendChild(tooltipName);\n        }\n      }\n    }\n  }, {\n    key: \"renderLine\",\n    value: function renderLine() {\n      var canvas = this.props.canvas;\n      var xmlns = 'http://www.w3.org/2000/svg';\n      this.line = document.createElementNS(xmlns, 'line');\n      this.line.setAttribute('class', 'chartogram__tooltip-line');\n      canvas.insertBefore(this.line, canvas.querySelector('polyline'));\n    }\n  }, {\n    key: \"unmount\",\n    value: function unmount() {\n      if (this.tooltip) {\n        var container = this.props.container;\n        this.tooltipForX = undefined;\n        container.removeChild(this.tooltip);\n        this.tooltip = undefined;\n        this.unmountPoints();\n\n        if (this.isLineRendered()) {\n          this.unmountLine();\n        }\n      }\n    }\n  }, {\n    key: \"isLineRendered\",\n    value: function isLineRendered() {\n      var canvas = this.props.canvas;\n      return this.line && this.line.parentNode === canvas;\n    }\n  }, {\n    key: \"renderPoints\",\n    value: function renderPoints() {\n      this.points = [];\n      var _this$props6 = this.props,\n          pointsContainer = _this$props6.pointsContainer,\n          y = _this$props6.y;\n\n      for (var _iterator4 = y, _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n        var _ref6;\n\n        if (_isArray4) {\n          if (_i4 >= _iterator4.length) break;\n          _ref6 = _iterator4[_i4++];\n        } else {\n          _i4 = _iterator4.next();\n          if (_i4.done) break;\n          _ref6 = _i4.value;\n        }\n\n        var _y = _ref6;\n\n        if (_y.isShown) {\n          var point = document.createElement('div');\n          point.classList.add('chartogram__tooltip-point');\n          point.style.color = _y.color;\n          this.points.push(point);\n          pointsContainer.appendChild(point);\n        }\n      }\n    }\n  }]);\n\n  return Tooltip;\n}();\n\nexport { Tooltip as default };\n//# sourceMappingURL=Tooltip.js.map","function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { clearElement, commaJoin, getLowerSiblingDivisibleBy, divideInterval, throttle, renderGaugeLabels } from './utility';\nimport Timeline from './Timeline';\nimport Togglers from './Togglers';\nimport Tooltip from './Tooltip';\n\nvar Chartogram =\n/*#__PURE__*/\nfunction () {\n  function Chartogram(rootNode, data) {\n    var _this = this;\n\n    var title = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'Title';\n    var props = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n\n    _classCallCheck(this, Chartogram);\n\n    _defineProperty(this, \"onResize\", function (event) {\n      _this.setState({\n        aspectRatio: _this.getCanvasAspectRatio(),\n        canvasWidthPx: _this.getCanvasWidthPx()\n      }, false);\n    });\n\n    _defineProperty(this, \"onResizeThrottled\", throttle(this.onResize, 33));\n\n    _defineProperty(this, \"onToggle\", function (id) {\n      var y = _this.state.y.find(function (_) {\n        return _.id === id;\n      }); // Won't allow hiding all graphs.\n\n\n      if (y.isShown) {\n        var graphsShown = _this.state.y.filter(function (_) {\n          return _.isShown;\n        });\n\n        if (graphsShown.length === 1) {\n          return;\n        }\n      }\n\n      y.isShown = !y.isShown;\n\n      _this.setState({\n        y: _this.state.y\n      });\n\n      var _this$calculateMinMax = _this.calculateMinMaxY(_this.state.y),\n          minY = _this$calculateMinMax.minY,\n          maxY = _this$calculateMinMax.maxY,\n          minYGlobal = _this$calculateMinMax.minYGlobal,\n          maxYGlobal = _this$calculateMinMax.maxYGlobal;\n\n      _this.transitionState(minY, maxY, minYGlobal, maxYGlobal, _this.state.y.map(function (y) {\n        return y.isShown ? 1 : 0;\n      }));\n\n      return true;\n    });\n\n    _defineProperty(this, \"onChangeBounds\", function (from, to) {\n      _this.setState(_this.createState(from, to), false);\n    });\n\n    _defineProperty(this, \"createPolylinePoints\", function (x, y) {\n      // return commaJoin(x, y)\n      return commaJoin(x.map(_this.fixSvgCoordinate), y.map(_this.fixSvgCoordinate));\n    });\n\n    _defineProperty(this, \"fixSvgCoordinate\", function (x) {\n      var precisionFactor = _this.props.precisionFactor;\n      return Math.round(x * precisionFactor) / precisionFactor;\n    });\n\n    _defineProperty(this, \"mapX\", function (x) {\n      var canvasWidth = _this.props.canvasWidth;\n      var _this$state = _this.state,\n          minX = _this$state.minX,\n          maxX = _this$state.maxX;\n      return (x - minX) / (maxX - minX) * canvasWidth;\n    });\n\n    _defineProperty(this, \"mapY\", function (y) {\n      var canvasWidth = _this.props.canvasWidth;\n      var _this$state2 = _this.state,\n          minY = _this$state2.minY,\n          maxY = _this$state2.maxY,\n          aspectRatio = _this$state2.aspectRatio;\n      return (y - minY) / (maxY - minY) * canvasWidth / aspectRatio;\n    });\n\n    _defineProperty(this, \"transitionStateTick\", function () {\n      var transitionEasing = _this.props.transitionEasing;\n      var _this$state3 = _this.state,\n          transitionStartedAt = _this$state3.transitionStartedAt,\n          transitionDuration = _this$state3.transitionDuration,\n          graphOpacityFrom = _this$state3.graphOpacityFrom,\n          graphOpacityTo = _this$state3.graphOpacityTo,\n          minYFrom = _this$state3.minYFrom,\n          minYTo = _this$state3.minYTo,\n          maxYFrom = _this$state3.maxYFrom,\n          maxYTo = _this$state3.maxYTo,\n          minYGlobalFrom = _this$state3.minYGlobalFrom,\n          minYGlobalTo = _this$state3.minYGlobalTo,\n          maxYGlobalFrom = _this$state3.maxYGlobalFrom,\n          maxYGlobalTo = _this$state3.maxYGlobalTo;\n      var elapsed = Date.now() - transitionStartedAt;\n      var ratio = Math.min(elapsed / transitionDuration, 1);\n      ratio = EASING[transitionEasing](ratio);\n\n      _this.setState({\n        graphOpacity: graphOpacityTo.map(function (_, i) {\n          return graphOpacityFrom[i] + (graphOpacityTo[i] - graphOpacityFrom[i]) * ratio;\n        }),\n        minY: minYFrom + (minYTo - minYFrom) * ratio,\n        maxY: maxYFrom + (maxYTo - maxYFrom) * ratio,\n        minYGlobal: minYGlobalFrom + (minYGlobalTo - minYGlobalFrom) * ratio,\n        maxYGlobal: maxYGlobalFrom + (maxYGlobalTo - maxYGlobalFrom) * ratio\n      });\n\n      if (ratio < 1) {\n        _this.transition = requestAnimationFrame(_this.transitionStateTick);\n      } else {\n        _this.transition = undefined;\n      }\n    });\n\n    _defineProperty(this, \"createGridLine\", function (y) {\n      var _this$state4 = _this.state,\n          minX = _this$state4.minX,\n          maxX = _this$state4.maxX,\n          minY = _this$state4.minY,\n          maxY = _this$state4.maxY;\n      var line = document.createElement('line');\n      line.classList.add('chartogram__grid-line');\n      line.setAttribute('x1', _this.fixSvgCoordinate(_this.mapX(minX)));\n      line.setAttribute('x2', _this.fixSvgCoordinate(_this.mapX(maxX)));\n      line.setAttribute('y1', _this.fixSvgCoordinate(_this.mapY(maxY - y)));\n      line.setAttribute('y2', _this.fixSvgCoordinate(_this.mapY(maxY - y)));\n      return line;\n    });\n\n    _defineProperty(this, \"drawGauges\", function (minX, maxX, minY, maxY, yAxisScale) {\n      var _this$props = _this.props,\n          gaugeTickMarksCount = _this$props.gaugeTickMarksCount,\n          months = _this$props.months;\n      clearElement(_this.xAxis);\n      clearElement(_this.yAxis);\n      renderGaugeLabels(_this.xAxis, minX, maxX, gaugeTickMarksCount, function (timestamp) {\n        var date = new Date(timestamp);\n        return \"\".concat(months[date.getMonth()], \" \").concat(date.getDate());\n      });\n      renderGaugeLabels(_this.yAxis, minY, maxY, gaugeTickMarksCount);\n      _this.yAxis.style.height = \"\".concat(100 / yAxisScale, \"%\");\n    });\n\n    this.props = _objectSpread({\n      title: title,\n      transitionDuration: 300,\n      transitionEasing: 'easeOutQuad',\n      gaugeTickMarksCount: 6,\n      timelineWindowSize: 40,\n      canvasWidth: 512,\n      precisionFactor: Math.pow(10, props.precision || 3),\n      months: MONTHS,\n      weekdays: WEEKDAYS\n    }, props);\n    this.rootNode = rootNode;\n    this.data = _objectSpread({}, data, {\n      minX: Math.min.apply(Math, _toConsumableArray(data.x.points)),\n      maxX: Math.max.apply(Math, _toConsumableArray(data.x.points)),\n      y: data.y.map(function (y) {\n        return _objectSpread({}, y, {\n          min: Math.min.apply(Math, _toConsumableArray(y.points)),\n          max: Math.max.apply(Math, _toConsumableArray(y.points))\n        });\n      })\n    });\n  }\n\n  _createClass(Chartogram, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.rootNode.classList.add('chartogram');\n      this.rootNode.innerHTML = \"\\n\\t\\t\\t\".concat(INITIAL_MARKUP.replace('{title}', this.props.title), \"\\n\\t\\t\\t\").concat(Timeline.INITIAL_MARKUP, \"\\n\\t\\t\\t\").concat(Togglers.INITIAL_MARKUP, \"\\n\\t\\t\");\n      this.tooltipContainer = this.rootNode.querySelector('.chartogram__plan');\n      this.canvas = this.rootNode.querySelector('.chartogram__canvas');\n      this.canvasWrapper = this.rootNode.querySelector('.chartogram__canvas-wrapper');\n      this.xAxis = this.rootNode.querySelector('.chartogram__x');\n      this.yAxis = this.rootNode.querySelector('.chartogram__y'); // Render will be called after `.componentDidMount()`.\n\n      this.state = this.getInitialState();\n      this.timeline = new Timeline(this.getTimelineProps());\n      this.timeline.componentDidMount();\n      this.togglers = new Togglers(this.getTogglersProps());\n      this.togglers.componentDidMount();\n      this.tooltip = new Tooltip(this.getTooltipProps());\n      this.tooltip.componentDidMount(); // Add window resize event listener.\n\n      window.addEventListener('resize', this.onResizeThrottled);\n      this.render();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.timeline.componentWillUnmount();\n      this.rootNode.classList.remove('chartogram');\n      clearElement(this.rootNode); // Remove window resize event listener.\n\n      window.removeEventListener('resize', this.onResizeThrottled);\n    }\n  }, {\n    key: \"getCanvasAspectRatio\",\n    value: function getCanvasAspectRatio() {\n      var canvasDimensions = this.canvas.getBoundingClientRect();\n      return canvasDimensions.width / canvasDimensions.height;\n    }\n  }, {\n    key: \"getCanvasWidthPx\",\n    value: function getCanvasWidthPx() {\n      var canvasDimensions = this.canvas.getBoundingClientRect();\n      return canvasDimensions.width;\n    }\n  }, {\n    key: \"setState\",\n    value: function setState(newState) {\n      var renderTimeline = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      this.state = _objectSpread({}, this.state, newState);\n      this.render();\n\n      if (renderTimeline) {\n        this.timeline.componentDidUpdate(this.getTimelineProps());\n      }\n\n      this.tooltip.componentDidUpdate(this.getTooltipProps());\n    }\n  }, {\n    key: \"getTimelineProps\",\n    value: function getTimelineProps() {\n      return {\n        rootNode: this.rootNode,\n        data: this.data,\n        canvasWidth: this.props.canvasWidth,\n        fixSvgCoordinate: this.fixSvgCoordinate,\n        createPolylinePoints: this.createPolylinePoints,\n        fromRatio: this.state.fromRatio,\n        toRatio: this.state.toRatio,\n        minYGlobal: this.state.minYGlobal,\n        maxYGlobal: this.state.maxYGlobal,\n        y: this.state.y,\n        graphOpacity: this.state.graphOpacity,\n        onChangeBounds: this.onChangeBounds\n      };\n    }\n  }, {\n    key: \"getTogglersProps\",\n    value: function getTogglersProps() {\n      return {\n        rootNode: this.rootNode,\n        data: this.data,\n        onToggle: this.onToggle\n      };\n    }\n  }, {\n    key: \"getTooltipProps\",\n    value: function getTooltipProps() {\n      return {\n        canvas: this.canvas,\n        canvasWidthPx: this.state.canvasWidthPx,\n        container: this.tooltipContainer,\n        pointsContainer: this.canvasWrapper,\n        weekdays: this.props.weekdays,\n        months: this.props.months,\n        canvasWidth: this.props.canvasWidth,\n        aspectRatio: this.state.aspectRatio,\n        mapX: this.mapX,\n        fixSvgCoordinate: this.fixSvgCoordinate,\n        minX: this.state.minX,\n        maxX: this.state.maxX,\n        maxY: this.state.maxY,\n        xPoints: this.state.xPoints,\n        y: this.state.y\n      };\n    }\n  }, {\n    key: \"getInitialState\",\n    value: function getInitialState() {\n      var timelineWindowSize = this.props.timelineWindowSize;\n      var _this$data = this.data,\n          minX = _this$data.minX,\n          maxX = _this$data.maxX;\n      var fromIndex;\n\n      if (this.data.x.points.length > timelineWindowSize) {\n        fromIndex = this.data.x.points.length - timelineWindowSize;\n      } else {\n        fromIndex = 0;\n      }\n\n      var xFrom = this.data.x.points[fromIndex];\n      var fromRatio = (xFrom - minX) / (maxX - minX);\n      var toRatio = 1;\n      return _objectSpread({}, this.createState(fromRatio, toRatio), {\n        aspectRatio: this.getCanvasAspectRatio(),\n        canvasWidthPx: this.getCanvasWidthPx(),\n        graphOpacity: this.data.y.map(function (_) {\n          return 1;\n        })\n      });\n    }\n  }, {\n    key: \"createState\",\n    value: function createState(fromRatio, toRatio) {\n      var _this2 = this;\n\n      var x = this.data.x;\n      var minX = this.data.minX + fromRatio * (this.data.maxX - this.data.minX);\n      var maxX = this.data.minX + toRatio * (this.data.maxX - this.data.minX);\n      var fromIndex;\n\n      if (minX === this.data.minX) {\n        fromIndex = 0;\n      } else {\n        fromIndex = x.points.findIndex(function (x) {\n          return x > minX;\n        }) - 1;\n      }\n\n      var toIndex;\n\n      if (maxX === this.data.maxX) {\n        toIndex = x.points.length - 1;\n      } else {\n        toIndex = x.points.findIndex(function (x) {\n          return x > maxX;\n        });\n      }\n\n      var xPoints = x.points.slice(fromIndex, toIndex + 1);\n      var xGraphPoints = xPoints.slice(); // Create X graph points.\n\n      if (xPoints.length >= 2) {\n        if (x.points[fromIndex] !== minX) {\n          xGraphPoints[0] = minX;\n        }\n\n        if (x.points[toIndex] !== maxX) {\n          xGraphPoints[xGraphPoints.length - 1] = maxX;\n        }\n      }\n\n      var y = this.data.y.map(function (y, i) {\n        var points = _this2.data.y[i].points.slice(fromIndex, toIndex + 1);\n\n        var graphPoints = points.slice();\n\n        if (xPoints.length >= 2) {\n          if (x.points[fromIndex] !== minX) {\n            var beforeStartY = _this2.data.y[i].points[fromIndex];\n            var startY = _this2.data.y[i].points[fromIndex + 1];\n            var fromXExcludedTickRatio = (minX - _this2.data.x.points[fromIndex]) / (_this2.data.x.points[fromIndex + 1] - _this2.data.x.points[fromIndex]);\n            var startPoint = beforeStartY + (startY - beforeStartY) * fromXExcludedTickRatio;\n            graphPoints[0] = startPoint;\n          }\n\n          if (x.points[toIndex] !== maxX) {\n            var afterEndY = _this2.data.y[i].points[toIndex];\n            var endY = _this2.data.y[i].points[toIndex - 1];\n            var toXIncludedTickRatio = (maxX - _this2.data.x.points[toIndex - 1]) / (_this2.data.x.points[toIndex] - _this2.data.x.points[toIndex - 1]);\n            var endPoint = endY + (afterEndY - endY) * toXIncludedTickRatio;\n            graphPoints[graphPoints.length - 1] = endPoint;\n          }\n        }\n\n        return _objectSpread({}, _this2.data.y[i], _this2.state ? _this2.state.y[i] : {\n          isShown: true\n        }, {\n          points: points,\n          graphPoints: graphPoints,\n          // Min Y is always 0 by design.\n          min: 0,\n          // min: Math.min(...graphPoints),\n          max: Math.max.apply(Math, _toConsumableArray(graphPoints))\n        });\n      });\n      return _objectSpread({\n        minX: minX,\n        maxX: maxX,\n        fromIndex: fromIndex,\n        toIndex: toIndex,\n        fromRatio: fromRatio,\n        toRatio: toRatio,\n        xPoints: xPoints,\n        xGraphPoints: xGraphPoints\n      }, this.calculateMinMaxY(y), {\n        y: y\n      });\n    }\n  }, {\n    key: \"calculateMinMaxY\",\n    value: function calculateMinMaxY(y) {\n      // Calculate visible min/max Y for the graphs being shown.\n      var minY = Infinity;\n      var maxY = -Infinity;\n\n      for (var _iterator = y, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n        var _ref;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref = _i.value;\n        }\n\n        var _y = _ref;\n\n        if (_y.isShown) {\n          minY = Math.min(minY, _y.min);\n          maxY = Math.max(maxY, _y.max);\n        }\n      } // Calculate global min/max Y for the graphs being shown.\n\n\n      var minYGlobal = Infinity;\n      var maxYGlobal = -Infinity;\n\n      var _loop = function _loop() {\n        if (_isArray2) {\n          if (_i2 >= _iterator2.length) return \"break\";\n          _ref2 = _iterator2[_i2++];\n        } else {\n          _i2 = _iterator2.next();\n          if (_i2.done) return \"break\";\n          _ref2 = _i2.value;\n        }\n\n        var _y = _ref2;\n        var isShown = y.find(function (_) {\n          return _.id === _y.id;\n        }).isShown;\n\n        if (isShown) {\n          minYGlobal = Math.min(minYGlobal, _y.min);\n          maxYGlobal = Math.max(maxYGlobal, _y.max);\n        }\n      };\n\n      for (var _iterator2 = this.data.y, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n        var _ref2;\n\n        var _ret = _loop();\n\n        if (_ret === \"break\") break;\n      } // Min Y is always 0 by design.\n\n\n      minYGlobal = 0;\n      return {\n        minY: minY,\n        maxY: maxY,\n        minYGlobal: minYGlobal,\n        maxYGlobal: maxYGlobal\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props2 = this.props,\n          canvasWidth = _this$props2.canvasWidth,\n          gaugeTickMarksCount = _this$props2.gaugeTickMarksCount;\n      var _this$state5 = this.state,\n          minX = _this$state5.minX,\n          maxX = _this$state5.maxX,\n          minY = _this$state5.minY,\n          maxY = _this$state5.maxY,\n          xGraphPoints = _this$state5.xGraphPoints,\n          aspectRatio = _this$state5.aspectRatio,\n          graphOpacity = _this$state5.graphOpacity; // Clear canvas.\n\n      clearElement(this.canvas); // Set canvas `viewBox`.\n\n      this.canvas.setAttribute('viewBox', \"0 0 \".concat(canvasWidth, \" \").concat(this.fixSvgCoordinate(canvasWidth / aspectRatio))); // Calculate grid lines' coordinates.\n\n      var minY_ = minY;\n      var maxY_ = getLowerSiblingDivisibleBy(maxY, 10);\n      var yAxisScale = (maxY - minY) / (maxY_ - minY_);\n      var yAxisTickMarks = divideInterval(minY_, maxY_, gaugeTickMarksCount); // Draw grid lines.\n\n      for (var _iterator3 = yAxisTickMarks, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n        var _ref3;\n\n        if (_isArray3) {\n          if (_i3 >= _iterator3.length) break;\n          _ref3 = _iterator3[_i3++];\n        } else {\n          _i3 = _iterator3.next();\n          if (_i3.done) break;\n          _ref3 = _i3.value;\n        }\n\n        var y = _ref3;\n        this.canvas.appendChild(this.createGridLine(y));\n      } // Draw charts.\n\n\n      var i = 0;\n\n      while (i < this.state.y.length) {\n        var _this$state$y$i = this.state.y[i],\n            color = _this$state$y$i.color,\n            graphPoints = _this$state$y$i.graphPoints,\n            isShown = _this$state$y$i.isShown;\n        var opacity = graphOpacity[i]; // Draw chart.\n\n        if (isShown || opacity > 0) {\n          var graph = document.createElement('polyline');\n          graph.setAttribute('stroke', color);\n          graph.setAttribute('points', this.createPolylinePoints(xGraphPoints.map(this.mapX), graphPoints.map(function (y) {\n            return _this3.mapY(maxY - y);\n          })).join(' '));\n          graph.classList.add('chartogram__graph');\n\n          if (opacity !== 1) {\n            graph.style.opacity = opacity;\n          }\n\n          this.canvas.appendChild(graph);\n        }\n\n        i++;\n      } // A workaround to fix WebKit bug when it's not re-rendering the <svg/>.\n      // https://stackoverflow.com/questions/30905493/how-to-force-webkit-to-update-svg-use-elements-after-changes-to-original\n\n\n      this.canvas.innerHTML += ''; // Draw gauges.\n\n      this.drawGauges(minX, maxX, minY_, maxY_, yAxisScale);\n    }\n  }, {\n    key: \"transitionState\",\n    value: function transitionState(minY, maxY, minYGlobal, maxYGlobal, graphOpacity) {\n      var maxTransitionDuration = this.props.transitionDuration;\n\n      if (this.transition) {\n        cancelAnimationFrame(this.transition);\n      }\n\n      var heightBefore = this.state.maxY - this.state.minY;\n      var deltaMaxY = Math.abs(maxY - this.state.maxY) / heightBefore;\n      var deltaMinY = Math.abs(minY - this.state.minY) / heightBefore;\n      var deltaY = Math.max(deltaMinY, deltaMaxY);\n      var transitionDuration = maxTransitionDuration * Math.max(0.1, Math.min(deltaY, 0.5) * 2);\n      this.setState({\n        graphOpacityFrom: this.state.graphOpacity,\n        graphOpacityTo: graphOpacity,\n        minYFrom: this.state.minY,\n        maxYFrom: this.state.maxY,\n        minYTo: minY,\n        maxYTo: maxY,\n        minYGlobalFrom: this.state.minYGlobal,\n        maxYGlobalFrom: this.state.maxYGlobal,\n        minYGlobalTo: minYGlobal,\n        maxYGlobalTo: maxYGlobal,\n        transitionStartedAt: Date.now(),\n        transitionDuration: transitionDuration\n      }); // Place in a `setState()` callback in case of React.\n\n      this.transition = requestAnimationFrame(this.transitionStateTick);\n    }\n  }]);\n\n  return Chartogram;\n}();\n\nexport { Chartogram as default };\nvar MONTHS = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\nvar WEEKDAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\nvar INITIAL_MARKUP = \"\\n\\t<header class=\\\"chartogram__header\\\">\\n\\t\\t<h1 class=\\\"chartogram__title\\\">{title}</h1>\\n\\t</header>\\n\\t<div class=\\\"chartogram__plan-with-axes\\\">\\n\\t\\t<div class=\\\"chartogram__plan\\\">\\n\\t\\t\\t<div class=\\\"chartogram__top-border\\\"></div>\\n\\t\\t\\t<div class=\\\"chartogram__canvas-wrapper\\\">\\n\\t\\t\\t\\t<svg class=\\\"chartogram__canvas\\\"></svg>\\n\\t\\t\\t\\t<div class=\\\"chartogram__x\\\"></div>\\n\\t\\t\\t\\t<div class=\\\"chartogram__y-wrapper\\\">\\n\\t\\t\\t\\t\\t<div class=\\\"chartogram__y\\\"></div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t</div>\\n\"; // https://gist.github.com/gre/1650294\n\nvar EASING = {\n  linear: function linear(t) {\n    return t;\n  },\n  easeInOutSin: function easeInOutSin(t) {\n    return (1 + Math.sin(Math.PI * t - Math.PI / 2)) / 2;\n  },\n  easeInOutQuad: function easeInOutQuad(t) {\n    return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t;\n  },\n  easeInOutCubic: function easeInOutCubic(t) {\n    return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n  },\n  easeOutCubic: function easeOutCubic(t) {\n    return --t * t * t + 1;\n  },\n  easeOutQuad: function easeOutQuad(t) {\n    return t * (2 - t);\n  }\n};\n//# sourceMappingURL=Chartogram.js.map","import Chartogram from './Chartogram';\nexport default function chartogram(rootNode, data, title, options) {\n  var chartogram = new Chartogram(rootNode, data, title, options);\n  chartogram.componentDidMount();\n  return function () {\n    chartogram.componentWillUnmount();\n  };\n}\n//# sourceMappingURL=index.js.map"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","_arrayWithoutHoles","iter","Symbol","iterator","Object","prototype","toString","call","from","_iterableToArray","TypeError","_nonIterableSpread","clearElement","element","firstChild","removeChild","renderGaugeLabels","min","max","GAUGE_TICK_MARKS_COUNT","transform","tickMark","document","createElement","value","appendChild","createTextNode","throttle","func","interval","timeout","executedAt","scheduled","undefined","Date","now","remaining","clearTimeout","setTimeout","setUpDrag","onDragStart","onDrag","onTouchMove","event","changedTouches","clientX","clientY","onPointerMove","onDragStop","window","removeEventListener","onTouchStart","touches","addEventListener","onPointerDown","_slicedToArray","_arrayWithHoles","_arr","_n","_d","_e","_s","_i","next","done","push","err","_iterableToArrayLimit","_nonIterableRest","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","_defineProperty","obj","Timeline","_this","this","instance","Constructor","_classCallCheck","setState","aspectRatio","getCanvasAspectRatio","onResize","newState","state","arguments","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","_objectSpread","render","x","_this$props","canvasWidth","data","minX","maxX","y","_this$props2","minYGlobal","maxYGlobal","side","timelineCoordinates","deltaX","handle","timelineWindowLeftHandle","timelineWindowRightHandle","handleWidth","parseFloat","getComputedStyle","timelineWindow","borderLeftWidth","timeline","getBoundingClientRect","timelineWindowCoordinates","left","width","ratio","Math","updateBounds","toRatio","fromRatio","innerX","timelineWindowDrag","timelineOverlayLeft","style","right","timelineOverlayRight","protoProps","staticProps","onChangeBounds","rootNode","querySelector","timelineCanvas","setUpTimelineWindowHandle","setUpTimelineWindow","onResizeThrottled","timelineCanvasDimensions","height","_this2","_this$props3","fixSvgCoordinate","createPolylinePoints","graphOpacity","setAttribute","_loop","_data$y$i","id","color","points","opacity","find","_","isShown","_simplifyGraph2","simplifyGraph","maxPoints","yMax","apply","threshold","_x","_y","slice","y0","abs","graph","map","mapX","mapY","join","classList","add","innerHTML","to","setTimelineWindowLeft","setTimelineWindowRight","INITIAL_MARKUP","Togglers","_ref","name","toggler","xmlns","check","createElementNS","backgroundCircle","checkCircle","checkMark","onToggle","toggle","graphTogglers","_iterator","_isArray","_ref2","createGraphToggler","Tooltip","canvasDimensions","isIndexInBounds","canvas","canvasWidthPx","weekdays","months","onTrack","screenX","xIndex","xPoints","xPoint","xHigherIndex","findIndex","xLowerIndex","unmount","xLower","xHigher","tooltipForX","tooltip","mount","date","tooltipDate","textContent","getDay","getMonth","getDate","tooltipValues","childNodes","xRatio","tooltipWidth","updatePoints","updateLine","onTrackStart","index","onTrackStop","top","onPointerEnter","line","pointsContainer","_iterator2","_isArray2","_i2","_ref3","point","isLineRendered","renderLine","setAttributeNS","_this$props4","maxY","j","yRatio","bottom","unlisten","setUpListener","renderTooltip","renderPoints","_this$props5","container","_iterator3","_isArray3","_i3","_ref4","_ref5","tooltipValue","tooltipName","insertBefore","unmountPoints","unmountLine","parentNode","_this$props6","_iterator4","_isArray4","_i4","_ref6","Chartogram","title","getCanvasWidthPx","_this$calculateMinMax","calculateMinMaxY","minY","transitionState","createState","a","b","ai","precisionFactor","round","_this$state","_this$state2","transitionEasing","_this$state3","transitionStartedAt","transitionDuration","graphOpacityFrom","graphOpacityTo","minYFrom","minYTo","maxYFrom","maxYTo","minYGlobalFrom","minYGlobalTo","maxYGlobalFrom","maxYGlobalTo","elapsed","EASING","transition","requestAnimationFrame","transitionStateTick","_this$state4","yAxisScale","gaugeTickMarksCount","xAxis","yAxis","timestamp","timelineWindowSize","pow","precision","MONTHS","WEEKDAYS","replace","tooltipContainer","canvasWrapper","getInitialState","getTimelineProps","componentDidMount","togglers","getTogglersProps","getTooltipProps","componentWillUnmount","remove","renderTimeline","componentDidUpdate","fromIndex","_this$data","toIndex","xGraphPoints","graphPoints","beforeStartY","startPoint","afterEndY","endY","endPoint","Infinity","_this3","_this$state5","minY_","maxY_","n","divider","floor","getLowerSiblingDivisibleBy","divideInterval","createGridLine","_this$state$y$i","drawGauges","maxTransitionDuration","cancelAnimationFrame","heightBefore","deltaMaxY","deltaMinY","deltaY","linear","t","easeInOutSin","sin","PI","easeInOutQuad","easeInOutCubic","easeOutCubic","easeOutQuad","options","chartogram"],"mappings":"gMAAA,SAASA,EAAmBC,GAAO,OAMnC,SAA4BA,GAAO,GAAIC,MAAMC,QAAQF,GAAM,CAAE,IAAK,IAAIG,EAAI,EAAGC,EAAO,IAAIH,MAAMD,EAAIK,QAASF,EAAIH,EAAIK,OAAQF,IAAOC,EAAKD,GAAKH,EAAIG,GAAM,OAAOC,GANnHE,CAAmBN,IAI7D,SAA0BO,GAAQ,GAAIC,OAAOC,YAAYC,OAAOH,IAAkD,uBAAzCG,OAAOC,UAAUC,SAASC,KAAKN,GAAgC,OAAON,MAAMa,KAAKP,GAJrFQ,CAAiBf,IAEtF,WAAgC,MAAM,IAAIgB,UAAU,mDAF0CC,GAQvF,SAASC,EAAaC,GAC3B,KAAOA,EAAQC,YACbD,EAAQE,YAAYF,EAAQC,YAkCzB,SAASE,EAAkBH,EAASI,EAAKC,EAAKC,EAAwBC,GAG3E,IAFA,IAAIvB,EAAI,EAEDA,EAAIsB,GAAwB,CACjC,IAAIE,EAAWC,SAASC,cAAc,OAClCC,EAAQP,EAAMpB,GAAKqB,EAAMD,IAAQE,EAAyB,GAE1DC,IACFI,EAAQJ,EAAUI,IAGpBH,EAASI,YAAYH,SAASI,eAAeF,IAC7CX,EAAQY,YAAYJ,GACpBxB,KAGG,SAAS8B,EAASC,EAAMC,GAC7B,IAAIC,EACAC,EAAa,EAEbC,EAAY,WACdF,OAAUG,EACVF,EAAaG,KAAKC,MAClBP,KAGF,OAAO,WACL,IAAIO,EAAMD,KAAKC,MACXC,EAAYP,GAAYM,EAAMJ,GAE9BK,GAAa,GACXN,IACFO,aAAaP,GACbA,OAAUG,GAGZF,EAAaI,EACbP,KACUE,IACVA,EAAUQ,WAAWN,EAAWI,KAuD/B,SAASG,EAAU1B,EAAS2B,EAAaC,GAC9C,SAASC,EAAYC,GACnBF,EAAOE,EAAMC,eAAe,GAAGC,QAASF,EAAMC,eAAe,GAAGE,SAGlE,SAASC,EAAcJ,GACrBF,EAAOE,EAAME,QAASF,EAAMG,SAG9B,SAASE,IACPC,OAAOC,oBAAoB,cAAeH,GAC1CE,OAAOC,oBAAoB,YAAaR,GACxCO,OAAOC,oBAAoB,YAAaF,GACxCC,OAAOC,oBAAoB,gBAAiBF,GAC5CC,OAAOC,oBAAoB,WAAYF,GACvCC,OAAOC,oBAAoB,cAAeF,GAG5C,SAASG,EAAaR,GAEpB,GAAIA,EAAMS,QAAQrD,OAAS,EAEzB,OAAOiD,IAGTR,EAAYG,EAAMC,eAAe,GAAGC,QAASF,EAAMC,eAAe,GAAGE,SACrEG,OAAOI,iBAAiB,YAAaX,GACrCO,OAAOI,iBAAiB,WAAYL,GACpCC,OAAOI,iBAAiB,cAAeL,GAOzC,SAASM,EAAcX,GACrBH,EAAYG,EAAME,QAASF,EAAMG,SACjCG,OAAOI,iBAAiB,cAAeN,GACvCE,OAAOI,iBAAiB,YAAaL,GACrCC,OAAOI,iBAAiB,gBAAiBL,GAI3C,OAVAnC,EAAQwC,iBAAiB,aAAcF,GASvCtC,EAAQwC,iBAAiB,cAAeC,GACjC,WACLN,IACAnC,EAAQqC,oBAAoBI,GAC5BzC,EAAQqC,oBAAoBC,ICxLhC,SAASI,EAAe7D,EAAKG,GAAK,OAMlC,SAAyBH,GAAO,GAAIC,MAAMC,QAAQF,GAAM,OAAOA,EANtB8D,CAAgB9D,IAIzD,SAA+BA,EAAKG,GAAK,IAAI4D,EAAO,GAAQC,GAAK,EAAUC,GAAK,EAAWC,OAAK3B,EAAW,IAAM,IAAK,IAAiC4B,EAA7BC,EAAKpE,EAAIQ,OAAOC,cAAmBuD,GAAMG,EAAKC,EAAGC,QAAQC,QAAoBP,EAAKQ,KAAKJ,EAAGrC,QAAY3B,GAAK4D,EAAK1D,SAAWF,GAA3D6D,GAAK,IAAoE,MAAOQ,GAAOP,GAAK,EAAMC,EAAKM,UAAiB,IAAWR,GAAsB,MAAhBI,EAAW,QAAWA,EAAW,iBAAiB,GAAIH,EAAI,MAAMC,GAAQ,OAAOH,EAJjVU,CAAsBzE,EAAKG,IAE5F,WAA8B,MAAM,IAAIa,UAAU,wDAFgD0D,GAYlG,SAASC,EAAkBC,EAAQC,GAAS,IAAK,IAAI1E,EAAI,EAAGA,EAAI0E,EAAMxE,OAAQF,IAAK,CAAE,IAAI2E,EAAaD,EAAM1E,GAAI2E,EAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,UAAWF,IAAYA,EAAWG,UAAW,GAAMvE,OAAOwE,eAAeN,EAAQE,EAAWK,IAAKL,IAI7S,SAASM,EAAgBC,EAAKF,EAAKrD,GAAiK,OAApJqD,KAAOE,EAAO3E,OAAOwE,eAAeG,EAAKF,EAAK,CAAErD,MAAOA,EAAOiD,YAAY,EAAMC,cAAc,EAAMC,UAAU,IAAkBI,EAAIF,GAAOrD,EAAgBuD,EAI3M,IAAIC,EAEJ,WACE,SAASA,EAAST,GAChB,IAAIU,EAAQC,MAdhB,SAAyBC,EAAUC,GAAe,KAAMD,aAAoBC,GAAgB,MAAM,IAAI1E,UAAU,qCAgB5G2E,CAAgBH,KAAMF,GAEtBF,EAAgBI,KAAM,WAAY,SAAUvC,GAC1CsC,EAAMK,SAAS,CACbC,YAAaN,EAAMO,2BAIvBV,EAAgBI,KAAM,oBAAqBvD,EAASuD,KAAKO,SAAU,KAEnEX,EAAgBI,KAAM,WAAY,SAAUQ,GAC1CT,EAAMU,MA7BZ,SAAuBrB,GAAU,IAAK,IAAIzE,EAAI,EAAGA,EAAI+F,UAAU7F,OAAQF,IAAK,CAAE,IAAIgG,EAAyB,MAAhBD,UAAU/F,GAAa+F,UAAU/F,GAAK,GAAQiG,EAAU1F,OAAO2F,KAAKF,GAAqD,mBAAjCzF,OAAO4F,wBAAwCF,EAAUA,EAAQG,OAAO7F,OAAO4F,sBAAsBH,GAAQK,OAAO,SAAUC,GAAO,OAAO/F,OAAOgG,yBAAyBP,EAAQM,GAAK1B,eAAmBqB,EAAQO,QAAQ,SAAUxB,GAAOC,EAAgBR,EAAQO,EAAKgB,EAAOhB,MAAa,OAAOP,EA6BpcgC,CAAc,GAAIrB,EAAMU,MAAOD,GAE7CT,EAAMsB,WAGRzB,EAAgBI,KAAM,OAAQ,SAAUsB,GACtC,IAAIC,EAAcxB,EAAMV,MACpBmC,EAAcD,EAAYC,YAC1BC,EAAOF,EAAYE,KACnBC,EAAOD,EAAKC,KAEhB,OAAQJ,EAAII,IADDD,EAAKE,KACYD,GAAQF,IAGtC5B,EAAgBI,KAAM,OAAQ,SAAU4B,GACtC,IAAIC,EAAe9B,EAAMV,MACrBmC,EAAcK,EAAaL,YAC3BM,EAAaD,EAAaC,WAG9B,OAAQF,EAAIE,IAFKD,EAAaE,WAEUD,GAAcN,EADpCzB,EAAMU,MAAMJ,cAIhCT,EAAgBI,KAAM,4BAA6B,SAAUgC,GAC3D,IAEIC,EACAP,EACAC,EACAO,EALAC,EAAkB,SAATH,EAAkBjC,EAAMqC,yBAA2BrC,EAAMsC,0BAClEC,EAAcC,WAAWC,iBAAiBzC,EAAM0C,gBAAgBC,iBAmCpE,OAAOrF,EAAU8E,EAhBC,SAAqBb,GACrCW,EAAsBlC,EAAM4C,SAASC,wBAErC,IAAIC,EAA4B9C,EAAM0C,eAAeG,wBAExC,SAATZ,GACFN,EAAOO,EAAoBa,KAC3BnB,EAAOkB,EAA0BC,KAAOD,EAA0BE,MAAQ,EAAIT,EAC9EJ,EAASZ,EAAIuB,EAA0BC,OAEvCpB,EAAOmB,EAA0BC,KAAO,EAAIR,EAC5CX,EAAOM,EAAoBa,KAAOb,EAAoBc,MACtDb,EAASZ,GAAKuB,EAA0BC,KAAOD,EAA0BE,SAxBhE,SAAgBzB,GAC3BA,GAAKY,EAEL,IAAIc,IADJ1B,EAAI2B,KAAKjH,IAAIiH,KAAKlH,IAAIuF,EAAGK,GAAOD,IACfO,EAAoBa,MAAQb,EAAoBc,MAEpD,SAATf,EACFjC,EAAMmD,aAAaF,EAAOjD,EAAMV,MAAM8D,SAEtCpD,EAAMmD,aAAanD,EAAMV,MAAM+D,UAAWJ,OAuBhDpD,EAAgBI,KAAM,sBAAuB,WAC3C,IAAIiC,EACAY,EACAnB,EACAC,EACA0B,EAkBJ,OAAOhG,EAAU0C,EAAMuD,mBARL,SAAqBhC,GACrCW,EAAsBlC,EAAM4C,SAASC,wBACrCC,EAA4B9C,EAAM0C,eAAeG,wBACjDS,EAAS/B,EAAIuB,EAA0BC,KACvCpB,EAAOO,EAAoBa,KAC3BnB,EAAOM,EAAoBa,MAAQb,EAAoBc,MAAQF,EAA0BE,QAb9E,SAAgBzB,GAC3BA,GAAK+B,EAEL,IAAIL,IADJ1B,EAAI2B,KAAKjH,IAAIiH,KAAKlH,IAAIuF,EAAGK,GAAOD,IACfO,EAAoBa,MAAQb,EAAoBc,MAEjEhD,EAAMmD,aAAaF,EAAOA,EAAQH,EAA0BE,MAAQd,EAAoBc,WAc5FnD,EAAgBI,KAAM,wBAAyB,SAAUgD,GACvDjD,EAAMwD,oBAAoBC,MAAMC,MAAQ,GAAG1C,OAAO,KAAO,EAAIiC,GAAQ,KACrEjD,EAAM0C,eAAee,MAAMV,KAAO,GAAG/B,OAAO,IAAMiC,EAAO,OAG3DpD,EAAgBI,KAAM,yBAA0B,SAAUgD,GACxDjD,EAAM2D,qBAAqBF,MAAMV,KAAO,GAAG/B,OAAO,IAAMiC,EAAO,KAC/DjD,EAAM0C,eAAee,MAAMC,MAAQ,GAAG1C,OAAO,KAAO,EAAIiC,GAAQ,OAGlEhD,KAAKX,MAAQA,EA1HjB,IAAsBa,EAAayD,EAAYC,EAyP7C,OAzPoB1D,EA6HPJ,GA7HoB6D,EA6HV,CAAC,CACtBhE,IAAK,qBACLrD,MAAO,SAA4B+C,GAC7BW,KAAKX,QAAUA,IACjBW,KAAKX,MAAQA,EACbW,KAAKS,MAAQ,CACXJ,YAAaL,KAAKM,wBAEpBN,KAAK6D,eAAe7D,KAAKX,MAAM+D,UAAWpD,KAAKX,MAAM8D,SAAUnD,KAAKqB,YAGvE,CACD1B,IAAK,oBACLrD,MAAO,WACL,IAAIwH,EAAW9D,KAAKX,MAAMyE,SAC1B9D,KAAK2C,SAAWmB,EAASC,cAAc,yBACvC/D,KAAKuD,oBAAsBO,EAASC,cAAc,sCAClD/D,KAAKoC,yBAA2B0B,EAASC,cAAc,6CACvD/D,KAAKyC,eAAiBqB,EAASC,cAAc,gCAC7C/D,KAAKsD,mBAAqBQ,EAASC,cAAc,sCACjD/D,KAAKqC,0BAA4ByB,EAASC,cAAc,8CACxD/D,KAAK0D,qBAAuBI,EAASC,cAAc,uCACnD/D,KAAKgE,eAAiBF,EAASC,cAAc,gCAC7C/D,KAAKS,MAAQ,CACXJ,YAAaL,KAAKM,wBAEpBN,KAAKiE,0BAA0B,QAC/BjE,KAAKiE,0BAA0B,SAC/BjE,KAAKkE,sBAELnG,OAAOI,iBAAiB,SAAU6B,KAAKmE,mBACvCnE,KAAK6D,eAAe7D,KAAKX,MAAM+D,UAAWpD,KAAKX,MAAM8D,SACrDnD,KAAKqB,WAEN,CACD1B,IAAK,uBACLrD,MAAO,WAELyB,OAAOC,oBAAoB,SAAUgC,KAAKmE,qBAE3C,CACDxE,IAAK,uBACLrD,MAAO,WACL,IAAI8H,EAA2BpE,KAAKgE,eAAepB,wBACnD,OAAOwB,EAAyBrB,MAAQqB,EAAyBC,SAElE,CACD1E,IAAK,SACLrD,MAAO,WACL,IAAIgI,EAAStE,KAETuE,EAAevE,KAAKX,MACpBmC,EAAc+C,EAAa/C,YAC3BI,EAAI2C,EAAa3C,EACjBH,EAAO8C,EAAa9C,KACpBM,EAAawC,EAAaxC,WAC1ByC,EAAmBD,EAAaC,iBAChCC,EAAuBF,EAAaE,qBACpCC,EAAeH,EAAaG,aAC5BrE,EAAcL,KAAKS,MAAMJ,YAE7B3E,EAAasE,KAAKgE,gBAElBhE,KAAKgE,eAAeW,aAAa,UAAW,OAAO5D,OAAOS,EAAa,KAAKT,OAAOyD,EAAiBhD,EAAcnB,KAqClH,IAnCA,IAAI1F,EAAI,EAEJiK,EAAQ,WACV,IAAIC,EAAYpD,EAAKG,EAAEjH,GACnBmK,EAAKD,EAAUC,GACfC,EAAQF,EAAUE,MAClBC,EAASH,EAAUG,OACnBC,EAAUP,EAAa/J,GAK3B,GAJciH,EAAEsD,KAAK,SAAUC,GAC7B,OAAOA,EAAEL,KAAOA,IACfM,SAEYH,EAAU,EAAG,CAC1B,IACII,EAAkBhH,EDnIzB,SAASiH,EAAchE,EAAGM,EAAG2D,GAClC,IAAIC,EAAO9E,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAKuC,KAAKjH,IAAIyJ,MAAMxC,KAAM1I,EAAmBqH,IACnH8D,EAAYhF,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,KAChF/F,EAAI+F,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,EAExEiF,EAAKjF,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,IAAIjG,MAAM6G,EAAEzG,QAErF+K,EAAKlF,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,IAAIjG,MAAM6G,EAAEzG,QAErF+D,EAAK8B,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,EAE7E,GAAI/F,EAAI,EAAI2G,EAAEzG,OAAS,EAAG,CACxB,KAAOF,EAAIiH,EAAE/G,QACX8K,EAAG/G,GAAM0C,EAAE3G,GACXiL,EAAGhH,GAAMgD,EAAEjH,GACXiE,IACAjE,IAMF,OAHAgL,EAAKA,EAAGE,MAAM,EAAGjH,GACjBgH,EAAKA,EAAGC,MAAM,EAAGjH,GAEb+G,EAAG9K,QAAU0K,EACR,CAACI,EAAIC,IAERtE,EAAEzG,OAAS8K,EAAG9K,OAAS,MACzB6K,EAAYzC,KAAKlH,IAAI2J,EAAY,KAAO,IAGnCJ,EAAcK,EAAIC,EAAIL,EAAWC,EAAME,IAIlD,IAAII,GAAMlE,EAAEjH,EAAI,GAAKiH,EAAEjH,IAAM,EAE7B,OAAIsI,KAAK8C,IAAID,EAAKlE,EAAEjH,EAAI,IAAM6K,EAAOE,GACnCC,EAAG/G,GAAM0C,EAAE3G,GACXgL,EAAG/G,EAAK,GAAK0C,EAAE3G,EAAI,GACnBiL,EAAGhH,GAAMgD,EAAEjH,GACXiL,EAAGhH,EAAK,GAAKgD,EAAEjH,EAAI,GACZ2K,EAAchE,EAAGM,EAAG2D,EAAWC,EAAME,EAAW/K,EAAI,EAAGgL,EAAIC,EAAIhH,EAAK,KAE3E+G,EAAG/G,GAAM0C,EAAE3G,GACXgL,EAAG/G,EAAK,GAAK0C,EAAE3G,EAAI,GACnBgL,EAAG/G,EAAK,GAAK0C,EAAE3G,EAAI,GACnBiL,EAAGhH,GAAMgD,EAAEjH,GACXiL,EAAGhH,EAAK,GAAKgD,EAAEjH,EAAI,GACnBiL,EAAGhH,EAAK,GAAKgD,EAAEjH,EAAI,GACZ2K,EAAchE,EAAGM,EAAG2D,EAAWC,EAAME,EAAW/K,EAAI,EAAGgL,EAAIC,EAAIhH,EAAK,ICkFhD0G,CAAc7D,EAAKH,EAAE0D,OAAQA,EAAQ,IACL,GACjDW,EAAKN,EAAgB,GACrBO,EAAKP,EAAgB,GAErBW,EAAQ5J,SAASC,cAAc,YACnC2J,EAAMrB,aAAa,SAAUI,GAC7BiB,EAAMrB,aAAa,SAAUF,EAAqBkB,EAAGM,IAAI3B,EAAO4B,MAAON,EAAGK,IAAI,SAAUrE,GACtF,OAAO0C,EAAO6B,KAAKpE,EAAaH,MAC9BwE,KAAK,MACTJ,EAAMK,UAAUC,IAAI,qBAEJ,IAAZrB,IACFe,EAAMxC,MAAMyB,QAAUA,GAGxBX,EAAON,eAAezH,YAAYyJ,GAGpCrL,KAGKA,EAAI8G,EAAKG,EAAE/G,QAChB+J,IAKF5E,KAAKgE,eAAeuC,WAAa,KAElC,CACD5G,IAAK,iBACLrD,MAAO,SAAwBhB,EAAMkL,GACnCxG,KAAKyG,sBAAsBnL,GAC3B0E,KAAK0G,uBAAuBF,KAE7B,CACD7G,IAAK,eACLrD,MAAO,SAAsBhB,EAAMkL,GACjCxG,KAAKX,MAAMwE,eAAevI,EAAMkL,GAChCxG,KAAKX,MAAM+D,UAAY9H,EACvB0E,KAAKX,MAAM8D,QAAUqD,EACrBxG,KAAK6D,eAAevI,EAAMkL,QArP8CrH,EAAkBe,EAAY/E,UAAWwI,GAAiBC,GAAazE,EAAkBe,EAAa0D,GAyP3K9D,EAjPT,GCpBA,SAASX,EAAkBC,EAAQC,GAAS,IAAK,IAAI1E,EAAI,EAAGA,EAAI0E,EAAMxE,OAAQF,IAAK,CAAE,IAAI2E,EAAaD,EAAM1E,GAAI2E,EAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,UAAWF,IAAYA,EAAWG,UAAW,GAAMvE,OAAOwE,eAAeN,EAAQE,EAAWK,IAAKL,IAI7S,SAASM,EAAgBC,EAAKF,EAAKrD,GAAiK,OAApJqD,KAAOE,EAAO3E,OAAOwE,eAAeG,EAAKF,EAAK,CAAErD,MAAOA,EAAOiD,YAAY,EAAMC,cAAc,EAAMC,UAAU,IAAkBI,EAAIF,GAAOrD,EAAgBuD,EDqQ3MC,EAAS6G,eAAiB,ysBCjQ1B,IAAIC,EAEJ,WACE,SAASA,EAASvH,GAChB,IAAIU,EAAQC,MAdhB,SAAyBC,EAAUC,GAAe,KAAMD,aAAoBC,GAAgB,MAAM,IAAI1E,UAAU,qCAgB5G2E,CAAgBH,KAAM4G,GAEtBhH,EAAgBI,KAAM,qBAAsB,SAAU6G,GACpD,IAAI/B,EAAK+B,EAAK/B,GACVgC,EAAOD,EAAKC,KACZ/B,EAAQ8B,EAAK9B,MACbgC,EAAU3K,SAASC,cAAc,UACrC0K,EAAQpC,aAAa,OAAQ,UAC7BoC,EAAQV,UAAUC,IAAI,6BACtBS,EAAQV,UAAUC,IAAI,iCACtBS,EAAQV,UAAUC,IAAI,4BAEtB,IAAIU,EAAQ,6BACRC,EAAQ7K,SAAS8K,gBAAgBF,EAAO,OAC5CC,EAAMtC,aAAa,UAAW,aAC9BsC,EAAMtC,aAAa,QAAS,mCAE5B,IAAIwC,EAAmB/K,SAAS8K,gBAAgBF,EAAO,UACvDG,EAAiBxC,aAAa,KAAM,OACpCwC,EAAiBxC,aAAa,KAAM,OACpCwC,EAAiBxC,aAAa,IAAK,OACnCwC,EAAiBxC,aAAa,OAAQI,GACtCkC,EAAM1K,YAAY4K,GAElB,IAAIC,EAAchL,SAAS8K,gBAAgBF,EAAO,UAClDI,EAAYzC,aAAa,KAAM,OAC/ByC,EAAYzC,aAAa,KAAM,OAC/ByC,EAAYzC,aAAa,IAAK,KAC9ByC,EAAYzC,aAAa,QAAS,0CAClCsC,EAAM1K,YAAY6K,GAElB,IAAIC,EAAYjL,SAAS8K,gBAAgBF,EAAO,QAahD,OAZAK,EAAU1C,aAAa,IAAK,4IAC5B0C,EAAU1C,aAAa,OAAQ,SAC/B0C,EAAU1C,aAAa,QAAS,wCAChCsC,EAAM1K,YAAY8K,GAElBN,EAAQxK,YAAY0K,GAEpBF,EAAQxK,YAAYH,SAASI,eAAesK,IAE5CC,EAAQ5I,iBAAiB,QAAS,WAChC,OAAO4B,EAAMuH,SAASxC,EAAIiC,KAErBA,IAGTnH,EAAgBI,KAAM,WAAY,SAAU8E,EAAIiC,IAG1CO,EAFWvH,EAAMV,MAAMiI,UAEdxC,IACXiC,EAAQV,UAAUkB,OAAO,mCAI7BvH,KAAKX,MAAQA,EAnEjB,IAAsBa,EAAayD,EAAYC,EAkG7C,OAlGoB1D,EAsEP0G,GAtEoBjD,EAsEV,CAAC,CACtBhE,IAAK,oBACLrD,MAAO,WACL,IAAIiF,EAAcvB,KAAKX,MACnByE,EAAWvC,EAAYuC,SACvBrC,EAAOF,EAAYE,KAEnB+F,EAAgB1D,EAASC,cAAc,+BAC3CrI,EAAa8L,GAER,IAAIC,EAAYhG,EAAKG,EAAG8F,EAAWjN,MAAMC,QAAQ+M,GAAY7I,EAAK,EAAvE,IAA0E6I,EAAYC,EAAWD,EAAYA,EAAUzM,OAAOC,cAAe,CAC3I,IAAI0M,EAEJ,GAAID,EAAU,CACZ,GAAI9I,GAAM6I,EAAU5M,OAAQ,MAC5B8M,EAAQF,EAAU7I,SACb,CAEL,IADAA,EAAK6I,EAAU5I,QACRC,KAAM,MACb6I,EAAQ/I,EAAGtC,MAGb,IAAIsF,EAAI+F,EACRH,EAAcjL,YAAYyD,KAAK4H,mBAAmBhG,UA7FoBzC,EAAkBe,EAAY/E,UAAWwI,GAAiBC,GAAazE,EAAkBe,EAAa0D,GAkG3KgD,EA1FT,GCVA,SAASzH,EAAkBC,EAAQC,GAAS,IAAK,IAAI1E,EAAI,EAAGA,EAAI0E,EAAMxE,OAAQF,IAAK,CAAE,IAAI2E,EAAaD,EAAM1E,GAAI2E,EAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,UAAWF,IAAYA,EAAWG,UAAW,GAAMvE,OAAOwE,eAAeN,EAAQE,EAAWK,IAAKL,IAI7S,SAASM,EAAgBC,EAAKF,EAAKrD,GAAiK,OAApJqD,KAAOE,EAAO3E,OAAOwE,eAAeG,EAAKF,EAAK,CAAErD,MAAOA,EAAOiD,YAAY,EAAMC,cAAc,EAAMC,UAAU,IAAkBI,EAAIF,GAAOrD,EAAgBuD,EDoG3M+G,EAASD,eAAiB,uDClG1B,IAAIkB,EAEJ,WACE,SAASA,EAAQxI,GACf,IAAIU,EAAQC,MAZhB,SAAyBC,EAAUC,GAAe,KAAMD,aAAoBC,GAAgB,MAAM,IAAI1E,UAAU,qCAc5G2E,CAAgBH,KAAM6H,GAEtBjI,EAAgBI,KAAM,gBAAiB,WACrC,IAKI8H,EACAC,EANAxG,EAAcxB,EAAMV,MACpB2I,EAASzG,EAAYyG,OACrBC,EAAgB1G,EAAY0G,cAC5BC,EAAW3G,EAAY2G,SACvBC,EAAS5G,EAAY4G,OAIrBC,EAAU,SAAiBC,GAC7B,IAoBIC,EApBAzG,EAAe9B,EAAMV,MACrBqC,EAAOG,EAAaH,KACpBC,EAAOE,EAAaF,KACpB4G,EAAU1G,EAAa0G,QACvB3G,EAAIC,EAAaD,EAEjB4G,EAAS9G,GADO2G,EAAUP,EAAiBhF,MAAQgF,EAAiB/E,OACpCpB,EAAOD,GACvC+G,EAAeF,EAAQG,UAAU,SAAUvD,GAC7C,OAAOA,GAAKqD,IAEVG,EAAcF,EAAe,EAYjC,GAVKV,EAAgBU,KACnBA,GAAgB,GAGbV,EAAgBY,KACnBA,GAAe,GAKbF,EAAe,EAAG,CACpB,GAAIE,EAAc,EAChB,OAAO5I,EAAM6I,UAEbN,EAASK,OAGX,GAAIA,EAAc,EAChBL,EAASG,MACJ,CACL,IAAII,EAASN,EAAQI,GACjBG,EAAUP,EAAQE,GAGtBH,EAFiBE,EAASK,EACRC,EAAUN,EACQC,EAAeE,EAIvD,IAAIrH,EAAIiH,EAAQD,GAEhB,GAAIhH,IAAMvB,EAAMgJ,YAAa,CAC3BhJ,EAAMgJ,YAAczH,EAEfvB,EAAMiJ,SACTjJ,EAAMkJ,QAGR,IAAIC,EAAO,IAAIlM,KAAKsE,GACpBvB,EAAMoJ,YAAYC,YAAc,GAAGrI,OAAOmH,EAASgB,EAAKG,UAAW,MAAMtI,OAAOoH,EAAOe,EAAKI,YAAa,KAAKvI,OAAOmI,EAAKK,WAC1H,IAAI5O,EAAI,EAEC8M,EAAY7F,EAAG8F,EAAWjN,MAAMC,QAAQ+M,GAAY7I,EAAK,EAAlE,IAAqE6I,EAAYC,EAAWD,EAAYA,EAAUzM,OAAOC,cAAe,CACtI,IAAI4L,EAEJ,GAAIa,EAAU,CACZ,GAAI9I,GAAM6I,EAAU5M,OAAQ,MAC5BgM,EAAOY,EAAU7I,SACZ,CAEL,IADAA,EAAK6I,EAAU5I,QACRC,KAAM,MACb+H,EAAOjI,EAAGtC,MAGZ,IAAIqL,EAAQd,EACRzB,EAAUuC,EAAMvC,QAChBJ,EAAS2C,EAAM3C,OACf8B,EAAOa,EAAMb,KAEb1B,IACFrF,EAAMyJ,cAAcC,WAAW,EAAI9O,GAAGyO,YAAcpE,EAAOsD,GAC3DvI,EAAMyJ,cAAcC,WAAW,EAAI9O,EAAI,GAAGyO,YAActC,EACxDnM,KAIJ,IAAI+O,GAAUpI,EAAII,IAASC,EAAOD,GAC9BoB,EAAO4G,EAASzB,EACpBnF,GAAQ,GAER,IAAI6G,EAAe5J,EAAMiJ,QAAQpG,wBAAwBG,MAIrDD,GAAO,EACTA,GAAO,EACEA,EAAO6G,EAAe1B,EAJlB,IAKbnF,EAAOmF,EALM,EAKqB0B,GAGpC5J,EAAMiJ,QAAQxF,MAAMV,KAAOA,EAAO,KAElC/C,EAAM6J,aAAatB,EAAQoB,GAE3B3J,EAAM8J,WAAWvI,KAIjBwI,EAAe,WACjBhC,EAAmBE,EAAOpF,wBAE1BmF,EAAkB,SAAyBgC,GACzC,IAAIxB,EAAUxI,EAAMV,MAAMkJ,QAC1B,OAAOwB,GAAS,GAAKA,EAAQxB,EAAQ1N,SAIrCoD,EAAe,SAAsBR,GAEvC,GAAIA,EAAMS,QAAQrD,OAAS,EAEzB,OAAOmP,IAGTF,IACA9B,EAAO7J,iBAAiB,WAAY6L,GACpChC,EAAO7J,iBAAiB,YAAaX,GACrCwK,EAAO7J,iBAAiB,WAAY6L,GACpChC,EAAO7J,iBAAiB,cAAe6L,GACvCxM,EAAYC,IAOd,SAASD,EAAYC,GACnB,IAAI6D,EAAI7D,EAAMC,eAAe,GAAGC,QAC5BiE,EAAInE,EAAMC,eAAe,GAAGE,QAE5B0D,EAAIwG,EAAiBhF,MAAQxB,EAAIwG,EAAiBhF,KAAOgF,EAAiB/E,OAASnB,EAAIkG,EAAiBmC,KAAOrI,EAAIkG,EAAiBmC,IAAMnC,EAAiBzD,OAC7J2F,IAEA5B,EAAQ9G,EAAGM,GAIf,SAAS/D,EAAcJ,GACrB2K,EAAQ3K,EAAME,QAASF,EAAMG,SAd/BoK,EAAO7J,iBAAiB,aAAcF,GAiBtC,IAAI+L,EAAc,SAASA,IACzBhC,EAAOhK,oBAAoB,cAAeH,GAC1CmK,EAAOhK,oBAAoB,eAAgBgM,GAC3ChC,EAAOhK,oBAAoB,gBAAiBgM,GAC5ChC,EAAOhK,oBAAoB,YAAaR,GACxCwK,EAAOhK,oBAAoB,WAAYgM,GACvChC,EAAOhK,oBAAoB,cAAegM,GAE1CjK,EAAM6I,WAGJsB,EAAiB,WACnBJ,IACA9B,EAAO7J,iBAAiB,cAAeN,GACvCmK,EAAO7J,iBAAiB,eAAgB6L,GACxChC,EAAO7J,iBAAiB,gBAAiB6L,IAI3C,OADAhC,EAAO7J,iBAAiB,eAAgB+L,GACjC,WACLF,IACAhC,EAAOhK,oBAAoBkM,GAC3BlC,EAAOhK,oBAAoBC,MAI/B2B,EAAgBI,KAAM,cAAe,WACtBD,EAAMV,MAAM2I,OAClBnM,YAAYkE,EAAMoK,MACzBpK,EAAMoK,UAAOpN,IAGf6C,EAAgBI,KAAM,gBAAiB,WACrC,IAAIoK,EAAkBrK,EAAMV,MAAM+K,gBAEzBC,EAAatK,EAAMiF,OAAQsF,EAAY7P,MAAMC,QAAQ2P,GAAaE,EAAM,EAAjF,IAAoFF,EAAaC,EAAYD,EAAaA,EAAWrP,OAAOC,cAAe,CACzJ,IAAIuP,EAEJ,GAAIF,EAAW,CACb,GAAIC,GAAOF,EAAWxP,OAAQ,MAC9B2P,EAAQH,EAAWE,SACd,CAEL,IADAA,EAAMF,EAAWxL,QACTC,KAAM,MACd0L,EAAQD,EAAIjO,MAGd,IAAImO,EAAQD,EACZJ,EAAgBvO,YAAY4O,GAG9B1K,EAAMiF,YAASjI,IAGjB6C,EAAgBI,KAAM,aAAc,SAAUsB,GACvCvB,EAAM2K,kBACT3K,EAAM4K,aAGR,IAAIpG,EAAexE,EAAMV,MACrBmC,EAAc+C,EAAa/C,YAC3BnB,EAAckE,EAAalE,YAC3BmE,EAAmBD,EAAaC,iBAChC0B,EAAO3B,EAAa2B,KAExBnG,EAAMoK,KAAKS,eAAe,KAAM,KAAMpG,EAAiB0B,EAAK5E,KAE5DvB,EAAMoK,KAAKS,eAAe,KAAM,KAAMpG,EAAiB0B,EAAK5E,KAE5DvB,EAAMoK,KAAKS,eAAe,KAAM,KAAM,GAEtC7K,EAAMoK,KAAKS,eAAe,KAAM,KAAMpG,EAAiBhD,EAAcnB,MAGvET,EAAgBI,KAAM,eAAgB,SAAUsI,EAAQoB,GAOtD,IANA,IAAImB,EAAe9K,EAAMV,MACrByL,EAAOD,EAAaC,KACpBlJ,EAAIiJ,EAAajJ,EACjBjH,EAAI,EACJoQ,EAAI,EAEDpQ,EAAIiH,EAAE/G,QAAQ,CACnB,GAAI+G,EAAEjH,GAAGyK,QAAS,CAChB,IAAIqF,EAAQ1K,EAAMiF,OAAO+F,GAErBC,EADKpJ,EAAEjH,GAAGqK,OAAOsD,GACHwC,EAClBL,EAAMjH,MAAMV,KAAO,GAAG/B,OAAgB,IAAT2I,EAAc,KAC3Ce,EAAMjH,MAAMyH,OAAS,GAAGlK,OAAgB,IAATiK,EAAc,KAC7CD,IAGFpQ,OAIJqF,KAAKX,MAAQA,EAnQjB,IAAsBa,EAAayD,EAAYC,EAgZ7C,OAhZoB1D,EAsQP2H,GAtQoBlE,EAsQX,CAAC,CACrBhE,IAAK,oBACLrD,MAAO,WACL0D,KAAKkL,SAAWlL,KAAKmL,kBAEtB,CACDxL,IAAK,uBACLrD,MAAO,WACL0D,KAAKkL,WACLlL,KAAK4I,YAEN,CACDjJ,IAAK,qBACLrD,MAAO,SAA4B+C,GAC7BW,KAAKX,QAAUA,IACjBW,KAAKX,MAAQA,KAGhB,CACDM,IAAK,QACLrD,MAAO,WACL0D,KAAKoL,gBACLpL,KAAKqL,eAEArL,KAAK0K,kBACR1K,KAAK2K,eAGR,CACDhL,IAAK,gBACLrD,MAAO,WACL,IAAIgP,EAAetL,KAAKX,MACpBuC,EAAI0J,EAAa1J,EACjB2J,EAAYD,EAAaC,UAE7BvL,KAAKgJ,QAAU5M,SAASC,cAAc,OACtC2D,KAAKgJ,QAAQ3C,UAAUC,IAAI,uBAC3BiF,EAAUhP,YAAYyD,KAAKgJ,SAE3BhJ,KAAKmJ,YAAc/M,SAASC,cAAc,MAC1C2D,KAAKmJ,YAAY9C,UAAUC,IAAI,8BAC/BtG,KAAKgJ,QAAQzM,YAAYyD,KAAKmJ,aAE9BnJ,KAAKwJ,cAAgBpN,SAASC,cAAc,MAC5C2D,KAAKwJ,cAAcnD,UAAUC,IAAI,8BACjCtG,KAAKgJ,QAAQzM,YAAYyD,KAAKwJ,eAEzB,IAAIgC,EAAa5J,EAAG6J,EAAYhR,MAAMC,QAAQ8Q,GAAaE,EAAM,EAAtE,IAAyEF,EAAaC,EAAYD,EAAaA,EAAWxQ,OAAOC,cAAe,CAC9I,IAAI0Q,EAEJ,GAAIF,EAAW,CACb,GAAIC,GAAOF,EAAW3Q,OAAQ,MAC9B8Q,EAAQH,EAAWE,SACd,CAEL,IADAA,EAAMF,EAAW3M,QACTC,KAAM,MACd6M,EAAQD,EAAIpP,MAGd,IAAIsP,EAAQD,EACRvG,EAAUwG,EAAMxG,QAChBL,EAAQ6G,EAAM7G,MAElB,GAAIK,EAAS,CAEX,IAAIyG,EAAezP,SAASC,cAAc,MAC1CwP,EAAarI,MAAMuB,MAAQA,EAC3B/E,KAAKwJ,cAAcjN,YAAYsP,GAE/B,IAAIC,EAAc1P,SAASC,cAAc,MACzCyP,EAAYtI,MAAMuB,MAAQA,EAC1B/E,KAAKwJ,cAAcjN,YAAYuP,OAIpC,CACDnM,IAAK,aACLrD,MAAO,WACL,IAAI0L,EAAShI,KAAKX,MAAM2I,OAExBhI,KAAKmK,KAAO/N,SAAS8K,gBADT,6BACgC,QAC5ClH,KAAKmK,KAAKxF,aAAa,QAAS,4BAChCqD,EAAO+D,aAAa/L,KAAKmK,KAAMnC,EAAOjE,cAAc,eAErD,CACDpE,IAAK,UACLrD,MAAO,WACL,GAAI0D,KAAKgJ,QAAS,CAChB,IAAIuC,EAAYvL,KAAKX,MAAMkM,UAC3BvL,KAAK+I,iBAAchM,EACnBwO,EAAU1P,YAAYmE,KAAKgJ,SAC3BhJ,KAAKgJ,aAAUjM,EACfiD,KAAKgM,gBAEDhM,KAAK0K,kBACP1K,KAAKiM,iBAIV,CACDtM,IAAK,iBACLrD,MAAO,WACL,IAAI0L,EAAShI,KAAKX,MAAM2I,OACxB,OAAOhI,KAAKmK,MAAQnK,KAAKmK,KAAK+B,aAAelE,IAE9C,CACDrI,IAAK,eACLrD,MAAO,WACL0D,KAAKgF,OAAS,GACd,IAAImH,EAAenM,KAAKX,MACpB+K,EAAkB+B,EAAa/B,gBAG1BgC,EAFDD,EAAavK,EAEIyK,EAAY5R,MAAMC,QAAQ0R,GAAaE,EAAM,EAAtE,IAAyEF,EAAaC,EAAYD,EAAaA,EAAWpR,OAAOC,cAAe,CAC9I,IAAIsR,EAEJ,GAAIF,EAAW,CACb,GAAIC,GAAOF,EAAWvR,OAAQ,MAC9B0R,EAAQH,EAAWE,SACd,CAEL,IADAA,EAAMF,EAAWvN,QACTC,KAAM,MACdyN,EAAQD,EAAIhQ,MAGd,IAAIsJ,EAAK2G,EAET,GAAI3G,EAAGR,QAAS,CACd,IAAIqF,EAAQrO,SAASC,cAAc,OACnCoO,EAAMpE,UAAUC,IAAI,6BACpBmE,EAAMjH,MAAMuB,MAAQa,EAAGb,MACvB/E,KAAKgF,OAAOjG,KAAK0L,GACjBL,EAAgB7N,YAAYkO,UA1YwCtL,EAAkBe,EAAY/E,UAAWwI,GAAiBC,GAAazE,EAAkBe,EAAa0D,GAgZ3KiE,EA1YT,GCVA,SAAStN,EAAmBC,GAAO,OAMnC,SAA4BA,GAAO,GAAIC,MAAMC,QAAQF,GAAM,CAAE,IAAK,IAAIG,EAAI,EAAGC,EAAO,IAAIH,MAAMD,EAAIK,QAASF,EAAIH,EAAIK,OAAQF,IAAOC,EAAKD,GAAKH,EAAIG,GAAM,OAAOC,GANnHE,CAAmBN,IAI7D,SAA0BO,GAAQ,GAAIC,OAAOC,YAAYC,OAAOH,IAAkD,uBAAzCG,OAAOC,UAAUC,SAASC,KAAKN,GAAgC,OAAON,MAAMa,KAAKP,GAJrFQ,CAAiBf,IAEtF,WAAgC,MAAM,IAAIgB,UAAU,mDAF0CC,GAQ9F,SAAS2F,EAAchC,GAAU,IAAK,IAAIzE,EAAI,EAAGA,EAAI+F,UAAU7F,OAAQF,IAAK,CAAE,IAAIgG,EAAyB,MAAhBD,UAAU/F,GAAa+F,UAAU/F,GAAK,GAAQiG,EAAU1F,OAAO2F,KAAKF,GAAqD,mBAAjCzF,OAAO4F,wBAAwCF,EAAUA,EAAQG,OAAO7F,OAAO4F,sBAAsBH,GAAQK,OAAO,SAAUC,GAAO,OAAO/F,OAAOgG,yBAAyBP,EAAQM,GAAK1B,eAAmBqB,EAAQO,QAAQ,SAAUxB,GAAOC,EAAgBR,EAAQO,EAAKgB,EAAOhB,MAAa,OAAOP,EAIxd,SAASD,EAAkBC,EAAQC,GAAS,IAAK,IAAI1E,EAAI,EAAGA,EAAI0E,EAAMxE,OAAQF,IAAK,CAAE,IAAI2E,EAAaD,EAAM1E,GAAI2E,EAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,UAAWF,IAAYA,EAAWG,UAAW,GAAMvE,OAAOwE,eAAeN,EAAQE,EAAWK,IAAKL,IAI7S,SAASM,EAAgBC,EAAKF,EAAKrD,GAAiK,OAApJqD,KAAOE,EAAO3E,OAAOwE,eAAeG,EAAKF,EAAK,CAAErD,MAAOA,EAAOiD,YAAY,EAAMC,cAAc,EAAMC,UAAU,IAAkBI,EAAIF,GAAOrD,EAAgBuD,EAO3M,IAAI2M,EAEJ,WACE,SAASA,EAAW1I,EAAUrC,GAC5B,IAAI1B,EAAQC,KAERyM,EAAQ/L,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,QAC5ErB,EAAQqB,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,GAAmBA,UAAU,GAAK,IApBpF,SAAyBT,EAAUC,GAAe,KAAMD,aAAoBC,GAAgB,MAAM,IAAI1E,UAAU,qCAsB5G2E,CAAgBH,KAAMwM,GAEtB5M,EAAgBI,KAAM,WAAY,SAAUvC,GAC1CsC,EAAMK,SAAS,CACbC,YAAaN,EAAMO,uBACnB2H,cAAelI,EAAM2M,qBACpB,KAGL9M,EAAgBI,KAAM,oBAAqBvD,EAASuD,KAAKO,SAAU,KAEnEX,EAAgBI,KAAM,WAAY,SAAU8E,GAC1C,IAAIlD,EAAI7B,EAAMU,MAAMmB,EAAEsD,KAAK,SAAUC,GACnC,OAAOA,EAAEL,KAAOA,IAIlB,GAAIlD,EAAEwD,SAKuB,IAJTrF,EAAMU,MAAMmB,EAAEZ,OAAO,SAAUmE,GAC/C,OAAOA,EAAEC,UAGKvK,OACd,OAIJ+G,EAAEwD,SAAWxD,EAAEwD,QAEfrF,EAAMK,SAAS,CACbwB,EAAG7B,EAAMU,MAAMmB,IAGjB,IAAI+K,EAAwB5M,EAAM6M,iBAAiB7M,EAAMU,MAAMmB,GAC3DiL,EAAOF,EAAsBE,KAC7B/B,EAAO6B,EAAsB7B,KAC7BhJ,EAAa6K,EAAsB7K,WACnCC,EAAa4K,EAAsB5K,WAMvC,OAJAhC,EAAM+M,gBAAgBD,EAAM/B,EAAMhJ,EAAYC,EAAYhC,EAAMU,MAAMmB,EAAEqE,IAAI,SAAUrE,GACpF,OAAOA,EAAEwD,QAAU,EAAI,MAGlB,IAGTxF,EAAgBI,KAAM,iBAAkB,SAAU1E,EAAMkL,GACtDzG,EAAMK,SAASL,EAAMgN,YAAYzR,EAAMkL,IAAK,KAG9C5G,EAAgBI,KAAM,uBAAwB,SAAUsB,EAAGM,GAEzD,OJvEoBoL,EIuEH1L,EAAE2E,IAAIlG,EAAMyE,kBJvENyI,EIuEyBrL,EAAEqE,IAAIlG,EAAMyE,kBJtEzDwI,EAAE/G,IAAI,SAAUiH,EAAIvS,GACzB,MAAO,GAAGoG,OAAOmM,EAAI,KAAKnM,OAAOkM,EAAEtS,MAFhC,IAAmBqS,EAAGC,II0EzBrN,EAAgBI,KAAM,mBAAoB,SAAUsB,GAClD,IAAI6L,EAAkBpN,EAAMV,MAAM8N,gBAClC,OAAOlK,KAAKmK,MAAM9L,EAAI6L,GAAmBA,IAG3CvN,EAAgBI,KAAM,OAAQ,SAAUsB,GACtC,IAAIE,EAAczB,EAAMV,MAAMmC,YAC1B6L,EAActN,EAAMU,MACpBiB,EAAO2L,EAAY3L,KAEvB,OAAQJ,EAAII,IADD2L,EAAY1L,KACKD,GAAQF,IAGtC5B,EAAgBI,KAAM,OAAQ,SAAU4B,GACtC,IAAIJ,EAAczB,EAAMV,MAAMmC,YAC1B8L,EAAevN,EAAMU,MACrBoM,EAAOS,EAAaT,KAGxB,OAAQjL,EAAIiL,IAFDS,EAAaxC,KAEI+B,GAAQrL,EADlB8L,EAAajN,cAIjCT,EAAgBI,KAAM,sBAAuB,WAC3C,IAAIuN,EAAmBxN,EAAMV,MAAMkO,iBAC/BC,EAAezN,EAAMU,MACrBgN,EAAsBD,EAAaC,oBACnCC,EAAqBF,EAAaE,mBAClCC,EAAmBH,EAAaG,iBAChCC,EAAiBJ,EAAaI,eAC9BC,EAAWL,EAAaK,SACxBC,EAASN,EAAaM,OACtBC,EAAWP,EAAaO,SACxBC,EAASR,EAAaQ,OACtBC,EAAiBT,EAAaS,eAC9BC,EAAeV,EAAaU,aAC5BC,EAAiBX,EAAaW,eAC9BC,EAAeZ,EAAaY,aAC5BC,EAAUrR,KAAKC,MAAQwQ,EACvBzK,EAAQC,KAAKlH,IAAIsS,EAAUX,EAAoB,GACnD1K,EAAQsL,EAAOf,GAAkBvK,GAEjCjD,EAAMK,SAAS,CACbsE,aAAckJ,EAAe3H,IAAI,SAAUd,EAAGxK,GAC5C,OAAOgT,EAAiBhT,IAAMiT,EAAejT,GAAKgT,EAAiBhT,IAAMqI,IAE3E6J,KAAMgB,GAAYC,EAASD,GAAY7K,EACvC8H,KAAMiD,GAAYC,EAASD,GAAY/K,EACvClB,WAAYmM,GAAkBC,EAAeD,GAAkBjL,EAC/DjB,WAAYoM,GAAkBC,EAAeD,GAAkBnL,IAI/DjD,EAAMwO,WADJvL,EAAQ,EACSwL,sBAAsBzO,EAAM0O,0BAE5B1R,IAIvB6C,EAAgBI,KAAM,iBAAkB,SAAU4B,GAChD,IAAI8M,EAAe3O,EAAMU,MACrBiB,EAAOgN,EAAahN,KACpBC,EAAO+M,EAAa/M,KAEpBmJ,GADO4D,EAAa7B,KACb6B,EAAa5D,MACpBX,EAAO/N,SAASC,cAAc,QAMlC,OALA8N,EAAK9D,UAAUC,IAAI,yBACnB6D,EAAKxF,aAAa,KAAM5E,EAAMyE,iBAAiBzE,EAAMmG,KAAKxE,KAC1DyI,EAAKxF,aAAa,KAAM5E,EAAMyE,iBAAiBzE,EAAMmG,KAAKvE,KAC1DwI,EAAKxF,aAAa,KAAM5E,EAAMyE,iBAAiBzE,EAAMoG,KAAK2E,EAAOlJ,KACjEuI,EAAKxF,aAAa,KAAM5E,EAAMyE,iBAAiBzE,EAAMoG,KAAK2E,EAAOlJ,KAC1DuI,IAGTvK,EAAgBI,KAAM,aAAc,SAAU0B,EAAMC,EAAMkL,EAAM/B,EAAM6D,GACpE,IAAIpN,EAAcxB,EAAMV,MACpBuP,EAAsBrN,EAAYqN,oBAClCzG,EAAS5G,EAAY4G,OACzBzM,EAAaqE,EAAM8O,OACnBnT,EAAaqE,EAAM+O,OACnBhT,EAAkBiE,EAAM8O,MAAOnN,EAAMC,EAAMiN,EAAqB,SAAUG,GACxE,IAAI7F,EAAO,IAAIlM,KAAK+R,GACpB,MAAO,GAAGhO,OAAOoH,EAAOe,EAAKI,YAAa,KAAKvI,OAAOmI,EAAKK,aAE7DzN,EAAkBiE,EAAM+O,MAAOjC,EAAM/B,EAAM8D,GAC3C7O,EAAM+O,MAAMtL,MAAMa,OAAS,GAAGtD,OAAO,IAAM4N,EAAY,OAGzD3O,KAAKX,MAAQ+B,EAAc,CACzBqL,MAAOA,EACPiB,mBAAoB,IACpBH,iBAAkB,cAClBqB,oBAAqB,EACrBI,mBAAoB,GACpBxN,YAAa,IACb2L,gBAAiBlK,KAAKgM,IAAI,GAAI5P,EAAM6P,WAAa,GACjD/G,OAAQgH,EACRjH,SAAUkH,GACT/P,GACHW,KAAK8D,SAAWA,EAChB9D,KAAKyB,KAAOL,EAAc,GAAIK,EAAM,CAClCC,KAAMuB,KAAKlH,IAAI0J,MAAMxC,KAAM1I,EAAmBkH,EAAKH,EAAE0D,SACrDrD,KAAMsB,KAAKjH,IAAIyJ,MAAMxC,KAAM1I,EAAmBkH,EAAKH,EAAE0D,SACrDpD,EAAGH,EAAKG,EAAEqE,IAAI,SAAUrE,GACtB,OAAOR,EAAc,GAAIQ,EAAG,CAC1B7F,IAAKkH,KAAKlH,IAAI0J,MAAMxC,KAAM1I,EAAmBqH,EAAEoD,SAC/ChJ,IAAKiH,KAAKjH,IAAIyJ,MAAMxC,KAAM1I,EAAmBqH,EAAEoD,eAlLzD,IAAsB9E,EAAayD,EAAYC,EAokB7C,OApkBoB1D,EAwLPsM,GAxLoB7I,EAwLR,CAAC,CACxBhE,IAAK,oBACLrD,MAAO,WACL0D,KAAK8D,SAASuC,UAAUC,IAAI,cAC5BtG,KAAK8D,SAASyC,UAAY,WAAWxF,OAAO4F,EAAe0I,QAAQ,UAAWrP,KAAKX,MAAMoN,OAAQ,YAAY1L,OAAOjB,EAAS6G,eAAgB,YAAY5F,OAAO6F,EAASD,eAAgB,UACzL3G,KAAKsP,iBAAmBtP,KAAK8D,SAASC,cAAc,qBACpD/D,KAAKgI,OAAShI,KAAK8D,SAASC,cAAc,uBAC1C/D,KAAKuP,cAAgBvP,KAAK8D,SAASC,cAAc,+BACjD/D,KAAK6O,MAAQ7O,KAAK8D,SAASC,cAAc,kBACzC/D,KAAK8O,MAAQ9O,KAAK8D,SAASC,cAAc,kBAEzC/D,KAAKS,MAAQT,KAAKwP,kBAClBxP,KAAK2C,SAAW,IAAI7C,EAASE,KAAKyP,oBAClCzP,KAAK2C,SAAS+M,oBACd1P,KAAK2P,SAAW,IAAI/I,EAAS5G,KAAK4P,oBAClC5P,KAAK2P,SAASD,oBACd1P,KAAKgJ,QAAU,IAAInB,EAAQ7H,KAAK6P,mBAChC7P,KAAKgJ,QAAQ0G,oBAEb3R,OAAOI,iBAAiB,SAAU6B,KAAKmE,mBACvCnE,KAAKqB,WAEN,CACD1B,IAAK,uBACLrD,MAAO,WACL0D,KAAK2C,SAASmN,uBACd9P,KAAK8D,SAASuC,UAAU0J,OAAO,cAC/BrU,EAAasE,KAAK8D,UAElB/F,OAAOC,oBAAoB,SAAUgC,KAAKmE,qBAE3C,CACDxE,IAAK,uBACLrD,MAAO,WACL,IAAIwL,EAAmB9H,KAAKgI,OAAOpF,wBACnC,OAAOkF,EAAiB/E,MAAQ+E,EAAiBzD,SAElD,CACD1E,IAAK,mBACLrD,MAAO,WAEL,OADuB0D,KAAKgI,OAAOpF,wBACXG,QAEzB,CACDpD,IAAK,WACLrD,MAAO,SAAkBkE,GACvB,IAAIwP,IAAiBtP,UAAU7F,OAAS,QAAsBkC,IAAjB2D,UAAU,KAAmBA,UAAU,GACpFV,KAAKS,MAAQW,EAAc,GAAIpB,KAAKS,MAAOD,GAC3CR,KAAKqB,SAED2O,GACFhQ,KAAK2C,SAASsN,mBAAmBjQ,KAAKyP,oBAGxCzP,KAAKgJ,QAAQiH,mBAAmBjQ,KAAK6P,qBAEtC,CACDlQ,IAAK,mBACLrD,MAAO,WACL,MAAO,CACLwH,SAAU9D,KAAK8D,SACfrC,KAAMzB,KAAKyB,KACXD,YAAaxB,KAAKX,MAAMmC,YACxBgD,iBAAkBxE,KAAKwE,iBACvBC,qBAAsBzE,KAAKyE,qBAC3BrB,UAAWpD,KAAKS,MAAM2C,UACtBD,QAASnD,KAAKS,MAAM0C,QACpBrB,WAAY9B,KAAKS,MAAMqB,WACvBC,WAAY/B,KAAKS,MAAMsB,WACvBH,EAAG5B,KAAKS,MAAMmB,EACd8C,aAAc1E,KAAKS,MAAMiE,aACzBb,eAAgB7D,KAAK6D,kBAGxB,CACDlE,IAAK,mBACLrD,MAAO,WACL,MAAO,CACLwH,SAAU9D,KAAK8D,SACfrC,KAAMzB,KAAKyB,KACX6F,SAAUtH,KAAKsH,YAGlB,CACD3H,IAAK,kBACLrD,MAAO,WACL,MAAO,CACL0L,OAAQhI,KAAKgI,OACbC,cAAejI,KAAKS,MAAMwH,cAC1BsD,UAAWvL,KAAKsP,iBAChBlF,gBAAiBpK,KAAKuP,cACtBrH,SAAUlI,KAAKX,MAAM6I,SACrBC,OAAQnI,KAAKX,MAAM8I,OACnB3G,YAAaxB,KAAKX,MAAMmC,YACxBnB,YAAaL,KAAKS,MAAMJ,YACxB6F,KAAMlG,KAAKkG,KACX1B,iBAAkBxE,KAAKwE,iBACvB9C,KAAM1B,KAAKS,MAAMiB,KACjBC,KAAM3B,KAAKS,MAAMkB,KACjBmJ,KAAM9K,KAAKS,MAAMqK,KACjBvC,QAASvI,KAAKS,MAAM8H,QACpB3G,EAAG5B,KAAKS,MAAMmB,KAGjB,CACDjC,IAAK,kBACLrD,MAAO,WACL,IAII4T,EAJAlB,EAAqBhP,KAAKX,MAAM2P,mBAChCmB,EAAanQ,KAAKyB,KAClBC,EAAOyO,EAAWzO,KAClBC,EAAOwO,EAAWxO,KAIpBuO,EADElQ,KAAKyB,KAAKH,EAAE0D,OAAOnK,OAASmU,EAClBhP,KAAKyB,KAAKH,EAAE0D,OAAOnK,OAASmU,EAE5B,EAGd,IACI5L,GADQpD,KAAKyB,KAAKH,EAAE0D,OAAOkL,GACNxO,IAASC,EAAOD,GAEzC,OAAON,EAAc,GAAIpB,KAAK+M,YAAY3J,EAD5B,GACiD,CAC7D/C,YAAaL,KAAKM,uBAClB2H,cAAejI,KAAK0M,mBACpBhI,aAAc1E,KAAKyB,KAAKG,EAAEqE,IAAI,SAAUd,GACtC,OAAO,QAIZ,CACDxF,IAAK,cACLrD,MAAO,SAAqB8G,EAAWD,GACrC,IAKI+M,EAUAE,EAfA9L,EAAStE,KAETsB,EAAItB,KAAKyB,KAAKH,EACdI,EAAO1B,KAAKyB,KAAKC,KAAO0B,GAAapD,KAAKyB,KAAKE,KAAO3B,KAAKyB,KAAKC,MAChEC,EAAO3B,KAAKyB,KAAKC,KAAOyB,GAAWnD,KAAKyB,KAAKE,KAAO3B,KAAKyB,KAAKC,MAIhEwO,EADExO,IAAS1B,KAAKyB,KAAKC,KACT,EAEAJ,EAAE0D,OAAO0D,UAAU,SAAUpH,GACvC,OAAOA,EAAII,IACR,EAML0O,EADEzO,IAAS3B,KAAKyB,KAAKE,KACXL,EAAE0D,OAAOnK,OAAS,EAElByG,EAAE0D,OAAO0D,UAAU,SAAUpH,GACrC,OAAOA,EAAIK,IAIf,IAAI4G,EAAUjH,EAAE0D,OAAOa,MAAMqK,EAAWE,EAAU,GAC9CC,EAAe9H,EAAQ1C,QAEvB0C,EAAQ1N,QAAU,IAChByG,EAAE0D,OAAOkL,KAAexO,IAC1B2O,EAAa,GAAK3O,GAGhBJ,EAAE0D,OAAOoL,KAAazO,IACxB0O,EAAaA,EAAaxV,OAAS,GAAK8G,IAI5C,IAAIC,EAAI5B,KAAKyB,KAAKG,EAAEqE,IAAI,SAAUrE,EAAGjH,GACnC,IAAIqK,EAASV,EAAO7C,KAAKG,EAAEjH,GAAGqK,OAAOa,MAAMqK,EAAWE,EAAU,GAE5DE,EAActL,EAAOa,QAEzB,GAAI0C,EAAQ1N,QAAU,EAAG,CACvB,GAAIyG,EAAE0D,OAAOkL,KAAexO,EAAM,CAChC,IAAI6O,EAAejM,EAAO7C,KAAKG,EAAEjH,GAAGqK,OAAOkL,GAGvCM,EAAaD,GAFJjM,EAAO7C,KAAKG,EAAEjH,GAAGqK,OAAOkL,EAAY,GAEPK,KADZ7O,EAAO4C,EAAO7C,KAAKH,EAAE0D,OAAOkL,KAAe5L,EAAO7C,KAAKH,EAAE0D,OAAOkL,EAAY,GAAK5L,EAAO7C,KAAKH,EAAE0D,OAAOkL,KAEpII,EAAY,GAAKE,EAGnB,GAAIlP,EAAE0D,OAAOoL,KAAazO,EAAM,CAC9B,IAAI8O,EAAYnM,EAAO7C,KAAKG,EAAEjH,GAAGqK,OAAOoL,GACpCM,EAAOpM,EAAO7C,KAAKG,EAAEjH,GAAGqK,OAAOoL,EAAU,GAEzCO,EAAWD,GAAQD,EAAYC,KADP/O,EAAO2C,EAAO7C,KAAKH,EAAE0D,OAAOoL,EAAU,KAAO9L,EAAO7C,KAAKH,EAAE0D,OAAOoL,GAAW9L,EAAO7C,KAAKH,EAAE0D,OAAOoL,EAAU,KAExIE,EAAYA,EAAYzV,OAAS,GAAK8V,GAI1C,OAAOvP,EAAc,GAAIkD,EAAO7C,KAAKG,EAAEjH,GAAI2J,EAAO7D,MAAQ6D,EAAO7D,MAAMmB,EAAEjH,GAAK,CAC5EyK,SAAS,GACR,CACDJ,OAAQA,EACRsL,YAAaA,EAEbvU,IAAK,EAELC,IAAKiH,KAAKjH,IAAIyJ,MAAMxC,KAAM1I,EAAmB+V,QAGjD,OAAOlP,EAAc,CACnBM,KAAMA,EACNC,KAAMA,EACNuO,UAAWA,EACXE,QAASA,EACThN,UAAWA,EACXD,QAASA,EACToF,QAASA,EACT8H,aAAcA,GACbrQ,KAAK4M,iBAAiBhL,GAAI,CAC3BA,EAAGA,MAGN,CACDjC,IAAK,mBACLrD,MAAO,SAA0BsF,GAE/B,IAAIiL,EAAO+D,EAAAA,EACP9F,GAAQ8F,EAAAA,EAEHnJ,EAAY7F,EAAG8F,EAAWjN,MAAMC,QAAQ+M,GAAY7I,EAAK,EAAlE,IAAqE6I,EAAYC,EAAWD,EAAYA,EAAUzM,OAAOC,cAAe,CACtI,IAAI4L,EAEJ,GAAIa,EAAU,CACZ,GAAI9I,GAAM6I,EAAU5M,OAAQ,MAC5BgM,EAAOY,EAAU7I,SACZ,CAEL,IADAA,EAAK6I,EAAU5I,QACRC,KAAM,MACb+H,EAAOjI,EAAGtC,MAGZ,IAAIsJ,EAAKiB,EAELjB,EAAGR,UACLyH,EAAO5J,KAAKlH,IAAI8Q,EAAMjH,EAAG7J,KACzB+O,EAAO7H,KAAKjH,IAAI8O,EAAMlF,EAAG5J,MAK7B,IAAI8F,EAAa8O,EAAAA,EACb7O,GAAc6O,EAAAA,EAEdhM,EAAQ,WACV,GAAI0F,EAAW,CACb,GAAIC,GAAOF,EAAWxP,OAAQ,MAAO,QACrC8M,EAAQ0C,EAAWE,SACd,CAEL,IADAA,EAAMF,EAAWxL,QACTC,KAAM,MAAO,QACrB6I,EAAQ4C,EAAIjO,MAGd,IAAIsJ,EAAK+B,EACK/F,EAAEsD,KAAK,SAAUC,GAC7B,OAAOA,EAAEL,KAAOc,EAAGd,KAClBM,UAGDtD,EAAamB,KAAKlH,IAAI+F,EAAY8D,EAAG7J,KACrCgG,EAAakB,KAAKjH,IAAI+F,EAAY6D,EAAG5J,OAIhCqO,EAAarK,KAAKyB,KAAKG,EAAG0I,EAAY7P,MAAMC,QAAQ2P,GAAaE,EAAM,EAAhF,IAAmFF,EAAaC,EAAYD,EAAaA,EAAWrP,OAAOC,cAAe,CACxJ,IAAI0M,EAIJ,GAAa,UAFF/C,IAEW,MAKxB,MAAO,CACLiI,KAAMA,EACN/B,KAAMA,EACNhJ,WAJFA,EAAa,EAKXC,WAAYA,KAGf,CACDpC,IAAK,SACLrD,MAAO,WACL,IAAIuU,EAAS7Q,KAET6B,EAAe7B,KAAKX,MACpBmC,EAAcK,EAAaL,YAC3BoN,EAAsB/M,EAAa+M,oBACnCkC,EAAe9Q,KAAKS,MACpBiB,EAAOoP,EAAapP,KACpBC,EAAOmP,EAAanP,KACpBkL,EAAOiE,EAAajE,KACpB/B,EAAOgG,EAAahG,KACpBuF,EAAeS,EAAaT,aAC5BhQ,EAAcyQ,EAAazQ,YAC3BqE,EAAeoM,EAAapM,aAEhChJ,EAAasE,KAAKgI,QAElBhI,KAAKgI,OAAOrD,aAAa,UAAW,OAAO5D,OAAOS,EAAa,KAAKT,OAAOf,KAAKwE,iBAAiBhD,EAAcnB,KAE/G,IAAI0Q,EAAQlE,EACRmE,EJzeH,SAAoCC,EAAGC,GAG5C,IAFAD,EAAIhO,KAAKkO,MAAMF,KAEF,CACX,GAAIA,EAAIC,EACN,OAAOA,EAGT,GAAID,EAAIC,GAAY,EAClB,OAAOD,EAGTA,KI6dcG,CAA2BtG,EAAM,IACzC6D,GAAc7D,EAAO+B,IAASmE,EAAQD,GAGjCvF,EJ9dR,SAAwBzP,EAAKC,EAAKC,GAIvC,IAHA,IAAI+I,EAAS,IAAIvK,MAAMwB,GACnBtB,EAAI,EAEDA,EAAIsB,GACT+I,EAAOrK,GAAKoB,EAAMpB,GAAKqB,EAAMD,IAAQE,EAAyB,GAC9DtB,IAGF,OAAOqK,EImdkBqM,CAAeN,EAAOC,EAAOpC,GAEZnD,EAAYhR,MAAMC,QAAQ8Q,GAAaE,EAAM,EAAnF,IAAsFF,EAAaC,EAAYD,EAAaA,EAAWxQ,OAAOC,cAAe,CAC3J,IAAIuP,EAEJ,GAAIiB,EAAW,CACb,GAAIC,GAAOF,EAAW3Q,OAAQ,MAC9B2P,EAAQgB,EAAWE,SACd,CAEL,IADAA,EAAMF,EAAW3M,QACTC,KAAM,MACd0L,EAAQkB,EAAIpP,MAGd,IAAIsF,EAAI4I,EACRxK,KAAKgI,OAAOzL,YAAYyD,KAAKsR,eAAe1P,IAM9C,IAFA,IAAIjH,EAAI,EAEDA,EAAIqF,KAAKS,MAAMmB,EAAE/G,QAAQ,CAC9B,IAAI0W,EAAkBvR,KAAKS,MAAMmB,EAAEjH,GAC/BoK,EAAQwM,EAAgBxM,MACxBuL,EAAciB,EAAgBjB,YAC9BlL,EAAUmM,EAAgBnM,QAC1BH,EAAUP,EAAa/J,GAE3B,GAAIyK,GAAWH,EAAU,EAAG,CAC1B,IAAIe,EAAQ5J,SAASC,cAAc,YACnC2J,EAAMrB,aAAa,SAAUI,GAC7BiB,EAAMrB,aAAa,SAAU3E,KAAKyE,qBAAqB4L,EAAapK,IAAIjG,KAAKkG,MAAOoK,EAAYrK,IAAI,SAAUrE,GAC5G,OAAOiP,EAAO1K,KAAK2E,EAAOlJ,MACxBwE,KAAK,MACTJ,EAAMK,UAAUC,IAAI,qBAEJ,IAAZrB,IACFe,EAAMxC,MAAMyB,QAAUA,GAGxBjF,KAAKgI,OAAOzL,YAAYyJ,GAG1BrL,IAKFqF,KAAKgI,OAAOzB,WAAa,GAEzBvG,KAAKwR,WAAW9P,EAAMC,EAAMoP,EAAOC,EAAOrC,KAE3C,CACDhP,IAAK,kBACLrD,MAAO,SAAyBuQ,EAAM/B,EAAMhJ,EAAYC,EAAY2C,GAClE,IAAI+M,EAAwBzR,KAAKX,MAAMqO,mBAEnC1N,KAAKuO,YACPmD,qBAAqB1R,KAAKuO,YAG5B,IAAIoD,EAAe3R,KAAKS,MAAMqK,KAAO9K,KAAKS,MAAMoM,KAC5C+E,EAAY3O,KAAK8C,IAAI+E,EAAO9K,KAAKS,MAAMqK,MAAQ6G,EAC/CE,EAAY5O,KAAK8C,IAAI8G,EAAO7M,KAAKS,MAAMoM,MAAQ8E,EAC/CG,EAAS7O,KAAKjH,IAAI6V,EAAWD,GAC7BlE,EAAqB+D,EAAwBxO,KAAKjH,IAAI,GAA6B,EAAxBiH,KAAKlH,IAAI+V,EAAQ,KAChF9R,KAAKI,SAAS,CACZuN,iBAAkB3N,KAAKS,MAAMiE,aAC7BkJ,eAAgBlJ,EAChBmJ,SAAU7N,KAAKS,MAAMoM,KACrBkB,SAAU/N,KAAKS,MAAMqK,KACrBgD,OAAQjB,EACRmB,OAAQlD,EACRmD,eAAgBjO,KAAKS,MAAMqB,WAC3BqM,eAAgBnO,KAAKS,MAAMsB,WAC3BmM,aAAcpM,EACdsM,aAAcrM,EACd0L,oBAAqBzQ,KAAKC,MAC1ByQ,mBAAoBA,IAGtB1N,KAAKuO,WAAaC,sBAAsBxO,KAAKyO,0BAhkB2BtP,EAAkBe,EAAY/E,UAAWwI,GAAiBC,GAAazE,EAAkBe,EAAa0D,GAokB3K4I,EAzjBT,GA6jBI2C,EAAS,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACvFC,EAAW,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OACtDzI,EAAiB,ogBAEjB2H,EAAS,CACXyD,OAAQ,SAAgBC,GACtB,OAAOA,GAETC,aAAc,SAAsBD,GAClC,OAAQ,EAAI/O,KAAKiP,IAAIjP,KAAKkP,GAAKH,EAAI/O,KAAKkP,GAAK,IAAM,GAErDC,cAAe,SAAuBJ,GACpC,OAAOA,EAAI,GAAK,EAAIA,EAAIA,GAAU,EAAI,EAAIA,GAAKA,EAAlB,GAE/BK,eAAgB,SAAwBL,GACtC,OAAOA,EAAI,GAAK,EAAIA,EAAIA,EAAIA,GAAKA,EAAI,IAAM,EAAIA,EAAI,IAAM,EAAIA,EAAI,GAAK,GAExEM,aAAc,SAAsBN,GAClC,QAASA,EAAIA,EAAIA,EAAI,GAEvBO,YAAa,SAAqBP,GAChC,OAAOA,GAAK,EAAIA,YC1mBL,SAAoBlO,EAAUrC,EAAMgL,EAAO+F,GACxD,IAAIC,EAAa,IAAIjG,EAAW1I,EAAUrC,EAAMgL,EAAO+F,GAEvD,OADAC,EAAW/C,oBACJ,WACL+C,EAAW3C"}