{"version":3,"file":"chartogram.js","sources":["../modules/index.js"],"sourcesContent":["function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nexport default function chartogram(rootNode, data) {\n  var title = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'Title';\n  var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n  // clearElement(rootNode)\n  rootNode.innerHTML = \"\\n\\t\\t<header class=\\\"chartogram__header\\\">\\n\\t\\t\\t<h1 class=\\\"chartogram__title\\\">\".concat(title, \"</h1>\\n\\t\\t</header>\\n\\t\\t<div class=\\\"chartogram__plan-with-axes\\\">\\n\\t\\t\\t<div class=\\\"chartogram__plan\\\">\\n\\t\\t\\t\\t<div class=\\\"chartogram__top-border\\\"></div>\\n\\t\\t\\t\\t<div class=\\\"chartogram__canvas-wrapper\\\">\\n\\t\\t\\t\\t\\t<svg class=\\\"chartogram__canvas\\\" preserveAspectRatio=\\\"none\\\"></svg>\\n\\t\\t\\t\\t\\t<div class=\\\"chartogram__x\\\"></div>\\n\\t\\t\\t\\t\\t<div class=\\\"chartogram__y-wrapper\\\">\\n\\t\\t\\t\\t\\t\\t<div class=\\\"chartogram__y\\\"></div>\\n\\t\\t\\t\\t\\t</div>\\n\\t\\t\\t\\t</div>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"chartogram__timeline\\\">\\n\\t\\t\\t<div class=\\\"chartogram__timeline-canvas-padding\\\">\\n\\t\\t\\t\\t<svg class=\\\"chartogram__timeline-canvas\\\" preserveAspectRatio=\\\"none\\\"></svg>\\n\\t\\t\\t</div>\\n\\t\\t\\t<div class=\\\"chartogram__timeline-overlay-left\\\"></div>\\n\\t\\t\\t<div class=\\\"chartogram__timeline-overlay-right\\\"></div>\\n\\t\\t\\t<div class=\\\"chartogram__timeline-window\\\">\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__drag\\\"></button>\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__left-handle\\\"></button>\\n\\t\\t\\t\\t<button type=\\\"button\\\" class=\\\"chartogram__reset-button chartogram__timeline-window__right-handle\\\"></button>\\n\\t\\t\\t</div>\\n\\t\\t</div>\\n\\t\\t<div class=\\\"chartogram__chart-togglers\\\"></div>\\n\\t\");\n  rootNode.classList.add('chartogram');\n  var GAUGE_TICK_MARKS_COUNT = options.gaugeMarkTicksCount || 6;\n  var TIMELINE_WINDOW_SIZE = options.timelineWindowSize || 40;\n  var TIMELINE_CHART_MAX_POINTS = options.timelineChartMaxPoints || 80;\n  var MONTHS = options.months || ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n  var WEEKDAYS = options.weekdays || ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n  var tooltipContainer = document.querySelector('.chartogram__plan');\n  var canvas = document.querySelector('.chartogram__canvas');\n  var canvasWrapper = document.querySelector('.chartogram__canvas-wrapper');\n  var xAxis = document.querySelector('.chartogram__x');\n  var yAxis = document.querySelector('.chartogram__y');\n  var timeline = document.querySelector('.chartogram__timeline');\n  var timelineOverlayLeft = document.querySelector('.chartogram__timeline-overlay-left');\n  var timelineWindowLeftHandle = document.querySelector('.chartogram__timeline-window__left-handle');\n  var timelineWindow = document.querySelector('.chartogram__timeline-window');\n  var timelineWindowDrag = document.querySelector('.chartogram__timeline-window__drag');\n  var timelineWindowRightHandle = document.querySelector('.chartogram__timeline-window__right-handle');\n  var timelineOverlayRight = document.querySelector('.chartogram__timeline-overlay-right');\n  var timelineCanvas = document.querySelector('.chartogram__timeline-canvas');\n  var timelineWindowFrom;\n  var timelineWindowTo;\n  var showGraphs;\n  var showGraphsNext;\n  var timelineWindowGraphs;\n  var timelineWindowMinX;\n  var timelineWindowMaxX;\n  var timelineWindowMinY;\n  var timelineWindowMaxY;\n  var shiftX;\n  var timelineWindowXScaled;\n  var tooltip;\n  var tooltipDate;\n  var tooltipValues;\n  var tooltipForX;\n  var tooltipPoints;\n  var tooltipLine; // A stub for possible animations.\n\n  var yScale = 1;\n  setUpTimelineWindowHandle('left');\n  setUpTimelineWindowHandle('right');\n  setUpTimelineWindow();\n  displayGraphs();\n  setUpCanvas();\n\n  function clearElement(element) {\n    while (element.firstChild) {\n      element.removeChild(element.firstChild);\n    }\n  }\n\n  function commaJoin(a, b) {\n    return a.map(function (ai, i) {\n      return \"\".concat(ai, \",\").concat(b[i]);\n    });\n  }\n\n  function getLowerSiblingDivisibleBy(n, divider) {\n    while (true) {\n      if (n < divider) {\n        return divider;\n      }\n\n      if (n % divider === 0) {\n        return n;\n      }\n\n      n--;\n    }\n  }\n\n  function divideInterval(min, max) {\n    var points = new Array(GAUGE_TICK_MARKS_COUNT);\n    var i = 0;\n\n    while (i < GAUGE_TICK_MARKS_COUNT) {\n      points[i] = min + i * (max - min) / (GAUGE_TICK_MARKS_COUNT - 1);\n      i++;\n    }\n\n    return points;\n  }\n\n  function drawGauge(element, min, max, transform) {\n    var i = 0;\n\n    while (i < GAUGE_TICK_MARKS_COUNT) {\n      var tickMark = document.createElement('div');\n      var value = min + i * (max - min) / (GAUGE_TICK_MARKS_COUNT - 1);\n\n      if (transform) {\n        value = transform(value);\n      }\n\n      tickMark.appendChild(document.createTextNode(value));\n      element.appendChild(tickMark);\n      i++;\n    }\n  }\n\n  function displayGraphs() {\n    showGraphs = {};\n\n    for (var _iterator = data.lines, _isArray = Array.isArray(_iterator), _i2 = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i2 >= _iterator.length) break;\n        _ref = _iterator[_i2++];\n      } else {\n        _i2 = _iterator.next();\n        if (_i2.done) break;\n        _ref = _i2.value;\n      }\n\n      var line = _ref;\n      showGraphs[line.id] = true;\n    }\n\n    showGraphsNext = undefined;\n\n    if (data.x.points.length > TIMELINE_WINDOW_SIZE) {\n      var xMin = data.x.points[0];\n      var xMax = data.x.points[data.x.points.length - 1];\n      var xFrom = data.x.points[data.x.points.length - TIMELINE_WINDOW_SIZE];\n      timelineWindowFrom = (xFrom - xMin) / (xMax - xMin);\n    } else {\n      timelineWindowFrom = 0;\n    }\n\n    timelineWindowTo = 1;\n    updateTimelineWindow();\n    drawGraphs(true);\n    tooltipLine = undefined; // Add graph togglers.\n\n    var graphTogglers = document.querySelector('.chartogram__chart-togglers');\n    clearElement(graphTogglers);\n\n    for (var _iterator2 = data.lines, _isArray2 = Array.isArray(_iterator2), _i3 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i3 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i3++];\n      } else {\n        _i3 = _iterator2.next();\n        if (_i3.done) break;\n        _ref2 = _i3.value;\n      }\n\n      var _line = _ref2;\n      graphTogglers.appendChild(createGraphToggler(_line));\n    }\n  }\n\n  function drawGraphs(redrawTimeline) {\n    var x = data.x.points; // Chrome can't handle timestamps in milliseconds for point coordinates (draws nothing).\n    // Reducing timestamps to lower numbers to work around that bug.\n\n    shiftX = x[0];\n    var xScaledAll = x.map(function (_) {\n      return (_ - shiftX) / 1000;\n    }); // Clear canvas.\n\n    clearElement(canvas); // Calculate bounds.\n\n    var minXOverall = xScaledAll[0];\n    var maxXOverall = xScaledAll[xScaledAll.length - 1];\n    var deltaX = maxXOverall - minXOverall;\n    var minX = minXOverall + timelineWindowFrom * deltaX;\n    var maxX = maxXOverall - (1 - timelineWindowTo) * deltaX;\n    var minXIndex = xScaledAll.findIndex(function (x) {\n      return x > minX;\n    }) - 1;\n\n    if (minXIndex < 0) {\n      minXIndex = 0;\n    }\n\n    var maxXIndex = xScaledAll.findIndex(function (x) {\n      return x > maxX;\n    });\n\n    if (maxXIndex < 0) {\n      maxXIndex = xScaledAll.length - 1;\n    }\n\n    var xScaled = xScaledAll.slice(minXIndex, maxXIndex + 1); // let minY = Infinity\n    // let minYOverall = Infinity\n    // Min Y is always 0 by design.\n\n    var minY = 0;\n    var maxY = 0;\n    var maxYOverall = 0;\n    timelineWindowGraphs = [];\n    var graphsAll = [];\n\n    for (var _iterator3 = data.lines, _isArray3 = Array.isArray(_iterator3), _i4 = 0, _iterator3 = _isArray3 ? _iterator3 : _iterator3[Symbol.iterator]();;) {\n      var _ref3;\n\n      if (_isArray3) {\n        if (_i4 >= _iterator3.length) break;\n        _ref3 = _iterator3[_i4++];\n      } else {\n        _i4 = _iterator3.next();\n        if (_i4.done) break;\n        _ref3 = _i4.value;\n      }\n\n      var line = _ref3;\n\n      if (!showGraphs[line.id]) {\n        continue;\n      }\n\n      graphsAll.push(line); // minYOverall = Math.min(minYOverall, ...line.points)\n\n      maxYOverall = Math.max.apply(Math, [maxYOverall].concat(_toConsumableArray(line.points)));\n      var points = line.points.slice(minXIndex, maxXIndex + 1);\n      timelineWindowGraphs.push(_objectSpread({}, line, {\n        points: points\n      })); // minY = Math.min(minY, ...points)\n\n      maxY = Math.max.apply(Math, [maxY].concat(_toConsumableArray(points)));\n    } // Set canvas `viewBox`.\n    // (add some side padding so that it doesn't trim the graphs on their sides)\n\n\n    canvas.setAttribute('viewBox', \"\".concat(minX, \" \").concat(minY, \" \").concat(maxX - minX, \" \").concat(maxY - minY)); // Calculate grid lines' coordinates.\n\n    var minY_ = 0;\n    var maxY_ = getLowerSiblingDivisibleBy(maxY, 10);\n    var yAxisScale = (maxY - minY) / (maxY_ - minY);\n    var yAxisTickMarks = divideInterval(minY_, maxY_); // Draw grid lines.\n\n    for (var _iterator4 = yAxisTickMarks, _isArray4 = Array.isArray(_iterator4), _i5 = 0, _iterator4 = _isArray4 ? _iterator4 : _iterator4[Symbol.iterator]();;) {\n      var _ref4;\n\n      if (_isArray4) {\n        if (_i5 >= _iterator4.length) break;\n        _ref4 = _iterator4[_i5++];\n      } else {\n        _i5 = _iterator4.next();\n        if (_i5.done) break;\n        _ref4 = _i5.value;\n      }\n\n      var y = _ref4;\n      canvas.appendChild(createGridLine(y, minX, maxX, minY, maxY));\n    } // Trim X axis.\n\n\n    var _x = xScaled.slice();\n\n    var _minX = _x[0];\n    var _maxX = _x[_x.length - 1];\n    var trimLeftRatio = (minX - _minX) / (_x[1] - _minX);\n    var trimRightRatio = (_maxX - maxX) / (_maxX - _x[_x.length - 2]);\n    _x[0] = minX;\n    _x[_x.length - 1] = maxX; // Draw graphs.\n\n    for (var _iterator5 = timelineWindowGraphs, _isArray5 = Array.isArray(_iterator5), _i6 = 0, _iterator5 = _isArray5 ? _iterator5 : _iterator5[Symbol.iterator]();;) {\n      var _ref5;\n\n      if (_isArray5) {\n        if (_i6 >= _iterator5.length) break;\n        _ref5 = _iterator5[_i6++];\n      } else {\n        _i6 = _iterator5.next();\n        if (_i6.done) break;\n        _ref5 = _i6.value;\n      }\n\n      var _ref6 = _ref5,\n          id = _ref6.id,\n          color = _ref6.color,\n          _points = _ref6.points;\n      var graph = document.createElement('polyline');\n      graph.setAttribute('stroke', color);\n\n      var _y = _points.slice();\n\n      var _minY = _y[0];\n      var _maxY = _y[_y.length - 1];\n      _y[0] = _minY + (_y[1] - _minY) * trimLeftRatio;\n      _y[_y.length - 1] = _maxY - (_maxY - _y[_y.length - 2]) * trimRightRatio;\n      graph.setAttribute('points', commaJoin(_x, _y.map(function (y) {\n        return maxY - yScale * y;\n      })).join(' '));\n      graph.classList.add('chartogram__graph');\n      canvas.appendChild(graph);\n    } // A workaround to fix WebKit bug when it's not re-rendering the <svg/>.\n    // https://stackoverflow.com/questions/30905493/how-to-force-webkit-to-update-svg-use-elements-after-changes-to-original\n\n\n    canvas.innerHTML += ''; // Draw gauges.\n\n    drawGauges(x[0], x[x.length - 1], minY_, maxY_, yAxisScale); // Draw timeline graph.\n\n    timelineWindowMinY = minY;\n    timelineWindowMaxY = maxY;\n    timelineWindowMinX = minX;\n    timelineWindowMaxX = maxX;\n    timelineWindowXScaled = xScaled;\n\n    if (redrawTimeline) {\n      drawTimeline(graphsAll, xScaledAll, minXOverall, maxXOverall, minY, maxYOverall);\n    }\n  } // function animateScale(scale) {\n  // \tconsole.log(scale)\n  // \tanimateScaleTo = scale\n  // \tanimateScaleStartedAt = Date.now()\n  // \tpreviousYScale = yScale\n  // \trequestAnimationFrame(animateScaleTick)\n  // }\n  // function animateScaleTick() {\n  // \tconst elapsed = Date.now() - animateScaleStartedAt\n  // \tyScale = previousYScale + (animateScaleTo - previousYScale) * elapsed / 300\n  // \tdrawGraphs(true)\n  // \tif (elapsed < 300) {\n  // \t\trequestAnimationFrame(animateScaleTick)\n  // \t}\n  // }\n\n\n  function createGridLine(y, minX, maxX, minY, maxY) {\n    var line = document.createElement('line');\n    line.classList.add('chartogram__grid-line');\n    line.setAttribute('x1', minX);\n    line.setAttribute('x2', maxX);\n    line.setAttribute('y1', maxY - minY - y);\n    line.setAttribute('y2', maxY - minY - y);\n    return line;\n  }\n\n  function drawGauges(minX, maxX, minY, maxY, yAxisScale) {\n    clearElement(xAxis);\n    clearElement(yAxis);\n    drawGauge(xAxis, minX, maxX, function (timestamp) {\n      var date = new Date(timestamp);\n      return \"\".concat(MONTHS[date.getMonth()], \" \").concat(date.getDate());\n    });\n    drawGauge(yAxis, minY, maxY);\n    yAxis.style.height = \"\".concat(100 / yAxisScale, \"%\");\n  }\n\n  function simplifyGraph(x, y, maxPoints) {\n    var yMax = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : Math.max.apply(Math, _toConsumableArray(y));\n    var threshold = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0.025;\n    var i = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0;\n\n    var _x = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : new Array(x.length);\n\n    var _y = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : new Array(x.length);\n\n    var _i = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : 0;\n\n    if (i + 2 > x.length - 1) {\n      while (i < y.length) {\n        _x[_i] = x[i];\n        _y[_i] = y[i];\n        _i++;\n        i++;\n      }\n\n      _x = _x.slice(0, _i);\n      _y = _y.slice(0, _i);\n\n      if (_x.length <= maxPoints) {\n        return [_x, _y];\n      } else {\n        if (x.length / _x.length < 1.1) {\n          threshold = Math.min(threshold + 0.025, 1);\n        }\n\n        return simplifyGraph(_x, _y, maxPoints, yMax, threshold);\n      }\n    }\n\n    var y0 = (y[i + 2] + y[i]) / 2;\n\n    if (Math.abs(y0 - y[i + 1]) / yMax < threshold) {\n      _x[_i] = x[i];\n      _x[_i + 1] = x[i + 2];\n      _y[_i] = y[i];\n      _y[_i + 1] = y[i + 2];\n      return simplifyGraph(x, y, maxPoints, yMax, threshold, i + 2, _x, _y, _i + 1);\n    } else {\n      _x[_i] = x[i];\n      _x[_i + 1] = x[i + 1];\n      _x[_i + 2] = x[i + 2];\n      _y[_i] = y[i];\n      _y[_i + 1] = y[i + 1];\n      _y[_i + 2] = y[i + 2];\n      return simplifyGraph(x, y, maxPoints, yMax, threshold, i + 2, _x, _y, _i + 2);\n    }\n  }\n\n  function drawTimeline(graphs, x, minX, maxX, minY, maxY) {\n    clearElement(timelineCanvas); // Set canvas `viewBox`.\n\n    timelineCanvas.setAttribute('viewBox', \"\".concat(minX, \" \").concat(minY, \" \").concat(maxX - minX, \" \").concat(maxY - minY));\n\n    for (var _iterator6 = graphs, _isArray6 = Array.isArray(_iterator6), _i7 = 0, _iterator6 = _isArray6 ? _iterator6 : _iterator6[Symbol.iterator]();;) {\n      var _ref7;\n\n      if (_isArray6) {\n        if (_i7 >= _iterator6.length) break;\n        _ref7 = _iterator6[_i7++];\n      } else {\n        _i7 = _iterator6.next();\n        if (_i7.done) break;\n        _ref7 = _i7.value;\n      }\n\n      var _ref8 = _ref7,\n          id = _ref8.id,\n          color = _ref8.color,\n          points = _ref8.points;\n\n      var _simplifyGraph = simplifyGraph(x, points, TIMELINE_CHART_MAX_POINTS),\n          _simplifyGraph2 = _slicedToArray(_simplifyGraph, 2),\n          _x = _simplifyGraph2[0],\n          _y = _simplifyGraph2[1];\n\n      var graph = document.createElement('polyline');\n      graph.setAttribute('stroke', color);\n      graph.setAttribute('points', commaJoin(_x, _y.map(function (y) {\n        return maxY - minY - y;\n      })).join(' '));\n      graph.classList.add('chartogram__graph');\n      timelineCanvas.appendChild(graph);\n    } // A workaround to fix WebKit bug when it's not re-rendering the <svg/>.\n    // https://stackoverflow.com/questions/30905493/how-to-force-webkit-to-update-svg-use-elements-after-changes-to-original\n\n\n    timelineCanvas.innerHTML += '';\n  }\n\n  function createGraphToggler(_ref9) {\n    var id = _ref9.id,\n        name = _ref9.name,\n        color = _ref9.color;\n    var toggler = document.createElement('button');\n    toggler.setAttribute('type', 'button');\n    toggler.classList.add('chartogram__chart-toggler');\n    toggler.classList.add('chartogram__chart-toggler--on');\n    toggler.classList.add('chartogram__reset-button'); // Add check.\n\n    var xmlns = 'http://www.w3.org/2000/svg';\n    var check = document.createElementNS(xmlns, 'svg');\n    check.setAttributeNS(null, 'viewBox', '0 0 19 19');\n    check.classList.add('chartogram__chart-toggler-check'); // Add background circle.\n\n    var backgroundCircle = document.createElementNS(xmlns, 'circle');\n    backgroundCircle.setAttribute('cx', '9.5');\n    backgroundCircle.setAttribute('cy', '9.5');\n    backgroundCircle.setAttribute('r', '9.5');\n    backgroundCircle.setAttribute('fill', color);\n    check.appendChild(backgroundCircle); // Add check circle.\n\n    var checkCircle = document.createElementNS(xmlns, 'circle');\n    checkCircle.setAttribute('cx', '9.5');\n    checkCircle.setAttribute('cy', '9.5');\n    checkCircle.setAttribute('r', '8');\n    checkCircle.classList.add('chartogram__chart-toggler-check-circle');\n    check.appendChild(checkCircle); // Add check mark.\n\n    var checkMark = document.createElementNS(xmlns, 'path');\n    checkMark.setAttribute('d', 'M13.64 4.94l-6.2 6.34-1.69-1.9c-.73-.63-1.89.1-1.36 1.06l2 3.38c.3.43 1.04.85 1.78 0 .32-.42 6.31-7.93 6.31-7.93.74-.84-.2-1.58-.84-.95z');\n    checkMark.setAttribute('fill', 'white');\n    checkMark.classList.add('chartogram__chart-toggler-check-mark');\n    check.appendChild(checkMark); // Add checkmark.\n\n    toggler.appendChild(check); // Add graph name.\n\n    toggler.appendChild(document.createTextNode(name)); // On click.\n\n    toggler.addEventListener('click', function () {\n      var show = !showGraphs[id]; // Won't allow hiding all graphs.\n\n      if (!show) {\n        var graphsShown = Object.keys(showGraphs).filter(function (id) {\n          return showGraphs[id] !== false;\n        }).length;\n\n        if (graphsShown === 1) {\n          return;\n        }\n      } // showGraphsNext = { ...showGraphs }\n      // showGraphsNext[id] = show\n      // const maxYNext = getMaxY(timelineWindowGraphs.filter(_ => showGraphsNext[_.id]))\n      // const scale = timelineWindowMaxY / maxYNext\n      // if (scale !== 1) {\n      // \tanimateScale(scale)\n      // }\n\n\n      showGraphs[id] = show;\n      drawGraphs(true);\n      toggler.classList.toggle('chartogram__chart-toggler--on');\n    });\n    return toggler;\n  }\n\n  function getMaxY(graphs) {\n    var maxY = 0;\n\n    for (var _iterator7 = graphs, _isArray7 = Array.isArray(_iterator7), _i8 = 0, _iterator7 = _isArray7 ? _iterator7 : _iterator7[Symbol.iterator]();;) {\n      var _ref10;\n\n      if (_isArray7) {\n        if (_i8 >= _iterator7.length) break;\n        _ref10 = _iterator7[_i8++];\n      } else {\n        _i8 = _iterator7.next();\n        if (_i8.done) break;\n        _ref10 = _i8.value;\n      }\n\n      var graph = _ref10;\n      maxY = Math.max.apply(Math, [maxY].concat(_toConsumableArray(graph.points)));\n    }\n\n    return maxY;\n  }\n\n  function setUpTimelineWindowHandle(side) {\n    var handle = side === 'left' ? timelineWindowLeftHandle : timelineWindowRightHandle;\n    var handleWidth = parseFloat(getComputedStyle(timelineWindow).borderLeftWidth);\n    var timelineCoordinates;\n    var minX;\n    var maxX;\n    var deltaX;\n    var startedX;\n\n    function onDrag(x) {\n      x = x - deltaX;\n      x = Math.max(Math.min(x, maxX), minX);\n      x = (x - timelineCoordinates.x) / timelineCoordinates.width;\n\n      if (side === 'left') {\n        timelineWindowFrom = x;\n      } else {\n        timelineWindowTo = x;\n      }\n\n      updateTimelineWindow();\n    }\n\n    function onDragStart(x) {\n      timelineCoordinates = timeline.getBoundingClientRect();\n      var timelineWindowCoordinates = timelineWindow.getBoundingClientRect();\n\n      if (side === 'left') {\n        minX = timelineCoordinates.x;\n        maxX = timelineWindowCoordinates.x + timelineWindowCoordinates.width - 2 * handleWidth;\n        deltaX = x - timelineWindowCoordinates.x;\n      } else {\n        minX = timelineWindowCoordinates.x + 2 * handleWidth;\n        maxX = timelineCoordinates.x + timelineCoordinates.width;\n        deltaX = x - (timelineWindowCoordinates.x + timelineWindowCoordinates.width);\n      }\n    }\n\n    return setUpDrag(handle, onDragStart, onDrag);\n  }\n\n  function setUpTimelineWindow() {\n    var timelineCoordinates;\n    var timelineWindowCoordinates;\n    var minX;\n    var maxX;\n    var innerX;\n\n    function onDrag(x) {\n      x = x - innerX;\n      x = Math.max(Math.min(x, maxX), minX);\n      x = (x - timelineCoordinates.x) / timelineCoordinates.width;\n      timelineWindowFrom = x;\n      timelineWindowTo = x + timelineWindowCoordinates.width / timelineCoordinates.width;\n      updateTimelineWindow();\n    }\n\n    function onDragStart(x) {\n      timelineCoordinates = timeline.getBoundingClientRect();\n      timelineWindowCoordinates = timelineWindow.getBoundingClientRect();\n      innerX = x - timelineWindowCoordinates.x;\n      minX = timelineCoordinates.x;\n      maxX = timelineCoordinates.x + (timelineCoordinates.width - timelineWindowCoordinates.width);\n    }\n\n    return setUpDrag(timelineWindowDrag, onDragStart, onDrag);\n  }\n\n  function setUpDrag(element, onDragStart, onDrag) {\n    function onTouchMove(event) {\n      onDrag(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\n    }\n\n    function onPointerMove(event) {\n      onDrag(event.clientX, event.clientY);\n    }\n\n    function onDragStop() {\n      window.removeEventListener('pointermove', onPointerMove);\n      window.removeEventListener('touchmove', onTouchMove);\n      window.removeEventListener('pointerup', onDragStop);\n      window.removeEventListener('pointercancel', onDragStop);\n      window.removeEventListener('touchend', onDragStop);\n      window.removeEventListener('touchcancel', onDragStop);\n    }\n\n    function onTouchStart(event) {\n      // Ignore multitouch.\n      if (event.touches.length > 1) {\n        // Reset.\n        return onDragStop();\n      }\n\n      onDragStart(event.changedTouches[0].clientX, event.changedTouches[0].clientY);\n      window.addEventListener('touchmove', onTouchMove);\n      window.addEventListener('touchend', onDragStop);\n      window.addEventListener('touchcancel', onDragStop);\n    } // Safari doesn't support pointer events.\n    // https://caniuse.com/#feat=pointer\n\n\n    element.addEventListener('touchstart', onTouchStart);\n\n    function onPointerDown(event) {\n      onDragStart(event.clientX, event.clientY);\n      window.addEventListener('pointermove', onPointerMove);\n      window.addEventListener('pointerup', onDragStop);\n      window.addEventListener('pointercancel', onDragStop);\n    }\n\n    element.addEventListener('pointerdown', onPointerDown);\n    return function () {\n      onDragStop();\n      element.removeEventListener(onPointerDown);\n      element.removeEventListener(onTouchStart);\n    };\n  }\n\n  function setTimelineWindowLeft(x) {\n    timelineOverlayLeft.style.right = \"\".concat(100 * (1 - x), \"%\");\n    timelineWindow.style.left = \"\".concat(100 * x, \"%\");\n  }\n\n  function setTimelineWindowRight(x) {\n    timelineOverlayRight.style.left = \"\".concat(100 * x, \"%\");\n    timelineWindow.style.right = \"\".concat(100 * (1 - x), \"%\");\n  }\n\n  function updateTimelineWindow() {\n    setTimelineWindowLeft(timelineWindowFrom);\n    setTimelineWindowRight(timelineWindowTo);\n    drawGraphs(false);\n  }\n\n  function setUpCanvas() {\n    var canvasDimensions;\n    var isIndexInBounds;\n\n    function onTrack(screenX) {\n      var xScreenRatio = (screenX - canvasDimensions.x) / canvasDimensions.width;\n      var x = timelineWindowMinX + xScreenRatio * (timelineWindowMaxX - timelineWindowMinX);\n      var xHigherIndex = timelineWindowXScaled.findIndex(function (_) {\n        return _ >= x;\n      });\n      var xLowerIndex = xHigherIndex - 1;\n\n      if (!isIndexInBounds(xHigherIndex)) {\n        xHigherIndex = -1;\n      }\n\n      if (!isIndexInBounds(xLowerIndex)) {\n        xLowerIndex = -1;\n      }\n\n      if (xHigherIndex < 0) {\n        if (xLowerIndex < 0) {\n          return removeTooltip();\n        } else {\n          x = timelineWindowXScaled[xLowerIndex];\n        }\n      } else {\n        if (xLowerIndex < 0) {\n          x = timelineWindowXScaled[xHigherIndex];\n        } else {\n          var xLower = timelineWindowXScaled[xLowerIndex];\n          var xHigher = timelineWindowXScaled[xHigherIndex];\n          var deltaLower = x - xLower;\n          var deltaHigher = xHigher - x;\n          x = deltaLower > deltaHigher ? xHigher : xLower;\n        }\n      }\n\n      if (x !== tooltipForX) {\n        tooltipForX = x;\n\n        if (!tooltip) {\n          addTooltip();\n        }\n\n        var date = new Date(x * 1000 + shiftX);\n        tooltipDate.textContent = \"\".concat(WEEKDAYS[date.getDay()], \", \").concat(MONTHS[date.getMonth()], \" \").concat(date.getDate());\n        var xIndex = timelineWindowXScaled.indexOf(x);\n        var i = 0;\n\n        while (2 * i < tooltipValues.childNodes.length) {\n          tooltipValues.childNodes[2 * i].textContent = timelineWindowGraphs[i].points[xIndex];\n          tooltipValues.childNodes[2 * i + 1].textContent = data.lines[i].name;\n          i++;\n        }\n\n        var xRatio = (x - timelineWindowMinX) / (timelineWindowMaxX - timelineWindowMinX);\n        tooltip.style.left = \"\".concat(xRatio * 100, \"%\");\n        updateTooltipPoints(xIndex, xRatio);\n        updateTooltipLine(x);\n      }\n    }\n\n    function onTrackStart() {\n      canvasDimensions = canvas.getBoundingClientRect();\n\n      isIndexInBounds = function isIndexInBounds(index) {\n        if (index < 0) {\n          return false;\n        }\n\n        return timelineWindowXScaled[index] >= timelineWindowMinX && timelineWindowXScaled[index] <= timelineWindowMaxX;\n      };\n    }\n\n    function onTouchStart(event) {\n      // Ignore multitouch.\n      if (event.touches.length > 1) {\n        // Reset.\n        return onTrackStop();\n      }\n\n      onTrackStart();\n      canvas.addEventListener('touchend', onTrackStop);\n      canvas.addEventListener('touchmove', onTouchMove);\n      canvas.addEventListener('touchend', onTrackStop);\n      canvas.addEventListener('touchcancel', onTrackStop);\n      onTouchMove(event);\n    } // Safari doesn't support pointer events.\n    // https://caniuse.com/#feat=pointer\n\n\n    canvas.addEventListener('touchstart', onTouchStart);\n\n    function onTouchMove(event) {\n      var x = event.changedTouches[0].clientX;\n      var y = event.changedTouches[0].clientY; // Emulate 'pointerleave' behavior.\n\n      if (x < canvasDimensions.x || x > canvasDimensions.x + canvasDimensions.width || y < canvasDimensions.y || y > canvasDimensions.y + canvasDimensions.height) {\n        onTrackStop();\n      } else {\n        onTrack(x, y);\n      }\n    }\n\n    function onPointerMove(event) {\n      onTrack(event.clientX, event.clientY);\n    }\n\n    function onTrackStop() {\n      canvas.removeEventListener('pointermove', onPointerMove);\n      canvas.removeEventListener('pointerleave', onTrackStop);\n      canvas.removeEventListener('pointercancel', onTrackStop);\n      canvas.removeEventListener('touchmove', onTouchMove);\n      canvas.removeEventListener('touchend', onTrackStop);\n      canvas.removeEventListener('touchcancel', onTrackStop);\n      removeTooltip();\n    }\n\n    function onPointerEnter() {\n      onTrackStart();\n      canvas.addEventListener('pointermove', onPointerMove);\n      canvas.addEventListener('pointerleave', onTrackStop);\n      canvas.addEventListener('pointercancel', onTrackStop);\n    }\n\n    canvas.addEventListener('pointerenter', onPointerEnter);\n    return function () {\n      onTrackStop();\n      canvas.removeEventListener(onPointerEnter);\n      canvas.removeEventListener(onTouchStart);\n    };\n  }\n\n  function addTooltip() {\n    // Create tooltip.\n    tooltip = document.createElement('div');\n    tooltip.classList.add('chartogram__tooltip');\n    tooltipContainer.appendChild(tooltip); // Add tooltip title.\n\n    tooltipDate = document.createElement('h1');\n    tooltipDate.classList.add('chartogram__tooltip-header');\n    tooltip.appendChild(tooltipDate); // Add graph values.\n\n    tooltipValues = document.createElement('dl');\n    tooltipValues.classList.add('chartogram__tooltip-values');\n    tooltip.appendChild(tooltipValues); // Add graph values.\n\n    for (var _iterator8 = data.lines, _isArray8 = Array.isArray(_iterator8), _i9 = 0, _iterator8 = _isArray8 ? _iterator8 : _iterator8[Symbol.iterator]();;) {\n      var _ref11;\n\n      if (_isArray8) {\n        if (_i9 >= _iterator8.length) break;\n        _ref11 = _iterator8[_i9++];\n      } else {\n        _i9 = _iterator8.next();\n        if (_i9.done) break;\n        _ref11 = _i9.value;\n      }\n\n      var line = _ref11;\n\n      if (showGraphs[line.id]) {\n        // Add graph value.\n        var tooltipValue = document.createElement('dt');\n        tooltipValue.style.color = line.color;\n        tooltipValues.appendChild(tooltipValue); // Add graph name.\n\n        var tooltipName = document.createElement('dd');\n        tooltipName.style.color = line.color;\n        tooltipValues.appendChild(tooltipName);\n      }\n    }\n  }\n\n  function removeTooltip() {\n    if (tooltip) {\n      tooltipForX = undefined;\n      tooltipContainer.removeChild(tooltip);\n      tooltip = undefined;\n      removeTooltipPoints();\n      removeTooltipLine();\n    }\n  }\n\n  function addTooltipLine() {\n    var xmlns = 'http://www.w3.org/2000/svg';\n    tooltipLine = document.createElementNS(xmlns, 'line');\n    tooltipLine.setAttributeNS(null, 'class', 'chartogram__tooltip-line');\n    canvas.insertBefore(tooltipLine, canvas.querySelector('polyline'));\n  }\n\n  function removeTooltipLine() {\n    canvas.removeChild(tooltipLine);\n    tooltipLine = undefined;\n  }\n\n  function addTooltipPoints() {\n    tooltipPoints = [];\n    var i = 0;\n\n    while (i < timelineWindowGraphs.length) {\n      var point = document.createElement('div');\n      point.classList.add('chartogram__tooltip-point');\n      point.style.color = timelineWindowGraphs[i].color;\n      tooltipPoints.push(point);\n      canvasWrapper.appendChild(point);\n      i++;\n    }\n  }\n\n  function removeTooltipPoints() {\n    for (var _iterator9 = tooltipPoints, _isArray9 = Array.isArray(_iterator9), _i10 = 0, _iterator9 = _isArray9 ? _iterator9 : _iterator9[Symbol.iterator]();;) {\n      var _ref12;\n\n      if (_isArray9) {\n        if (_i10 >= _iterator9.length) break;\n        _ref12 = _iterator9[_i10++];\n      } else {\n        _i10 = _iterator9.next();\n        if (_i10.done) break;\n        _ref12 = _i10.value;\n      }\n\n      var point = _ref12;\n      canvasWrapper.removeChild(point);\n    }\n\n    tooltipPoints = undefined;\n  }\n\n  function updateTooltipLine(x) {\n    if (!tooltipLine) {\n      addTooltipLine();\n    }\n\n    tooltipLine.setAttributeNS(null, 'x1', x);\n    tooltipLine.setAttributeNS(null, 'x2', x);\n    tooltipLine.setAttributeNS(null, 'y1', timelineWindowMinY);\n    tooltipLine.setAttributeNS(null, 'y2', timelineWindowMaxY);\n  }\n\n  function updateTooltipPoints(xIndex, xRatio) {\n    if (!tooltipPoints) {\n      addTooltipPoints();\n    }\n\n    var i = 0;\n\n    while (i < tooltipPoints.length) {\n      var point = tooltipPoints[i];\n      point.style.left = \"\".concat(xRatio * 100, \"%\");\n      var y = timelineWindowGraphs[i].points[xIndex];\n      var yRatio = y / timelineWindowMaxY;\n      point.style.bottom = \"\".concat(yRatio * 100, \"%\");\n      i++;\n    }\n  }\n}\n//# sourceMappingURL=index.js.map"],"names":["_slicedToArray","arr","i","Array","isArray","_arrayWithHoles","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","value","length","err","_iterableToArrayLimit","TypeError","_nonIterableRest","_objectSpread","target","arguments","source","ownKeys","Object","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","obj","defineProperty","configurable","writable","_toConsumableArray","arr2","_arrayWithoutHoles","iter","prototype","toString","call","from","_iterableToArray","_nonIterableSpread","rootNode","data","title","options","innerHTML","classList","add","timelineWindowFrom","timelineWindowTo","showGraphs","timelineWindowGraphs","timelineWindowMinX","timelineWindowMaxX","timelineWindowMinY","timelineWindowMaxY","shiftX","timelineWindowXScaled","tooltip","tooltipDate","tooltipValues","tooltipForX","tooltipPoints","tooltipLine","GAUGE_TICK_MARKS_COUNT","gaugeMarkTicksCount","TIMELINE_WINDOW_SIZE","timelineWindowSize","TIMELINE_CHART_MAX_POINTS","timelineChartMaxPoints","MONTHS","months","WEEKDAYS","weekdays","tooltipContainer","document","querySelector","canvas","canvasWrapper","xAxis","yAxis","timeline","timelineOverlayLeft","timelineWindowLeftHandle","timelineWindow","timelineWindowDrag","timelineWindowRightHandle","timelineOverlayRight","timelineCanvas","yScale","clearElement","element","firstChild","removeChild","commaJoin","a","b","map","ai","drawGauge","min","max","transform","tickMark","createElement","appendChild","createTextNode","drawGraphs","redrawTimeline","x","points","xScaledAll","_","minXOverall","maxXOverall","deltaX","minX","maxX","minXIndex","findIndex","maxXIndex","xScaled","slice","maxY","maxYOverall","graphsAll","_iterator3","lines","_isArray3","_i4","_ref3","line","id","Math","apply","setAttribute","maxY_","n","divider","getLowerSiblingDivisibleBy","yAxisScale","_iterator4","divideInterval","_isArray4","_i5","_ref4","y","createGridLine","_x","_minX","_maxX","trimLeftRatio","trimRightRatio","_iterator5","_isArray5","_i6","_ref5","_ref6","color","_points","graph","_y","_minY","_maxY","join","minY","timestamp","date","Date","getMonth","getDate","style","height","drawGauges","graphs","_iterator6","_isArray6","_i7","_ref7","_ref8","_simplifyGraph","simplifyGraph","_simplifyGraph2","drawTimeline","maxPoints","yMax","threshold","y0","abs","createGraphToggler","_ref9","name","toggler","xmlns","check","createElementNS","setAttributeNS","backgroundCircle","checkCircle","checkMark","addEventListener","show","toggle","setUpTimelineWindowHandle","side","timelineCoordinates","handle","handleWidth","parseFloat","getComputedStyle","borderLeftWidth","setUpDrag","getBoundingClientRect","timelineWindowCoordinates","width","updateTimelineWindow","onDragStart","onDrag","onTouchMove","event","changedTouches","clientX","clientY","onPointerMove","onDragStop","window","removeEventListener","onTouchStart","touches","onPointerDown","right","left","setTimelineWindowRight","removeTooltip","_iterator9","_isArray9","_i10","_ref12","point","removeTooltipPoints","innerX","_iterator","_isArray","_i2","_ref","xMin","xMax","xFrom","graphTogglers","_iterator2","_isArray2","_i3","_ref2","_line","displayGraphs","canvasDimensions","isIndexInBounds","onTrack","screenX","xScreenRatio","xHigherIndex","xLowerIndex","xLower","xHigher","deltaLower","deltaHigher","_iterator8","_isArray8","_i9","_ref11","tooltipValue","tooltipName","addTooltip","textContent","getDay","xIndex","indexOf","childNodes","xRatio","addTooltipPoints","yRatio","bottom","updateTooltipPoints","insertBefore","updateTooltipLine","onTrackStart","index","onTrackStop","onPointerEnter","setUpCanvas"],"mappings":"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"}